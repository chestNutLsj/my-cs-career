   

### 9.3.1　组件Canvas

Canvas（画布）组件是一个有趣的组件，可以显示包含直线和几何对象的绘图。可以认为它是海龟绘图的原始版本。（事实上，海龟绘图本质是就是一个tkinter GUI。）

我们通过构建一个非常简单的画笔绘图应用程序来演示Canvas组件。应用程序由一个最初为空的画布构成。用户可以使用鼠标在画布内绘制曲线。按下鼠标左键开始曲线的绘制。按下鼠标左键并同时移动鼠标时，移动画笔并绘制曲线。当释放鼠标左键时，完成曲线的绘制。使用该程序的一个涂鸦如图9-11所示。

我们首先创建一个大小为100×100像素的Canvas组件。由于绘制图形通过按下鼠标左键开始，因此需要绑定事件类型<Button-1>到一个事件处理函数。另外，由于按住鼠标左键的同时移动鼠标会绘制曲线，因此还需要绑定事件类型<Button1-Motion>到另一个事件处理函数。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09036.jpeg)

图9-11　画布绘图应用程序。该GUI实现了一个画笔绘图应用程序。按下鼠标左键开始绘制曲线。通过按下鼠标左键的同时移动鼠标可以绘制曲线。释放鼠标左键时停止绘制

这就是我们迄今为止所拥有的画布绘图程序：

模块：draw.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09037.jpeg)

接下来需要实现事件处理函数begin()和draw()以实际绘制曲线。我们首先讨论draw()的实现。每次按下鼠标左键的同时移动鼠标时，将调用事件处理函数draw()，带一个输入参数：一个存储鼠标新位置的Event对象。要继续绘制曲线，只需要把鼠标的新位置和前一个位置用一条线段连接起来。显示的曲线将是一系列连接前后鼠标位置的非常短的直线段。

Canvas的方法create_line()可以用于绘制两个点之间的线段。其通用格式带一个输入参数：一个(x,y)坐标序列(x1,y1,x2,y2,…,xn,yn)。绘制一条从点(x1,y1)到点(x2,y2)的线段，然后绘制一条从点(x2,y2)到点(x3,y3)的线段，以此类推。因此，要连接鼠标坐标为(oldx,oldy)的旧位置到坐标为(newx,newy)的新位置，只需要执行语句：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09038.jpeg)

曲线通过反复连接新的鼠标位置到旧的（先前）鼠标位置来绘制。这意味着必须有一个“初始”旧鼠标位置（即曲线的开始位置）。这个位置由鼠标左键按下的事件处理程序begin()设置：

模块：draw.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09039.jpeg)

在事件处理函数begin()中，变量oldx和oldy接收当鼠标左键按下时鼠标的坐标。这些全局变量将不断被事件处理程序draw()更新，以记录鼠标最后的位置。我们现在可以实现事件处理程序draw()：

模块：draw()

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09040.jpeg)

在继续下一节之前，我们在表9-8列出了Canvas组件支持的一些方法。

表9-8　一些Canvas方法。其中列举了tkinter组件类Canvas的少数几个方法。在画布上绘制的每个对象都有一个唯一的ID（恰好是一个整数）

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09041.jpeg)

注意事项：把状态保存在全局变量中

在程序draw.py中，变量oldx和oldy存储鼠标前一个位置的坐标。这些坐标最初由函数begin()设置，然后由函数draw()更新。因此变量oldx和oldy不可能是这两个函数的局部变量，它们必须定义为全局变量。

使用全局变量会导致不安全问题，因为全局变量的范围是整个模块。模块越大，包含的名称越多，我们就越有可能在模块中无意中定义一个名称两次。当从另一个模块导入变量、函数和类时，这种情况更可能发生。如果一个名称多次被定义，那么除了一个定义之外，其他所有的都将被丢弃，这通常会导致非常奇怪的错误。

在下一节中，我们学习如何使用面向对象程序设计技术开发图形用户界面的新组件类。其优点之一是，我们能够在实例变量中存储GUI状态，而不是在全局变量中存储GUI状态。

练习题9.6　实现程序draw2.py（draw.py的一个修改版本），支持通过同时按【Ctrl】和鼠标左键来删除最后绘制的曲线。为了实现该功能，需要删除由create_line()创建的、构成最终绘制曲线的所有短线段。这又意味着必须把构成最后的曲线的所有线段保存到一个容器中。