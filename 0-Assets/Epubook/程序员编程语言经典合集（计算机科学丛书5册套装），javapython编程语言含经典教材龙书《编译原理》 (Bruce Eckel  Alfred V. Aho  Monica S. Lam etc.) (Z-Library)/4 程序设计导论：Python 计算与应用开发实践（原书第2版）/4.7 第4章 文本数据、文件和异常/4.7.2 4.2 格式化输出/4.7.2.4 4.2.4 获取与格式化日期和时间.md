   

### 4.2.4　获取与格式化日期和时间

程序常常需要解析或者产生包含日期和时间的字符串。另外，还需要获取当前时间。当前日期和时间可以通过“查询”底层操作系统获取。在Python语言中，time模块提供了操作系统时间功能的API接口，以及格式化日期和时间的工具。为了了解如何使用它，我们首先导入time模块：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08262.jpeg)

time模块中包含若干返回当前时间不同版本的函数。time()函数返回从纪元开始经过的时间（以秒为单位）：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08263.jpeg)

通过另一个函数，可以返回与time()格式完全不同的时间，从而可以查看当前计算机系统的纪元：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08264.jpeg)

知识拓展：纪元、时间、UTC时间

计算机记录时间的方式是记录从某个时间点（纪元）开始所经过的秒数。在UNIX和基于Linux的计算机（包括Mac OS X），纪元开始于格林尼治时间1970年1月1日00:00:00。

为了记录自纪元开始所经过的准确秒数，计算机需要知道一秒钟是多长时间。每个计算机在其中央处理器（CPU）中有一个石英钟可以用于此目的（还可以控制“时钟周期”的长度）。但是石英钟存在着并不是“十分准确”的问题，每隔一段时间后会与“实际时间”产生偏离。这对于当今的联网计算机而言是一个问题，因为许多互联网应用程序要求计算机时间同步（至少误差较小）。

当今的联网计算机的石英钟会与互联网上的时间服务器保持同步，时间服务器的工作是提供称之为“协调世界时间、世界统一时间、世界标准时间、国际协调时间，或UTC时间”的“官方时间”的服务。UTC是大约12个原子钟的平均时间，在格林尼治英国皇家天文台，被用来追踪平均太阳时（基于地球绕太阳旋转）。

借助互联网上的时间服务器提供的这种国际认可的标准时间服务，计算机才能保持一致的时间（在很小的误差范围之内）。

函数gmtime()返回的对象类型为time.struct_time，它是一个类似元组的类型。虽然这个类型有些陌生，但查看纪元（即纪元开始后的0秒的时间）并不困难，即1970年1月1日00:00:00 UTC。这是UTC时间，因为给定一个整数作为输入参数s，函数gmtime()返回自纪元开始s秒后的UTC时间。如果没有指定参数，则函数gmtime()返回当前UTC时间。关联的函数localtime()返回本地时区的当前时间：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08265.jpeg)

输出格式的可读性并不好（因为设计的目的不在于此）。模块time提供了一个格式化函数strftime()可以按期望的格式输出时间。strftime()函数带一个格式化字符串参数和gmtime()或localtime()返回的时间参数，按格式化字符串描述的格式输出时间。下面给出一个例子（参见图4-6）：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08266.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08267.jpeg)

图4-6　映射指令。根据表4-3中的映射关系，在输出字符串中，指令%A、%b、%d、%y、%I、%M和%p映射到日期和时间值

在上例中，strftime()根据格式化字符串'%A %b/%d/%y %I:%M %p'中指定的格式输出time.localtime()返回的时间。格式字符串中包含了指令%A、%b、%d、%y、%I、%M和%p，指定日期和时间值在指定位置输出，其映射关系参见表4-3。格式化字符串中的其他字符（/、:和空格）则原样复制到输出结果。

表4-3　时间格式字符串指令。其中仅列举了一些常用的时间和日期格式化指令

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08268.jpeg)

练习题4.7　首先设定t为本地时间：自1970年1月1日UTC开始1 500 000 000秒：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08269.jpeg)

使用字符串时间格式化函数strftime()构建如下字符串：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08270.jpeg)