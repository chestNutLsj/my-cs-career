   

### 4.3.2　打开和关闭文件

处理一个文件包括如下三个步骤：

1.打开用于读或写的文件。

2.从文件中读取内容和/或写入数据到文件。

3.关闭文件。

内置函数open()用于打开一个文件，不管是文本文件还是二进制文件。为了读取文件example.txt，首先必须要打开它：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08276.jpeg)

函数open()包括三个字符串参数：文件名、打开模式（mode，可选）和编码（可选）。我们将在第6章讨论编码参数。文件名实际上是要打开的文件的路径（绝对路径或相对路径）。在上例中，使用的是相对路径example.txt。Python将在当前工作路径（回顾前述内容，包含上次导入模块的文件夹）中查找名为example.txt的文件。如果文件不存在，则抛出异常。例如：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08277.jpeg)

文件名也可以是文件的绝对路径，例如，在UNIX机器上为：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08278.jpeg)

在Windows机器上则为：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08279.jpeg)

注意事项：文件系统路径使用斜杠还是反斜杠？

在UNIX、Linux和Mac OS X系统中，在路径中使用斜杠（/）作为分隔符。在微软Windows系统中，则使用反斜杠（/）作为分隔符：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08280.jpeg)

也就是说，Python将接受Windows系统中使用斜杠（/）的路径。这是一个相当棒的功能，因为在一个字符串中，反斜杠（\）被解释为转义序列的开始。

打开模式（mode）是一个字符串，用于指定如何与打开的文件进行交互。在函数调用open('example.txt','r')中，打开模式'r'表示打开文件用于读取内容；同时还规定，该文件将作为文本文件被读取。

一般而言，打开模式字符串会包含r、w、a或r+之一，分别表示打开文件用于读取、写入、附加、读取并写入。如果没有指定，默认值为r。另外，打开模式字符串中还允许使用字符t和b，t表示文件是文本文件，而b表示文件是二进制文件。如果两者都没有被指定，则默认为t。因此，open('example.txt','r')等价于open('example.txt','rt')，也等价于open('example.txt')。文件打开模式的总结如表4-4所示。

表4-4　文件打开模式。文件打开模式是描述文件使用方式的字符串：读取、写入、读取并写入；按字节读取、使用文本编码方式读取

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08281.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08282.jpeg)

将文件作为文本文件或二进制文件打开的区别在于，二进制文件被视为字节序列，在读取时不进行解码，在写入时不进行编码。然而，文本文件被当作使用某种编码的编码文件。

open()函数返回一个输入或输出流类型的对象，支持读取和/或写入字符的方法。我们把这种对象被称为文件对象。不同的文件打开模式返回不同文件类型的文件对象。根据文件打开的不同模式，所返回的文件类型将支持表4-5中描述的全部或部分方法。

表4-5　文件对象方法。文件对象（例如，open()函数返回的对象）支持表4-5中的方法

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08283.jpeg)

不同的读取方法用于以不同的方式读取文件的内容。以example.txt文件为例说明三者的差异。假设example.txt的内容是：

文件：example.txt

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08284.jpeg)

首先把文件作为文本输入流打开，用于进行读取：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08285.jpeg)

对于每个打开的文件，文件系统将关联一个指向文件中某个字符的游标。当文件第一次打开时，游标通常指向文件的开头（即文件的第一个字符），如图4-8所示。读取文件时，读取的字符是从游标开始的字符；如果我们正在写入文件，那么我们的任何内容都将从游标位置开始写入。

现在使用read()函数读取一个字符。read()函数将把文件中的第一个字符作为字符串（仅包含一个字符的字符串）返回。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08286.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08287.jpeg)

图4-8　读取文件example.txt。读取文件时，游标随字符被读取而移动，并且一直指向下一个未读取的字符。执行read(1)之后，字符'T'被读取，游标移动并指向'h'。执行read(5)之后，字符串'he 3'被读取，游标移动并指向'l'。执行readline()之后，第一行剩余的内容被读取，游标移动并指向第二行的开头，第二行为空（除了换行符）

读取字符'T'之后，游标将移动并指向下一个字符，即'h'（即第一个未读取字符），如图4-8所示。让我们再次调用read()函数，这次读取5个字符。返回的结果是最初读取的字符'T'之后的5个字符构成的字符串：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08288.jpeg)

函数readline()将从文件中读取字符直到行尾（即换行字符\n）或者文件结尾。注意，上例中readline()返回的字符串的最后一个字符是换行符：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08289.jpeg)

现在，游标指向第二行的开头，如图4-8所示。最后，我们使用不带参数的read()读取文件中剩余的内容：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08290.jpeg)

现在，游标指向“文件结尾”（EOF）字符，EOF指示文件结束。

要关闭infile所指向的打开文件，可以使用如下语句：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08291.jpeg)

关闭文件将释放跟踪打开文件的信息（即游标位置信息）的文件系统资源。

注意事项：结束符

如果一个文件被当作二进制文件来读取和写入，则文件只是一个字节序列，不存在行的概念。因此一种编码必须存在一个换行的码（即换行符）。在Python语言中，换行符表示为转义字符序列\n。然而，文本文件的格式与计算机系统平台有关，不同的操作系统使用不同的字节序列编码一个新行：

·MS Windows使用\r\n两个字符序列。

·Linux/UNIX和Mac OS X使用\n字符序列。

·Mac OS版本9（包括）之前使用\r字符序列。

当进行读取操作时，Python将与平台相关的行结束符转换为\n；当进行写入操作时，Python将\n转换为与平台相关的行结束符。通过这种转换，Python实现了与平台无关的特性。