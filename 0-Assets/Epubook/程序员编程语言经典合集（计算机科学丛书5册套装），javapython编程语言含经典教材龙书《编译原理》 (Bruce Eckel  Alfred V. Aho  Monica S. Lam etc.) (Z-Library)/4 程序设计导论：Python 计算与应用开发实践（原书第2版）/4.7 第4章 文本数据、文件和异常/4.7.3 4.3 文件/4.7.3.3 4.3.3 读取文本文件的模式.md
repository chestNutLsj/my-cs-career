   

### 4.3.3　读取文本文件的模式

Python根据用户需要对文件进行什么操作，提供以下几种不同的方法以用于访问文件内容并为其处理做准备。接下来将具体描述这几种打开要读取的文件和读取文件内容的模式。我们将再次使用文件example.txt说明这些模式。example.txt的内容如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08292.jpeg)

访问文本文件的一种方法是把文件的内容读取到一个字符串对象。这种模式适合于文件不是太多的情况，可以使用字符串操作来处理文件内容。例如，这种模式可以用于查找文件内容，或把一个子字符串替换为另一个字符串。

我们通过实现函数numChars()来描述该模式。numChars()带一个文件名作为输入参数，返回文件中的字符个数。我们使用read()函数把文件内容读取到一个字符串：

模块：ch4.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08293.jpeg)

针对example.txt文件调用该函数，结果如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08294.jpeg)

练习题4.8　编写函数stringCount()，带2个字符串作为输入参数：文件名和目标字符串，返回目标字符串在文件中出现的次数。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08295.jpeg)

接下来要讨论的文件读取模式适用于处理文件中的单词。要访问文件中的单词，可以读取文件内容到一个字符串，然后使用split()函数的默认形式把内容拆分为一个单词列表。（因此，我们在该例中关于单词的定义仅仅是连续的非空字符序列。）我们通过下一个函数描述该模式，该函数返回文件中的单词个数。它还输出这些单词列表，以便观察单词列表。

模块：ch4.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08296.jpeg)

在example.txt上运行该程序的输出结果如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08297.jpeg)

在函数numWords()中，列表中的单词可能会包含标点符号，例如'line.'中的句点。我们最好先去掉标点符号，然后再把内容拆分成单词。这样做是下一个练习题的目标。

练习题4.9　编写函数words()，带一个文件名作为输入参数，返回文件中的真正单词（除去标点符号!、,、.、:、;、?）列表。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08298.jpeg)

有时需要逐行处理文本文件。例如，在Web服务器日志文件中搜索包含可疑IP地址的记录。日志文件是一个文件，其中每一行都是某个事务的记录（例如，Web服务器对Web页面请求的处理）。在这第三种模式中，readlines()函数用来读取文件的内容作为一个行文本的列表。我们通过一个简单的例子说明这种模式：通过返回行文本的长度的方式计算一个文件中的行数。它还将打印文本行的列表，以便我们观察列表的内容。

模块：ch4.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08299.jpeg)

在example.txt上运行该程序。注意每行内容都包含换行符（\n）：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08300.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08301.jpeg)

到目前为止，我们涉及的文件处理模式都是读取整个文件内容作为字符串或字符串（行）列表。如果文件不太大，这种方法是可行的。如果文件很大，则更好的方法是逐行处理文件，这样就避免了把整个文件保存在内存中。Python支持对文件对象行的迭代。我们使用这种方法打印example.txt的每一行：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08302.jpeg)

在for循环的每一次迭代中，变量line将引用文件的下一行。在第一次迭代中，变量line指向的行是'The three lines in...'；在第二次迭代中，变量line行指向的行是'\n'；在最后一次迭代中，它指的行是'There is a blank...'。因此，在任何时间点，只有一行文件需要保存在内存中。

练习题4.10　实现函数myGrep()，带2个输入参数：文件名和目标字符串，输出文件中所有包含目标字符串作为子串的行。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08303.jpeg)