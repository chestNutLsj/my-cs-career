   

### 8.4.3　构造函数和repr()运算符之间的约定

上述注意事项表明，重载运算符repr()的输出应该是对象的规范字符串表示形式。Point对象Point(3,5)的规范字符串表示形式是'Point(3,5)'。同样Point对象的repr()运算符的输出结果为：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08879.jpeg)

结果好像满足构造函数和表示运算符repr()之间的约定：它们相同。验证如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08880.jpeg)

什么地方出错了？

问题与构造函数或运算符repr()无关，而是与运算符==有关：它并不认为两个具有相同坐标值的点一定相等。验证如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08881.jpeg)

这种奇怪行为的原因是，对于用户自定义的类，操作符==的默认行为是只有当我们比较的两个对象是同一个对象时才返回True。让我们证明这个事实：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08882.jpeg)

正如表8-3所示，对应于重载运算符==的方法是__eq__()。要改变重载运算符==的行为，我们需要在类Point中实现方法__eq__()。我们在类Point的最终版本实现了该方法：

模块：ch8.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08883.jpeg)

类Point的新实现还支持==运算符，使得其运算符合预期的意义：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08884.jpeg)

同时，类Point的新实现也满足构造函数和运算符repr()之间的约定：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08885.jpeg)

练习题8.6　在Card类中实现重载运算符repr()和==。新的Card类的运行结果如下所示：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08886.jpeg)