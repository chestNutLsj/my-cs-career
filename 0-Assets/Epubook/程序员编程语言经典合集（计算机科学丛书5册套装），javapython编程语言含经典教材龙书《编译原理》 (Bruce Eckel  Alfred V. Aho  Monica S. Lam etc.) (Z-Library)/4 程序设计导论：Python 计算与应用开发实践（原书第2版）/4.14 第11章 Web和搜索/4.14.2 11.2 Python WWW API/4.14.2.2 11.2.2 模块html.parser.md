   

### 11.2.2　模块html.parser

模块urllib.request提供用来在万维网上请求和下载资源（如网页）的工具。如果下载的资源是一个HTML文件，我们可以把它读取到一个字符串，使用字符串运算符和方法进行处理。这可能足以回答一些关于Web页面内容的问题，但是，如果要在网页中拾取与锚点标记相关联的所有URL呢？

如果花点时间仔细思考，你将发现使用字符串运算符和方法来查找HTML文件中的所有锚点标记URL会相当混乱。虽然我们很清楚需要做什么：遍历文件并拾取每个锚点开始标记的href属性的值。然而，要做到这一点，我们需要一种方法来识别HTML文件的不同元素（文档标题、文字标题、链接、图像、文本数据，等等），尤其是锚点元素的开始标记。对文档进行分析以将其分解成组件并获取其结构的过程称为解析。

Python标准库模块html.parser提供了一个类HTMLParser，用于解析HTML文件。当传递一个HTML文件给它时，它将从头到尾处理源文件，找到源文件的所有开始标记、结束标记、文本数据和其他组件，并“处理”每一个元素。

为了说明HTMLParser对象的使用方法并描述“处理过程”的含义，我们使用11.1节中的HTML文件w3c.html。

回顾文件w3c.html的开头部分为：

文件：w3c.html

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09250.jpeg)

HTMLParser类支持方法feed()，带一个输入参数：一个HTML源文件的内容（字符串形式）。因此，要解析w3c.html文件，我们首先要把该文件读取到一个字符串中，然后传递给解析器：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09251.jpeg)

当执行最后一行语句（即当字符串内容被传递到解析器）时，后台将执行下列处理：解析器将字符串content分解成标记符号，对应于HTML开始标记、结束标记、文本数据和其他HTML组件，然后按照它们出现在源文件中的顺序处理这些符号。这意味着，对于每个符号，调用适当的处理方法。这些处理方法是类HTMLParser的方法。类HTMLParser的一些方法列于表11-1中。

表11-1　HTMLParser处理方法。调用这些方法时不会执行任何操作，需要重载这些方法实现期望的行为

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09252.jpeg)

当解析器遇到一个开始标记符号时，调用标记处理程序方法handle_starttag()；如果解析器遇到文本数据符号，则调用处理程序方法handle_data()。方法handle_starttag()带两个输入参数：开始标签元素名称和一个包含标签属性的列表（如果标签不包含属性则为None）。每个属性都由一个元组来表示，存储属性的名称和值。方法handle_data()只包含一个输入参数：文本数据。图11-4说明了解析文件w3c.html的过程。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09253.jpeg)

图11-4　解析HTML文件w3c.html。按出现顺序处理各标记符号。第一个符号（开始标记<html>）调用handle_starttag()处理。下一个符号是标记<html>和<head>之间的字符串，包含一个换行符和一个空格，被看作文本数据，调用handle_data()处理

HTMLParser类处理方法（如handle_starttag()）究竟执行什么操作？好吧，什么也不做。该类处理方法的实现什么也不做。这就是我们执行时没有什么有趣的事情发生的原因：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09254.jpeg)

HTMLParser类处理方法实际上旨在被用户自定义处理程序重载，实现程序员期望的行为。换言之，类HTMLParser不应该直接使用，而是作为一个超类，开发人员从该类派生出一个解析器解析，实现程序员期望的行为。