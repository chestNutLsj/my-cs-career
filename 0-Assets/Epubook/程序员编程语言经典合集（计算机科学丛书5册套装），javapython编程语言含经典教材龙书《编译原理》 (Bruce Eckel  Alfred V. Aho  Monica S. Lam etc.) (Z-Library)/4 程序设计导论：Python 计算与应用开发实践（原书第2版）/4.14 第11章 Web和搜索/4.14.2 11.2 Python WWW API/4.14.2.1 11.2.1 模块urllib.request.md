   

### 11.2.1　模块urllib.request

我们通常使用浏览器访问Web上的Web页面。然而，浏览器仅仅是一种类型的Web客户端，任何程序都可以作为Web客户端访问和下载资源。在Python中，标准库模块urllib.request给开发者提供了这种能力。该模块包含函数和类，允许Python程序以类似于打开和读取文件的方式来打开和读取Web上的资源。

在模块urllib.request中的函数urlopen()类似于用来打开（本地）文件的内置函数open()。然而，存在三个不同之处：

1.urlopen()带一个URL而不是本地文件路径名作为输入参数；

2.它会将HTTP请求发送到托管内容的Web服务器；

3.它返回一个完整的HTTP响应。

在下面的例子中，我们使用函数urlopen()请求和接收托管在万维网上的服务器上的文件：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09240.jpeg)

函数urlopen()返回对象的类型是HttpResponse，这是一个定义在标准库模块http.client中的类型。这种类型的对象封装了服务器的HTTP响应。正如我们在前面看到的，HTTP响应包括请求的资源，但也包括附加信息。例如，HttpResponse方法geturl()返回请求的资源的URL：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09241.jpeg)

要获得所有HTTP响应头字段，可以使用如下的方法getheaders()：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09242.jpeg)

（省略了部分头字段。）

函数urlopen()返回的HttpResponse对象包含请求的资源。HttpResponse类被称为一个类文件类，因为它支持方法read()、readline()和readlines()，与打开文件的函数open()返回的对象类型支持同样的方法。所有这些方法都检索请求资源的内容。例如，让我们使用方法read()：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09243.jpeg)

方法read()将返回该资源的内容。例如，如果文件是一个HTML文档，那么其内容被返回。然而，请注意方法read()返回一个bytes类型的对象。这是因为urlopen()打开的资源可能是音频或视频文件（即二进制文件）。urlopen()的默认行为是假设资源是一个二进制文件，当读取文件时，返回一个字节序列。

如果资源恰好是一个HTML文件（即一个文本文件），那么将字节序列解码为它们所表示的Unicode字符是有意义的。我们使用bytes类的decode()方法（在6.3节中讨论）来实现解码：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09244.jpeg)

（省略了很多行内容。）将HTML文档解码为Unicode字符串是有意义的，因为一个HTML文档是一个文本文件。一旦解码成字符串，我们就可以使用字符串运算符和方法来处理文档。例如，我们现在可以找到字符串“Web”出现在网页的源文件中的次数。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09245.jpeg)

结果如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09246.jpeg)

基于前面所学到的知识，我们可以编写一个函数，带一个输入参数：一个网页的URL，返回网页的源文件内容（作为一个字符串）：

模块：ch11.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09247.jpeg)

让我们在Google网页上测试：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09248.jpeg)

练习题11.1　编写函数news()，带两个参数：一个新闻网站的URL以及一个主题词（即字符串）的列表。计算在新闻中每个主题词出现的次数：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09249.jpeg)