   

### 12.3.3　MapReduce的抽象概念

在上一节中我们用来计算单词频率的MapReduce方法似乎是一种笨拙而奇怪的计算词频的方法。可以把它看作是我们在第6章所讨论的基于字典的方法的一个更复杂版本。然而，MapReduce方法有其优点。第一个优点是该方法是一个通用方法，适用于一系列的问题。第二个优点是，它适合于使用多个计算节点而不是一个来实现，计算节点可以是中央处理器（CPU）上的多个核心，还可以是云计算系统中的数千个节点。

下一节我们将深入探讨第二个优点。现在要做的是对MapReduce的步骤进行抽象，以使得通过简单地定义特定的Map函数和Reduce函数，就可以让该框架用于一系列不同的问题。简而言之，我们的目标是开发一个SeqMapReduce类，可以按下列方式方便地计算词频：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09380.jpeg)

我们可以使用SeqMapReduce对象smr计算其他东西的频率。例如，计算数值的频率：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09381.jpeg)

此外，通过指定其他特定问题的Map函数和Reduce函数，我们可以解决其他问题。

这些规范建议类SeqMapReduce应该包含一个以Map和Reduce函数作为输入参数的构造函数。方法process应该带一个包含数据的可迭代对象作为参数，并执行Map、Partition和Reduce步骤：

模块：ch12.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09382.jpeg)

注意事项：MapReduce的输入应该为不可变对象

假设我们希望计算列表lists的子列表的频率：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09383.jpeg)

看起来似乎可以采用与计算字符串和数值的相同的方法：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09384.jpeg)

结果呢？发生了什么？问题的根源在于列表不能作为函数partition()实现中的字典dct的键。我们的方法只适用于可哈希的、不可变对象数据类型。如果把列表更改为元组，我们可以完成任务：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09385.jpeg)