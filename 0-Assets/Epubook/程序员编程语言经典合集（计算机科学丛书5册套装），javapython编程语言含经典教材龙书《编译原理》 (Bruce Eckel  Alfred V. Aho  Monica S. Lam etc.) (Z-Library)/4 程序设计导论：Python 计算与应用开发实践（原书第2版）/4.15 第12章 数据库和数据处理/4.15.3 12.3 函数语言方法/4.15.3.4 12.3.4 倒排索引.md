   

### 12.3.4　倒排索引

接下来，我们应用MapReduce框架来解决倒排索引问题（也被称为反向索引问题）。这个问题有很多版本。我们考虑的版本是：给定一组文本文件，找出哪个词出现在哪个文件中。这个问题的一种解决方案可以表示为映射每个单词到包含它的文件列表的映射。这种映射称为倒排索引。

例如，假设我们要为如图12-14所示的文本文件a.txt、b.txt和c.txt构建倒排索引。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09386.jpeg)

图12-14　三个文本文件。倒排索引把每个单词映射到包含单词的文件

例如，倒排索引会把'Paris'映射到列表['a.txt','c.txt']，'Quito'映射到['b.txt']。因此倒排索引应该为：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09387.jpeg)

要使用MapReduce来获取倒排索引，我们必须定义Map和Reduce函数，把文件名列表

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09388.jpeg)

作为参数，产生倒排索引。图12-15显示了这些函数如何工作。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09389.jpeg)

图12-15　倒排索引问题的MapReduce。Map步骤为文件中的每一个word创建一个元组(word,file)。Partition步骤收集相同word的元组。Partition步骤的输出结果是期望的倒排索引，把单词映射到包含单词的文件。Reduce步骤没有对Partition步骤的输出结果做任何修改

在Map阶段，Map函数为每个文件创建一个列表。这个列表包含文件中的每个单词的元组(word,file)。函数getWordsFromFile()实现了Map函数：

模块：ch12.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09390.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09391.jpeg)

注意，这个Map函数返回一个集合，而不是一个列表。这不是问题，因为唯一的要求是返回一个可迭代的容器。我们使用集合的理由是可以保证没有重复项[(word,file)]，因为重复项没有必要，只会降低Partition和Reduce步骤的速度。

Map步骤完成后，Partition函数将把所有相同word值的元组(word,file)结合在一起并合并成一个元组(word,files)，其中files是包含word的所有文件的列表。换言之，Partition函数构造了倒排索引。

这意味着不需要Reduce步骤执行任何操作。Reduce函数仅仅把项拷贝到结果列表——倒排索引。

模块：ch12.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09392.jpeg)

要计算倒排索引，只需要执行如下操作：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09393.jpeg)

练习题12.6　开发一个基于MapReduce的解决方案，构建一个单词列表的倒排“字符索引”。要求索引把至少出现在一个单词中的字符映射到包含该字符的单词列表。你的工作包含设计Map函数getChars()和Reduce函数getCharIndex()。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09394.jpeg)