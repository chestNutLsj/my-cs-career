   

### 12.3.2　MapReduce问题求解框架

我们最后一次考虑的是计算字符串中每个单词的出现频率的问题。我们使用这个例子来引入字典容器类，并开发一个非常简单的搜索引擎。我们现在基于这个问题来创建一种被称为MapReduce的新方法，MapReduce由谷歌公司开发用于解决数据处理问题。

假设我们想计算列表中每个单词的出现频率：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09371.jpeg)

使用MapReduce方法解决该问题包括三个步骤：

首先，为列表words中的每个word创建一个元组：(word,1)。(word,1)对被称为(key,value)对，每个键word的值1捕获一个单词特定实例的计数。注意，对原始列表words中出现的每个word都有一个(word,1)对。

每个(key,value)对保存在自己的列表中，所有这些单个元素列表都包含在列表intermediate1中，如图12-13所示。

MapReduce的中间步骤是把所有包含相同word的[(word,1)]列表组合在一起创建一个新的(key,value)对(word,[1,1,…,1])，其中[1,1,…,1]是所有值1组合在一起的列表。注意，对原始列表words中的每个单词word在[1,1,…,1]中都有一个1。我们把中间步骤获得的(key,value)对的列表称为intermediate2（参见图12-13）。

在最后一步，intermediate2中每个(word,[1,1,…,1])的1累加起来，如图12-13所示。我们把最后的(key,value)对列表称为frequency。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09372.jpeg)

图12-13　MapReduce用于单词频率。使用列表解析把列表words中的每个单词映射到[(word,1)]。这些新的列表被存储到列表intermediate1中。然后intermediate1中的所有包含相同word的[(word,1)]列表组合在一起创建元组(word,[1,1,…,1])。在最后一步，这些元组中的1累加到变量count，并把元组(word,count)添加到列表frequency中

让我们看看如何在Python中实现这些步骤。首先基于列表words通过应用函数occurrence()为列表words中的每个单词构建一个新的列表：

模块：ch12.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09373.jpeg)

使用列表解析，我们可以把MapReduce的第一步简洁表述如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09374.jpeg)

这一步被称为MapReduce的Map（映射）步骤，函数occurrence()被称为词频问题的Map函数。

注意事项：Map步骤返回一个元组的列表

函数occurrence()返回一个只包含一个元组的列表。你可能会疑惑它为什么不返回元组本身？

其原因是我们的目标不仅仅是解决词频问题。我们的目标是开发一个通用的框架，可以用来解决一系列问题。对于词频问题以外的问题，Map步骤可能不仅仅返回一个元组。我们将在本节后面看到一个例子。因此，我们坚持将Map函数返回一个元组列表。

MapReduce的中间步骤称为Partition（分区）步骤，将intermediate1的子列表中key相同的所有对组合起来：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09375.jpeg)

对于每个唯一的key，创建一个新的(key,values)对，其中values是列表[value1,value2,…,valuek]。这个步骤封装在函数partition()中：

模块：ch12.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09376.jpeg)

函数partition()带一个参数：intermediate1。构建列表intermediate2：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09377.jpeg)

最后一步是针对intermediate2中的每个(key,values)对，通过累加values中的值来构建一个新的(key,count)对：

模块：ch12.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09378.jpeg)

同样，列表解析为执行此步骤提供了一个简洁的方法：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09379.jpeg)

这被称为MapReduce的Reduce（减少）步骤。函数occurrenceCount()被称为词频问题的Reduce函数。