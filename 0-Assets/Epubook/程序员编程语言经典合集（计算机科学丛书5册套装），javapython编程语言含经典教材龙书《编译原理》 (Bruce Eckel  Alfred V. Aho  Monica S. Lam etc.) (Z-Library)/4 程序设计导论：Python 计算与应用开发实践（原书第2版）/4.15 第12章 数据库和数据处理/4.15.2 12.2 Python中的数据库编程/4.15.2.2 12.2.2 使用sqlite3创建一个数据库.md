   

### 12.2.2　使用sqlite3创建一个数据库

接下来我们通过回顾扫描网页，并将其中的超链接URL及单词出现的频率保存到数据库所需要的必要步骤，来展示sqlite3数据库API的使用方法。首先，我们需要创建一个与数据库文件的连接，它相当于打开一个文本文件：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09335.jpeg)

函数connect()是模块sqlite3中的一个函数，带一个输入参数：一个数据库文件名（位于当前工作目录中），返回一个类型Connection（定义在模块sqlite3中的类型）的对象。Connection对象与数据库文件关联。在上述语句中，如果在当前工作目录中存在数据库文件web.db，则Connection对象con表示该数据库文件；否则，会创建一个新的数据库文件web.db。

当我们创建了一个与数据库相关联的连接（Connection）对象后，我们需要创建一个游标对象，用于执行SQL语句。Connection的类方法cursor()返回一个Cursor类型的对象：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09336.jpeg)

Cursor对象是数据库处理的主要对象。它提供了一个方法execute()，带一条SQL语句（作为字符串）作为参数并执行该语句。例如，要创建数据库表Keywords，只需要把SQL语句作为字符串参数传递给方法execute()：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09337.jpeg)

创建了表Keywords之后，我们就可以插入记录了。只需要把SQL的INSERT INTO语句作为输入参数传递给execute()方法：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09338.jpeg)

在这个例子中，插入到数据库中的值（'one.html'、'Beijing'和3）在SQL语句的字符串表达式中是“硬编码”。一般情况并非如此，因为通常在程序中执行的SQL语句使用来自Python变量的值。为了构造使用Python变量值的SQL语句，我们使用类似于字符串格式化的技术，称之为参数替换。

例如，假如我们希望插入一条新的记录到数据库中，新记录包含值：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09339.jpeg)

我们像往常一样构造SQL语句字符串表达式，但是将一个“?”符号作为占位符，表示Python变量值所处的位置。这对应于execute()方法的第一个参数。第二个参数是一个包含三个变量的元组：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09340.jpeg)

元组的每个值都映射到一个占位符，如图12-10所示。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09341.jpeg)

图12-10　参数替换。在SQL字符串表达式中占位符“?”被替换为对应的变量值

我们也可以事先把所有的值组合成一个元组：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09342.jpeg)

注意事项：安全问题—SQL注入

可以使用格式化字符串和字符串format()方法构造SQL语句的字符串表达式。然而，这是不安全的，因为它易受被称为“SQL注入攻击”的安全攻击。当然不应该使用格式化字符串来构造SQL表达式。