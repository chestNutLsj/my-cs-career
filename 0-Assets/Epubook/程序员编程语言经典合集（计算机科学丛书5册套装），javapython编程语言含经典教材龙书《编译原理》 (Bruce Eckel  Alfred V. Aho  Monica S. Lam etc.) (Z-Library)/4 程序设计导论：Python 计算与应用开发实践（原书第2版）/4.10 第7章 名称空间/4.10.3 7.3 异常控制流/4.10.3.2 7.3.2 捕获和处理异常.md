   

### 7.3.2　捕获和处理异常

一些程序当抛出异常时不应该终止运行：服务器程序、命令行程序、以及几乎所有处理请求的程序。由于这些程序接收来自程序外的请求（与用户或文件交互），很难确保程序不会因为输入错误而进入错误状态。即使内部错误发生，这些程序也需要继续提供服务。这意味着，必须改变当发生错误时输出错误消息并终止程序的默认行为。

我们可以通过指定发生异常时的替代行为来更改默认的异常控制流。我们使用try/except语句对实现该功能。下面这个小应用程序演示了如何使用它们：

模块：age1.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08696.jpeg)

应用程序请求用户交互式输入其年龄。用户输入的值是一个字符串。输出前被转换为一个整数值。请读者尝试运行！

只要用户输入的值能够转换为一个整数，这个程序就能正常运行。但是，如果用户输入“fifteen”，结果会如何呢？

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08697.jpeg)

因为字符串'fifteen'无法转换为一个整数，所以引发了异常ValueError。

执行语句age=int(strAge)时除了“崩溃”处理之外，更好的处理方式是提示用户输入十进制数字的年龄。我们可以通过下面的try和except语句对来实现此功能：

模块：age2.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08698.jpeg)

try语句和except语句联手工作。各自下面具有其缩进代码。try语句下面的代码块（从第二行到第六行）首先被执行。如果没有发生错误，则except下面的代码块被忽略：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08699.jpeg)

然而，如果在执行try语句块的过程中引发了异常（例如，strAge无法转换到一个整数），则Python解释器将跳过try语句块中的后续语句，并执行except语句块中的语句（即从第八行到第十行）：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08700.jpeg)

注意：try语句块的第一条语句被执行，但不是最后一条被执行的语句。

try/except语句对的语法格式如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08701.jpeg)

首先尝试执行<缩进代码块1>。如果执行顺利没有引发异常，则忽略<缩进代码块2>，继续执行<非缩进语句>。然而，如果在执行<缩进代码块1>过程中引发了一个异常，则<缩进代码块1>中剩余的语句不会被执行，而是执行<缩进代码块2>。如果<缩进代码块2>运行完成并且没有引发新的异常，则继续执行<非缩进语句>。

代码块<缩进代码块2>被称为异常处理程序，因为它处理引发的异常。我们也称一个except语句捕获一个异常。