   

### 7.3.6　控制异常流

本节开始以一个例子演示了异常如何中断程序的正常流程。现在我们讨论如何使用适当放置的异常处理程序来控制异常流。我们再次使用在模块stack.py中定义的函数f()、g()和h()作为示例。

模块：stack.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08710.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08711.jpeg)

在图7-10中，我们说明了对f(2)求值如何引发一个异常。当执行f(0)时，尝试对1/0求值会引发ZeroDivisionError异常。因为在函数调用h(0)、g(1)和f(2)中都没有捕获该异常对象，这些函数都会被中断，默认异常处理程序会处理该异常，如图7-10所示。

假如我们希望捕获抛出的异常，处理并输出'Caught!'，然后继续正常的程序流。如何编写try代码块和捕获异常，有几种不同的处理方法供选择。其中一种方法是把最外层的函数调用f(2)放置在一个try代码块中（如图7-11所示）：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08712.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08713.jpeg)

图7-11　使用一个异常处理程序执行f(2)。在一个try代码块中运行f(2)。程序正常运行，直到执行h(0)时抛出了一个异常。正常执行流程被中断：函数h(0)执行没有完成，g(1)和f(2)也没有完成。虚线显示了异常执行流程。没有被执行的语句显示为灰色。对应于try语句块的except语句捕获异常，匹配的处理程序处理该异常

图7-11的执行流程与图7-10中描述的平行一致，直到从命令行发出函数调用f(2)被一个引发的异常中断。因为函数调用位于一个try语句块，因此该异常被对应的except语句捕获并由其异常处理程序处理。输出结果包含异常处理程序输出的字符串'Caught!'：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08714.jpeg)

与这段执行流程相比，图7-10使用默认异常处理程序处理异常。

在上一个例子中，我们选择在调用函数f(2)时实现异常处理程序。这体现了函数f()开发人员的设计决策，也就是函数用户才比较关注异常处理。

在下一个示例中，函数h()开发人员的设计决策是，函数h()才应该处理其执行过程中发生的异常。在这个例子中，函数h()内原本的代码修改为位于一个try语句块中：

模块：stack2.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08715.jpeg)

（函数f()和g()与stack.py中的函数定义一模一样。）当运行f(2)时，结果如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08716.jpeg)

图7-12描述了其执行流程。执行流程与图7-11中平行一致，直到对1/0求值时引发了异常。由于求值处于一个try语句块，因此对应的except语句捕获了该异常。关联的异常处理程序输出'Caught!'。当异常处理程序执行完毕，继续执行正常的执行控制流程，函数h(0)、g(1)和f(2)都执行完毕。

练习题7.4　假设对stack.py做如下修改，则运行f(2)时，模块stack.py中的哪些语句不会被执行？

（a）仅在h()中添加try语句封装语句print(1/n)。

（b）在g()中添加try语句封装三行语句。

（c）仅在g()中添加try语句封装语句h(n-1)。

上述各种情况下，与try语句块关联的异常处理程序仅仅输出'Caught!'。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08717.jpeg)

图7-12　执行f(2)，在h()中包含一个异常处理程序。正常执行流程显示为黑色箭头。当尝试对1/n=1/0求值时，引发了ZeroDivisionError异常，正常执行流程中断。虚线显示了异常执行流程，没有被执行的语句显示为灰色。由于异常发生在try语句块中，因此对应的except语句捕获该异常，关联的异常处理程序处理该异常。然后恢复执行正常执行流程，函数h(0)、g(1)和f(2)都执行完毕