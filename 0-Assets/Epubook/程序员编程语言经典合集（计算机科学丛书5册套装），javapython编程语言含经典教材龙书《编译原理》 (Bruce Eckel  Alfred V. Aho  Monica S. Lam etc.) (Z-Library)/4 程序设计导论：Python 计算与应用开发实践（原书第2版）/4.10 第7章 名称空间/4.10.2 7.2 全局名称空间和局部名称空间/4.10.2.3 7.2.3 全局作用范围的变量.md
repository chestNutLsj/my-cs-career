   

### 7.2.3　全局作用范围的变量

在这个例子中，我们从模块scope1中删除第二行代码，得到模块scope2：

模块：scope2.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08685.jpeg)

当我们运行模块scope2时，将调用函数f(3)。图7-7显示了函数调用f(3)执行时所涉及的变量及其定义的名称空间。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08686.jpeg)

图7-7　全局变量。在执行第5行的函数调用f(3)过程中，计算乘积a*b时，变量a被求值。因为在函数调用名称空间中不存在名称a，所以使用在全局名称空间中定义的名称a

在执行f(3)的过程中，当计算乘积a*b的运算结果时，在函数调用f(3)相关联的名称空间中不存在局部变量a。变量a使用的是全局变量a，其值为0。运行该程序时，结果如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08687.jpeg)

Python解释器如何确定一个名称是局部名称还是全局名称？

无论什么时候，当Python解释器需要确定一个名称（变量、函数，等等）的求值结果时，将按下列顺序搜索名称定义：

1.首先在包括该名称的函数调用名称空间

2.然后在全局（模块）名称空间

3.最后在builtins模块的名称空间

在我们的第一个例子模块scope1中，乘积a*b中的名称a解析为局部名称；在第二个例子模块scope2中，因为在函数调用的局部名称空间中没有名称a，所以a解析为全局名称a。

内置名称（例如sum()、len()、print()，等等）是builtins模块中预定义的名称，Python启动时自动导入该模块（我们将在7.4节中详细讨论内置模块）。图7-8显示了模块scope2中函数调用f(3)执行时存在的不同名称空间。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08688.jpeg)

图7-8　查找名称定义。运行模块scope2时，在执行f(3)的过程中，存在三个名称空间。每当Python解释器需要解析一个名称时，它开始在局部名称空间中查找。如果没有查到，则接着在全局名称空间中查找。如果还没有查到，在移动到builtins名称空间中查找

图7-8描述了在执行f(3)时，当执行函数f()的第二行的语句print(a*b)过程中如何解析名称。print(a*b)的执行包含三个名称查找，所有的查找都是从函数调用f(3)的局部名称空间中开始：

1.Python解释器首先查找名称a。首先在函数f(3)的局部名称空间中查找。因为不存在，所以继续在全局名称空间中查找，结果发现名称a。

2.名称b的查找开始并结束于局部名称空间。

3.（函数）名称print的查找是从局部名称空间中开始，接着在全局名称空间中查找，最后在模块builtins名称空间中成功查找到。