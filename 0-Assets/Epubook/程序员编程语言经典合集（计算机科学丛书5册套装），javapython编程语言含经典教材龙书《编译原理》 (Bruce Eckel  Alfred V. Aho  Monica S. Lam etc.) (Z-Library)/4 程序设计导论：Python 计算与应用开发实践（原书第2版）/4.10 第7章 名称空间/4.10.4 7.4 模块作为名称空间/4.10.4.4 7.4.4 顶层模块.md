   

### 7.4.4　顶层模块

计算机程序通常被拆分为多个文件（即模块）。在每一个Python程序中，其中一个模块是特殊的：它包含“主程序”，我们指的是启动应用程序的代码。这个模块称为顶层模块。其余模块本质上是“库”模块，由顶级模块导入，包含应用程序使用的函数和类。

我们已经看到，当一个模块被导入时，Python解释器在模块名称空间中创建一些“记账”变量。其中一个变量是__name__。Python将以下列方式设置它的值：

·如果模块是作为一个正在运行的顶层模块，则其属性__name__被设置为字符串__main__。

·如果该文件被另一个模块（不管顶层模块或其他模块）导入，则其属性__name__被设置为模块的名字。

我们使用下一个模块来说明__name__如何被赋值：

模块：name.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08730.jpeg)

当从命令行中运行该模块（例如，在IDLE中按【F5】），它作为主程序运行（即顶层模块）：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08731.jpeg)

因此，导入的模块的__name__属性被设置为__main__。

知识拓展：顶层模块和模块搜索路径

在上一小节中，我们提到，包含顶层模块的目录包括在搜索路径列表中。让我们检查一下情况是否确实如此。首先运行前述模块name.py（假设被保存在目录/Users/me）。然后检查sys.path的值：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08732.jpeg)

注意，/Users/me/包括在搜索路径中。

当从命令行中运行时，模块name同样是顶层模块：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08733.jpeg)

然而，如果其他模块导入模块name，则name不再是顶层模块。在如下import语句中，命令行是导入模块name.py的顶层程序：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08734.jpeg)

下面是另一个示例。这个模块仅仅包含，一条导入模块name.py的语句：

模块：import.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08735.jpeg)

当从命令行运行模块import.py，它作为主程序运行，并导入模块name.py：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08736.jpeg)

两种情况下，导入模块的__name__属性均被设置为模块的名称。

在模块中编写仅当作为顶层模块运行时才执行的代码时，模块的__name__属性才发挥作用。例如，如果模块是一个包含函数定义的“库”模块，而我们希望在模块中添加仅当模块作为顶层模块才运行的调试代码的情况。只需要把所有的调试代码作为下列if语句的语句块即可：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08737.jpeg)

如果模块作为顶层模块运行，则代码块将被执行；否则，不会被执行。

练习题7.6　在模块example.py中添加代码，调用模块中定义的函数并输出模块中定义的变量的值。仅当模块作为顶层代码运行时才执行添加的代码，例如从命令行中运行：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image08738.jpeg)