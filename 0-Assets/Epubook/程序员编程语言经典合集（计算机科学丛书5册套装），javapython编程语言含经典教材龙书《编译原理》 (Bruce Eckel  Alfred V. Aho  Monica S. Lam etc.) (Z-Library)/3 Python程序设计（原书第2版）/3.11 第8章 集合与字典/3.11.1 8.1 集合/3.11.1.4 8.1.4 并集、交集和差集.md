   

### 8.1.4　并集、交集和差集

两个集合的并集包含两个集合中的所有元素，去除重复的元素（见图8-4）。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07082.jpeg)

图8-4　两个集合的并集

在Python中使用union方法创建两个集合的并集，例如：

![](../Images/image07083.gif)

british和italian集合都包含颜色"Red"和"White"，但是并集也是集合，所以只包含每个颜色的一个实例。

注意，union方法返回一个新集合，调用时不会修改任何一个集合。

两个集合的交集包含所有同时属于两个集合的元素（见图8-5）。

为了创建两个Python集合的交集，使用intersection方法：

![](../Images/image07084.gif)

最后，两个集合的差集得到一个新集合，其中包含属于第一个集合但不属于第二个集合的那些元素。例如，Italian颜色和British颜色的差集是只包含"Green"的集合（见图8-6）。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07085.jpeg)

图8-6　两个集合的差集

使用difference方法得到集合的差集：

![](../Images/image07086.gif)

在组成两个集合的并集或交集时，顺序并不重要。例如，british.union(italian)和italian.union(british)是同样的集合。但是difference方法的顺序是有关系的。

![](../Images/image07087.gif)

返回的集合是{"Blue"}。

下面的程序显示了集合的实际应用。程序读取一个包含正确拼写单词的文件并把单词放入一个集合。然后从文档中读取所有单词，这里以《Alice in Wonderland》这本书为例，并放入第二个集合。最后，输出文档所有单词中不在正确拼写单词集合中的那些单词。这些可能是有拼写错误的。（你从输出中可以看到，我们使用的是美国单词清单，那么像clamour这样英式拼写的单词会被标记为有潜在拼写错误的。）

表8-1给出了常用的集合操作。

表8-1　常用集合操作

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07088.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07089.jpeg)

ch08/sec01/spellcheck.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07090.jpeg)

程序运行结果

![](../Images/image07091.gif)

![](../Images/image07092.gif)

自测题

1.编写代码确定集合s是否是集合t的真子集。一个集合是另一个集合的真子集，当且仅当它是子集并且两个集合不相等。

2.编写代码输出同时属于集合s和集合t的所有字符串。

3.编写代码输出属于集合s但不属于集合t的所有字符串。

4.下面代码片段的输出是什么？

![](../Images/image07093.gif)

5.下面代码片段的输出是什么？

![](../Images/image07094.gif)

练习它　现在你可以尝试本章最后的练习：R8.19，P8.9。

编程实战8.1　统计唯一单词

问题描述　确定一个文本文档中包含的唯一单词的数量。例如，童谣“Mary had a little lamb”包含57个唯一单词。你的任务是编写程序读取一个文本文档并确定其中唯一单词的数量。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　理解处理任务。

为了统计文本文档中唯一单词的数量，我们需要处理每个单词并确定这个单词在文档前面是否已经出现过。只有单词的第一次出现应该被统计为唯一单词。

解决这个任务最容易的方式是从文件中读取每个单词并放入一个集合中。因为集合不能包含重复元素，add方法会阻止前面遇到过的单词进入集合。处理完文档中的每个单词之后，集合的大小就是文档中包含的唯一单词的数量。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　把任务分解为多个步骤。

这个问题可以分解为几个简单的步骤：

![](../Images/image07095.gif)

创建一个空集合，把一个元素加入集合，每个单词都加入之后确定集合的大小，这些都是标准的集合操作。从文件中读取单词可以作为一个单独的任务来处理。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　构建唯一单词的集合。

为了构建唯一单词的集合，我们必须从文件中读取独立的单词。为了简单，我们使用常量文件名。然而，为了让程序更加通用，文件名应该由用户提供。

![](../Images/image07096.gif)

处理一个单词涉及把单词加入到单词的集合。然而，在统计唯一单词时，单词不能包含任何不是字母的字符。另外，大写的单词应该和不大写的一样统计。为了辅助处理这些特殊情况，让我们设计一个独立的函数，在加入到集合之前对单词进行“清理”。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　清理单词。

为了删除所有不是字母的字符，我们迭代字符串，每次一个字符，使用字符的小写版本构建一个新的干净的单词：

![](../Images/image07097.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　把函数组合为单个程序。

实现main函数并把它和其他函数定义放入单个文件中，下面是完整的程序：

ch08/worked_example_1/coutwords.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07098.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07099.jpeg)

程序运行结果

![](../Images/image07100.gif)

编程小提示8.1　使用Python集合而不是列表，得到高效的集合操作

在编写管理一组唯一项的程序时，集合比列表高效得多。有些程序员喜欢使用熟悉的列表，把

![](../Images/image07101.gif)

替换为

![](../Images/image07102.gif)

然而，这样的程序会慢得多。使用文件war-and-peace.txt试一下ch08/programming_tip_1/countwords2.py，这是编程实战8.1中程序的列表版本。它在我们的测试机上用时45秒，而集合版本的程序只需要4秒。

专题8.1　哈希

为了检查列表中是否包含特定的值，你需要遍历这个列表，直到找到一个匹配项或者到达列表尾部。如果列表很长的话，这是一个耗时的操作。集合能以更快的速度找到元素，因为集合不需要维护元素的顺序。在内部，Python使用一个叫作哈希表的数据结构。

哈希表的基本思想很简单。集合元素被分组为共享同样特征的更小元素组。你可以想象一个书本的哈希表为每个颜色有一个组，这样的话相同颜色的书在同一个组中。为了确定一本书是否已存在，你不需要和所有的书进行比较，而是只需要和相同颜色的组里的书进行比较。

实际上，哈希表不使用颜色，而是使用可以从元素计算得到的整数值（叫作散列码）。在Python中，hash函数用来计算散列码。下面是用来显示几个散列码的交互式会话：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07103.jpeg)

为了检查一个值是否在集合中，计算hash(value)然后与那些具有相同散列码的元素进行比较。可能会有多个元素具有相同的散列码，但是不会很多。

在Python中，你只可以使用可哈希的值来组建集合。数字和字符串可以包含在集合中。但是无法对一个可变的值（例如列表或集合）进行哈希。因此，在Python中你不能创建包含集合的集合。如果你需要把多个序列放到一起，可使用包含元组的集合（见专题6.4）。

计算与社会8.1　标准化

我们每天都能从标准化中受益。买电灯泡时，你不需要测量家里的插口和商店的电灯泡就可以确定它们是适合的。事实上，如果你买到过不标准的灯泡，那么你可能已经体验过没有标准是多么痛苦。为这样的手电筒替换灯泡会很困难，并且也不容易买到。

程序员也有类似的标准化需求。在编写Python程序时，你希望它在每一台执行Python代码的计算机上都以同样的方式工作。谁写的Python实现应该不重要。例如，有一个版本的Python是在Java虚拟机上运行的，它应该也能够正确工作。为了实现这一点，Python语言的行为必须严格定义，并且需要所有当事人都统一那个定义。技术产品行为的正式定义，如果足够详细以保证互操作性，则称作标准。

是谁制定的标准呢？类似于互联网工程任务组（Internet Engineering Task Force，IETF）和万维网联盟（World Wide Web Consortium，W3C）这样的志愿者组织已经创建了一些非常成功的标准。IETF标准化互联网上使用的协议，例如用于交换电子邮件信息的协议。W3C标准化用于网页格式的超文本标记语言（Hypertext Markup Language，HTML）。标准化在作为开放平台而不受任何一个公司控制的万维网创建过程中起到了很大的作用。

很多编程语言，例如C++和Scheme，已经被独立的标准化机构标准化了，例如美国国家标准协会（American National Standards Institute，ANSI）和国际标准化组织——简称ISO（International Organization forStandardization）（不是首字母缩写，见[http://www.iso.org/iso/about/discover-iso_isos-name.html](http://www.iso.org/iso/about/discover-iso_isos-name.html)）。ANSI和ISO是工业专业人士的协会，负责制定从汽车轮胎到信用卡形状再到编程语言的所有事物的标准。

新技术的发明者通常会希望其发明能够成为标准，以便其他生产商生产使用他们的发明的工具，这样可以增加成功的可能性。另一方面，把发明交给标准委员会，发明者可能会失去对标准的控制。

Python语言从没有被独立的标准化组织所标准化，而是依赖于Python之父——“终身慈善独裁者”Guido van Rossum领导下的一个非正式社区。缺乏标准也限制了这个语言的吸引力。例如，政府不会想使用Python开发一个持续20年的项目。毕竟，慈善独裁者并不总是存在，或者可能会停止继续做慈善。政府和大型公司通常坚持使用标准化的产品。

不幸的是，也不是所有标准都是胜任的。多数标准委员会试图编纂最佳实践并创建长时间有用的标准。有时候，这个过程会半途而废，而一个自私的生产商却成功地标准化了他们的产品，即使不是很完美。这曾经在用于办公文档的OOXML标准上发生过，这个标准使用超过5 000页列出了微软的office格式中一些过于随意和不一致的细节。在理论上，一个非常勤奋的生产商应该能够开发可互操作的产品，但是标准发布好几年之后，甚至微软也没有成功做到这一点。

作为计算机专家，你的生涯中可能会有很多次需要决定是否支持一个特定的标准。例如，在你需要生成文档时，你可能需要在HTML或OOXML之间做出选择。或者考虑一个更简单的例子。在本章中，你会学习到Python库中的容器类。更高效地实现这些容器是可能的。在自己的代码中你应该使用库里的容器呢，还是应该自己实现更好的容器呢？多数软件工程师只有在有充分理由偏离标准实现的情况下才会自己实现。