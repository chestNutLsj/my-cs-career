   

## 9.5　构造函数

构造函数定义和初始化一个对象的实例变量，这是在创建对象时自动调用的。

为了创建一个类的对象，你可以像使用函数那样使用类的名字，同时提供构造函数需要的任何参数。为了创建CashRegister类的实例，我们使用命令：

![](../Images/image07237.gif)

这个语句创建了一个对象，并且自动调用了CashRegister类的构造函数，这个构造函数不需要参数。

构造函数负责定义和初始化将会包含在该对象中的所有实例变量。构造函数完成工作之后，返回一个新创建和初始化的对象的引用。引用被保存到一个变量中，以便我们后面可以通过该对象调用方法。

Python使用特殊的名字__init__作为构造函数的名字，因为它的目的是初始化该类的一个实例：

![](../Images/image07238.gif)

注意构造函数定义中的self形参变量。每个构造函数的第一个形参变量必须是self。当构造函数被调用并创建一个新对象时，self形参变量被设置为正在被初始化的对象。

在构造函数中第一次引用一个实例变量时，实例变量被创建。例如，

![](../Images/image07239.gif)

在新创建的对象中创建一个实例变量_iterCount并把它初始化为0。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07240.jpeg)

构造函数就像一个对象的组装指令集

有时候，允许使用不同方式创建对象是很有用的。例如，我们可以通过下面的形式使用list类的构造函数创建一个空列表：

![](../Images/image07241.gif)

或者使用另一本版本的list类构造函数创建已有列表的副本：

![](../Images/image07242.gif)

语法9.1　构造函数

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07243.jpeg)

Python只允许为每个类定义一个构造函数。但是你可以定义带默认值参数的构造函数（见专题9.1）来模拟多个定义。例如，考虑一个需要两种形式构造函数的Bank-Account类：一种形式是接收初始余额，另一种形式使用默认的初始余额0。这可以通过为形参变量initialBalance包含一个默认值来实现：

![](../Images/image07244.gif)

在创建一个对象时，类的用户可以选择使用哪种形式。如果创建BankAccount对象时没有给构造函数传递参数，

![](../Images/image07245.gif)

就会使用默认值。如果给构造函数传递了值

![](../Images/image07246.gif)

那个值就会替代默认值。

自测题

19.9.2节的Counter类没有构造函数，为其提供一个。

20.考虑下面的类

![](../Images/image07247.gif)

如果使用下面的方式创建对象

![](../Images/image07248.gif)

实例变量_name的值是什么？

21.提供Person类构造函数的一个实现，使得调用

![](../Images/image07249.gif)

之后，实例变量_name的值是"unknown"。

22.如果不给CashRegister类提供构造函数，会发生什么？

23.考虑Item类，该类的对象包含两个实例变量：一个字符串类型的_description和一个浮点数类型的_price。提供构造函数的实现：

![](../Images/image07250.gif)

24.为Item类定义一个构造函数，使得允许使用下面任意一种形式来创建新的Item对象。

![](../Images/image07251.gif)

练习它　现在你可以尝试本章最后的练习：R9.9，P9.4，P9.5。

常见错误9.1　试图调用构造函数

构造函数是在创建对象时自动调用的：

![](../Images/image07252.gif)

创建对象之后，你不应该在对象上再次直接调用构造函数：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07253.jpeg)

虽然说，构造函数确实可以把CashRegister对象设置为清零的状态，但是你不应该在已有对象上调用构造函数。相反，把对象替换为新的：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07254.jpeg)

一般地，你永远不应该调用以两个下划线开头的Python方法。所有这些方法都是用于特殊的内部目的的（在这里，为了初始化一个新创建的对象）。

专题9.1　默认值参数和具名参数

在上一节中，你已经看到默认参数是如何使得使用不同形式初始化一个对象成为可能的。这个特征并不局限于构造函数。在Python中，你可以为任何函数或方法的形参变量指定默认值。例如，

![](../Images/image07255.gif)

当你使用readIntBetween("Temperature：")这样的形式调用该函数时，默认参数自动提供，就像通过readIntBetween("Temperature："，0，100)这样的形式调用一样。你可以覆盖全部或一部分默认值。例如，readIntBetween("Percent："，10)和readInt-Between("Percent"，10，100)的效果是一样的。

函数或方法调用中指定的实参按指定的顺序依次传递给函数或方法的形参变量。但是如果使用具名参数的话，你可以使用任意顺序传递参数，就像：

![](../Images/image07256.gif)

你已经见过具名参数的例子了：print函数的end参数。

使用具名参数时，你不需要为每个参数起名字。只有那些没有按序传递的形参变量的参数才必须起名字。例如，

![](../Images/image07257.gif)

这里，形参变量prompt被设置为"Price："，low被设置为它的默认值，high被设置为1000。