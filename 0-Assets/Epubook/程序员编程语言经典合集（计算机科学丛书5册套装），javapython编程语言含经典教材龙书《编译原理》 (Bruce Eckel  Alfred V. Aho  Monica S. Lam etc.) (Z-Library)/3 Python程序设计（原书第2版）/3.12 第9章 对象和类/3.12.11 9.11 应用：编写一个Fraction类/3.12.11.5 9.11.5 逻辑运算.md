   

### 9.11.5　逻辑运算

在Python中，如果一个类实现了比较运算符（==、!=、<；、<；=、>；、>；=），那么这个类的两个对象之间可以进行逻辑比较。我们在前面已经见过了__eq__方法的实现，当时是为了测试两个有理数是否相等。

接下来，我们来确定哪个有理数比另一个小。注意，d·a<；b·c时有a/b<；c/d。（两边同时乘以b·d。）

根据这个发现，小于运算符对应的__lt__方法实现如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07383.jpeg)

根据这两个关系，你可以定义另外4个，因为

·当y<；x时有x>；y

·当x不小于y时有x≥y

·当y不小于x时有x≤y

·当x不等于y时有x≠y

下面给出了Fraction类的实现。

ch09/sec11/fraction.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07384.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07385.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07386.jpeg)

自测题

44.为Fraction类增加绝对值运算必需的方法头部。

45.为本章前面定义的Counter类定义和实现一个用于字符串转换的特殊方法。

46.修改Fraction类的构造函数，使得允许创建默认值为1的分数。

47.假设我们为Fraction类增加了方法setNumerator(value)和setDenominator(value)。那会改变Fraction对象的可变性吗？解释一下你的答案。

48.如果我们增加了自测题47中的方法，这会对分子和/或分母的值的正确性有什么影响？

练习它　现在你可以尝试本章最后的练习：P9.16，P9.17，P9.18。

专题9.3　对象类型和实例

和我们定义函数和方法一样，我们已经假设用户会提供合适类型的参数。为了保证这一点，Python提供了内置函数isinstance用来检查变量引用的对象的类型。例如，9.11节中Fraction类的构造函数要求两个整数。我们可以使用isinstance函数来检查参数的类型并在必要时抛出异常：

![](../Images/image07387.gif)

如果第一个参数（numerator）引用的对象是第二个参数表示的类型（int）的一个实例，isinstance函数返回True。如果对象属于不同的类型，函数返回False。作为第二个参数的数据类型可以是内置类型（int、float、str、list、dict、set）中的任意一个，也可以是用户自定义类的名字。

isinstance函数也可以用于一个函数或方法中，允许依赖于传递的参数类型而采取不同的动作。例如，在下面的代码中，我们想把一个整数和一个有理数相加：

![](../Images/image07388.gif)

使用一个运算符时，Python调用运算符左侧对象中与该运算符对应的特殊方法。在这个例子中，会调用frac引用的Fraction对象的__add__方法，运算符右侧的值或对象被作为参数传递给该方法。我们实现的__add__方法假设右边的参数也是一个Fraction对象。为了允许整数和有理数相加，我们使用isinstance函数检查参数的类型，根据类型来采取合适的动作：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07389.jpeg)

编程实战9.2　图形：Die类

在编程实战5.4中，我们开发了一个模拟掷5个骰子的程序。在那个程序中，我们使用从上往下的设计并把每个任务分解为独立的函数。但是程序中有一部分的首要选择是实现为类。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07390.jpeg)

问题描述　定义并实现一个模拟可以在画布上投掷和绘制的六面骰子的类。然后这个类可以在其他需要投掷或绘制骰子的程序中使用。

类设计

常见的骰子有6个面，每个面上分别包含从1个点到6个点。点的数量表示这个面的值。掷骰子时，骰子停下时会有一个面朝上，这也是投掷之后这个骰子的值。

我们想设计一个类模拟6个面的骰子，投掷时可以在画布上图形化显示顶部的面。为了以这种方式使用Die类的实例，就像编程实战5.4中开发的rolldice程序中那样，这个类必须定义下面的操作：

·创建一个骰子，其位置和大小由用户提供。

·访问骰子的位置和大小。

·掷骰子。

·访问骰子顶部显示的面的值。

·设置用来绘制骰子的颜色。

·在画布上绘制骰子。

指定这些操作之后，我们需要决定在Die对象中必须保存什么数据。为了在画布上绘制骰子，需要骰子左上角的x坐标和y坐标以及大小。在前面的程序中，绘制骰子需要三种颜色：面的填充色与边框色以及点的颜色。掷骰子时，顶部的面是6个值之一。这个值必须保存为实例变量。总体来说，我们需要7个实例变量：_x、_y、_size、_value、_fillColor、_outlineColor、_dotColor。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07391.jpeg)

类实现

我们从构造函数来开始Die类的实现。为了使它尽可能可移植，我们允许用户指定骰子的大小和绘制时的左上角坐标。我们指定一个60像素的默认值来满足前面程序使用的值。在默认情况下，骰子将被绘制为白色面、黑色边框和黑色点。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07392.jpeg)

为Die类指定的几个基本操作被实现为访问器方法，简单地返回实例变量的值即可：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07393.jpeg)

![](../Images/image07394.gif)

创建一个Die对象时，构造函数会设置默认的颜色。但是我们希望用户能够改变绘制骰子时使用的颜色，所以我们创建两个修改器方法：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07395.jpeg)

为了模拟掷骰子，我们再一次使用随机数生成器来产生介于1和6之间的数字，并赋值给实例变量_value：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07396.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07397.jpeg)

最后，在画布上绘制骰子面和编程实战5.4中使用的方法一样。唯一的区别是，用来指定位置、大小和颜色的参数可以从实例变量中提取：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07398.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07399.jpeg)

Die类的完整实现在配套代码的ch09/worked_example_2/die.py模块中，ch09/worked_example2/rooldice.py程序使用这个类模拟了5个骰子的投掷。

计算与社会9.2　开源软件和免费软件

很多软件开发公司视源代码为商业秘密。毕竟，如果客户或竞争对手能够访问源代码的话，他们可能会研究这些代码并且在没有向开发商付费的情况下创建类似的程序。基于同样的原因，客户也不喜欢保密的源代码。如果公司停业或者决定不再继续支持计算机程序的话，用户就会陷入困境。他们无法修补bug或者在新的操作系统中使用该程序。幸运的是，很多软件包是作为“开源软件”发布的，使得用户有权查看、修改和重新发布程序的源代码。

能够访问源代码还不足以确保软件能够满足用户的需要。一些公司创建了监视用户或者限制访问之前购买的书籍、音乐或视频的软件。如果那个软件在服务器上或者嵌入式设备中运行，用户就无法改变它们的行为。在文章[http://www.gnu.org/philosophy/free-software-even-more-important.en.html](http://www.gnu.org/philosophy/free-software-even-more-important.en.html)中，著名计算机科学家和麦克阿瑟“天才”奖获得者理查德·斯托曼描述了“免费软件运动”，要求用户具有控制软件行为的权力。这是一个超出了为方便或者节省资金而使用开源软件的伦理立场。

理查德·斯托曼是GNU项目（[http://gnu.org/gnu/the-gnu-project.html](http://gnu.org/gnu/the-gnu-project.html)）的发起人，该项目给出了一个与UNIX兼容的操作系统的完全免费版本：GNU操作系统。GNU项目的所有程序员都有GNU通用公共许可证（GNU GPL）。这个许可证允许你按照自己的意愿制作任意多个副本，对源码进行任意修改并可以重新发布原始程序和修改后的程序，而不收取任何费用。作为回报，你必须同意你的修改也遵守这个许可证。你必须给出发布的任意改动的源代码，而任何其他人可以在同样的条件重新发布它们。GNU GPL构成了一个社会契约。软件用户很享受使用和修改软件的自由，而反过来他们又有义务分享他们使其有效的任何改进。

一些商业软件生产商攻击GPL具有病毒性质并且削弱了商业软件部门，其他公司则采取了稍微不同的策略，生产免费或者开源软件但是如果需要某些定制扩展的话再收费。为了简单，Java开发包遵守GPL，但是需要旧版本安全更新或者其他支持的公司必须向Oracle公司付费。

有时候，开源软件缺乏商业软件那样的精心打磨，因为很多程序员是对解决自己的问题感兴趣的志愿者，而不是开发一个所有人都容易使用的产品。开源软件在程序员感兴趣的领域取得了巨大成功，例如Linux内核、Web服务器和编程工具。

开源软件社区非常具有竞争力和创新能力。非常常见的情况是几个互相竞争的项目彼此借鉴，全都快速变得更加有用。由于很多程序员的参与，大家都在阅读源代码，通常意味着bug可以快速得到消除。埃里克·雷蒙德在他的著名文章“The Cathedral and the Bazaar”（[http://catb.org/~esr/writings/cathedralbazaar/cathedralbazaar/index.html](http://catb.org/~esr/writings/cathedralbazaar/cathedralbazaar/index.html)）中描述了开源开发。他写到“只要参与的人足够多，所有问题都可以快速发现和解决”。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07400.jpeg)

理查德·斯托曼，免费软件运动的发起人