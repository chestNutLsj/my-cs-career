   

### 9.11.3　特殊方法

在Python中，我们可以定义和实现一些特殊方法，当把标准的Python运算符（+、*、==、<；）作用于该类的实例时，这些特殊方法会被自动调用。这允许一种比通过名字调用方法更自然的用法。例如，为了测试两个分数是否相等，我们可以实现一个方法isequal并使用下面的形式使用它：

![](../Images/image07368.gif)

当然，我们更倾向于使用运算符==，这可以通过定义特殊方法__eq__来实现：

![](../Images/image07369.gif)

这个方法会在使用运算符==比较两个Fraction对象时自动被调用：

![](../Images/image07370.gif)

还有些特殊方法会在对象被作为参数传递给内置函数时自动被调用。例如，假设你试图使用float函数把一个Fraction对象转换为浮点数：

![](../Images/image07371.gif)

然后特殊方法__float__被调用。这里是那个方法的定义：

![](../Images/image07372.gif)

类似地，当一个对象被输出或者转换为字符串时，Python会自动调用对象的特殊方法__repr__。这个方法用来构建并返回该对象值的一个有意义的字符串表示形式。对于Fraction类，我们可以让这个方法返回包含形式为"#/#"的字符串：

![](../Images/image07373.gif)

可以为任意Python运算符定义特殊方法（见表9-1）。特殊方法通过前后各有两个下划线的名字来表示。你不应该直接调用这些特殊方法，而是使用对应的运算符或者函数，让Python自动调用这些方法。

为你创建的每个类都定义运算符似乎很诱人，但是你只应该在某个运算拥有特定的含义时才这样做。对于Fraction类，为算术运算符+、-、*、/、**和逻辑运算符==、!=、<；、<；=、>；、>；=定义特殊方法是有意义的。在接下来的几节中，我们实现其中的一部分，而把其他的作为练习。

表9-1　常用特殊方法

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07374.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07375.jpeg)