   

## 9.4　设计数据表示

对象把数据保存在实例变量中，也就是在类中声明的变量。

实现一个类时，你必须确定每个对象需要保存哪些数据。对象需要拥有执行任何方法调用必需的所有信息。

遍历所有方法并考虑它们的数据需求。从访问器方法开始是一个好主意。例如，一个CashRegister对象必须能够为getTotal方法返回正确的值。那意味着它必须要么保存了所有输入的价格并在方法调用中计算总数，要么它必须保存总数。

现在把同样的推理应用于getCount方法。如果出纳机保存了所有输入的价格，它可以在getCount方法中统计数量。否则，你需要有个变量来存储数量。

addItem方法接收一个价格作为参数，并且必须记录这个价格。如果CashRegister对象保存输入价格的列表，那么addItem方法把该价格追加到列表尾部。另一方面，如果我们决定只保存物品总金额和数量，那么addItem方法更新这两个变量。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07233.jpeg)

就像需要携带可能用到的所有物品的野外探险者一样，一个对象需要保存执行任何方法调用所需要的数据  

最后，clear方法必须为出纳机准备下一次交易，要么清空保存价格的列表，要么把总金额和数量设置为0。

我们现在已经发现了两种不同的表示对象所需数据的方法。每个方法都能工作，我们必须做出一个选择。我们会选择比较简单的一种方法：使用实例变量_totalPrice和_itemCount分别表示总价和物品数量。（其他的选择参考练习题P9.19和P9.20。）

注意，方法调用可以按任意顺序进行。例如，考虑CashRegister类，调用

![](../Images/image07234.gif)

之后，程序可以进行另一个调用：

![](../Images/image07235.gif)

你不应该假设你可以在getTotal方法调用中清除总和。你的数据表示方法应该允许方法调用按任意顺序进行，就像汽车里的人可以按他们选择的任意顺序按下不同的按钮和操纵杆。

自测题

15.下面的代码片段有什么错误？

![](../Images/image07236.gif)

16.考虑表示时间点（例如9 A.M.或3：30 P.M.）的Time类，给出两组可以用来实现Time类的实例变量。（提示：第二组可以使用军事时间。）

17.假设Time类的实现者从一种实现策略改为另一种，保持公开接口不变。使用Time类的程序员需要做什么？

18.考虑表示字母等级（例如A+或B）的Grade类，给出可以用来实现Grade类的两组不同的实例变量。

练习它　现在你可以尝试本章最后的练习：R9.6，R9.13。

编程小提示9.1　把所有实例变量设置为私有，大多数方法设置为公开

所有的实例变量都应该是私有的，而大多数方法应该是公开的。尽管大多数面向对象的编程语言提供了某种机制显式地隐藏或保护私有成员，不允许从外部访问，但Python

并没有这么做。相反，类的设计人员必须标明哪些实例变量和方法是私有的，而不违背这个私有性则是类用户的责任。

Python程序员使用以一个下划线开头的名字作为私有实例变量和方法是很常见的。单个下划线是向类用户表明那些成员是私有的标记。你必须相信类用户不会试图直接访问这些成员。这个技术可以被文档生成工具识别，并在文档中标记私有实例变量和方法。

你应该总是使用封装，其中所有实例变量都是私有的，只能使用方法来操作。

一般情况下，方法是公开的。然而，有时候你会定义一个被其他方法当作辅助函数的方法。在这种情况下，你应该把辅助方法定义为私有的，在其名字前面加上一个下划线。