   

## 9.2　实现一个简单的类

在本节中，我们会看一个非常简单的类的实现。你会看到对象如何存储它们的数据，以及方法如何访问一个对象的数据。知道一个非常简单的类是如何工作的，有助于在本章后面设计和实现更复杂的类。

我们的第一个例子是用来模拟计数器的类，一个用来统计人数的机械设备，例如可以用来数一下多少人出席了音乐会或者乘坐了巴士（见图9-1）。

只要操作员按下按钮，计数器的值就加1。我们使用click方法模拟这个操作。物理计数器有个显示器来显示当前值，在我们的模拟中，使用getValue方法来代替。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07211.jpeg)

图9-1　计数器  

下面是使用Counter类的示例。首先，我们创建该类的一个对象：

![](../Images/image07212.gif)

我们会在9.3节详细讨论对象的创建。

接下来，我们调用对象方法。首先，通过调用reset方法把计数器重置为0，然后调用两次click方法，模拟两次按下按钮。最后，调用getValue方法检查按钮被按下了几次。

![](../Images/image07213.gif)

我们可以再次调用这些方法，得到不同的结果：

![](../Images/image07214.gif)

如你所见，tally对象记住了前面方法调用的作用。

实现Counter类时，我们需要指定每个Counter对象如何存储它的数据。在这个简单的例子中，这是非常直观的。每个计数器需要一个变量来记录计数器被增加了多少次。

对象把数据存储在实例变量中。一个类的实例是该类的一个对象。这样，一个实例变量就是在该类的每个对象中都存在的一个存储位置。在我们的例子中，每个Counter对象都有一个名为_value的实例变量。按照惯例，Python中使用一个下划线开头的实例变量表示它们应该是私有的。实例变量是实现细节中不应该被这个类的用户知道的一部分，应该只能被类自己的方法访问。Python语言并没有严格限制这一点。然而，下划线表示该类用户不应该直接访问这些实例变量。

一个类的每个对象都有自己的实例变量集合。例如，如果concertCounter和boarding-Counter是Counter类的两个对象，那么每个对象都有自己的_value变量（见图9-2）。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07215.jpeg)

图9-2　实例变量

接下来，我们快速看一下Counter类的实现。一个类使用class语句实现：

![](../Images/image07216.gif)

类提供的方法被定义在类体中。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07217.jpeg)

这些钟具有共同的行为，但是每个都有不同的状态。类似地，一个类的对象也具有被设置为不同值的实例变量

类的click方法把实例变量_value加1。

![](../Images/image07218.gif)

一个方法的定义非常类似于函数，除了：

·方法定义是类定义的一部分。

·方法的第一个形参变量是self。

我们在下一节介绍方法头的语法和特殊形参变量self的用法。现在，注意到在方法内实例变量必须通过self参数引用（self._value）就足够了。

注意click方法是如何增加实例变量_value的。哪个实例变量？就是属于调用这个方法的对象的那个实例变量。例如，考虑下面的调用：

![](../Images/image07219.gif)

这个调用增加了concertCounter对象的_value变量。没有给click方法提供任何参数，即使在定义中包含了self形参变量。形参变量self引用的是当前调用该方法的对象——在这个例子中是concertCounter。

我们再看一下Counter类的其他方法。getValue方法返回_value当前的值：

![](../Images/image07220.gif)

提供这个方法使Counter类的用户可以知道特定的计数器被按下了多少次。类用户不应该直接访问任何实例变量。限制对实例变量的访问是封装的必要部分。这允许程序员对类用户隐藏类的内部实现。

reset方法重置计数器：

![](../Images/image07221.gif)

在Python中，你不用显式声明实例变量。相反，第一次给实例变量赋值时，实例变量就被创建了。在我们的示例程序中，我们在调用其他方法之前先调用reset方法，创建并初始化实例变量_value。（你会在9.5节中看到一个更加方便也是推荐使用的创建实例变量的方法。）

下面给出了完整的Counter类和相应的驱动模块：

ch09/sec02/counter.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07222.jpeg)

ch09/sec02/counterdemo.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07223.jpeg)

程序运行结果

![](../Images/image07224.gif)

自测题

5.如果在创建了tally对象之后不立刻调用reset方法，会发生什么？

6.考虑改变一下计数器的实现。不使用整数值，而是使用|字符来跟踪按下操作，就像人类可能做的那样。

![](../Images/image07225.gif)

使用这种数据表示形式，你如何实现getValue方法？

7.假设另一个程序员已经使用了原始的Counter类，为了使用自测题6中修改过的类，那个程序员必须做什么改动？

8.假设你使用具有实例变量_hours和_minutes的Clock类。在你的程序中你如何访问这些变量？

练习它　现在你可以尝试本章最后的练习：P9.1，P9.2。