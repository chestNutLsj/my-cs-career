   

## 9.6　实现方法

实现一个类时，你需要为所有方法提供方法体。实现一个方法和实现一个函数非常相似，只有一个本质区别：在方法体内访问对象的实例变量。

例如，下面是CashRegister类的addItem方法的实现。（你可以在本节后面看到其他方法。）

![](../Images/image07258.gif)

和构造函数一样，每个方法必须包含特殊的self形参变量，并且必须是第一个。当一个方法被调用时：

![](../Images/image07259.gif)

调用方法的对象（register1）的引用被自动传递给self形参变量（见图9-4）。其余的形参变量必须由方法调用的实参来提供。在前面的例子中，形参变量price被设置为2.95。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07260.jpeg)

图9-4　self引用的赋值

为了访问方法中的一个实例变量，例如_itemCount或者_totalPrice，你必须通过self引用来访问变量名。这表示你想访问调用该方法的对象的实例变量，而不是其他CashRegister对象的实例变量。

addItem方法中第一条语句是：

![](../Images/image07261.gif)

哪个_itemCount被增加了？在这个调用中，是register1对象的_itemCount。（见图9-4。）

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07262.jpeg)

增加一个物品时，它影响调用方法的出纳机对象的实例变量

当一个方法需要调用同一个对象中的另一个方法时，你要调用self对象的那个方法。假设你想为CashRegister类提供一个用来增加多个相同的物品的方法。一个很简单的方法是在新方法中重复调用addItem方法：

![](../Images/image07263.gif)

语法9.2　方法定义

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07264.jpeg)

这里，addItem方法作用在self引用的对象上，也就是调用addItems方法的那个对象。例如，在下面调用中：

![](../Images/image07265.gif)

addItem方法在register1对象上被调用了6次。

现在你已经了解了实现CashRegister类必需的所有概念。下面给出了该类完整的代码。在下一节中，你将会学到如何测试这个类。

ch09/sec06/cashregister.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07266.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07267.jpeg)

自测题

25.执行下面的语句之后，register1._itemCount、register1._totalPrice、register2._itemCount和register2._totalPrice的值是什么？

![](../Images/image07268.gif)

26.为CashRegister类实现一个方法getDollars，用来得到总交易的金额，只要美元部分而不要美分部分。

27.为CashRegister类定义和实现一个方法giveChange(self，payment)，用来给出给定付款的应找零钱，并重置出纳机准备下一个交易。

练习它　现在你可以尝试本章最后的练习：P9.19，P9.20，P9.21。

编程小提示9.2　只在构造函数中定义实例变量

Python是一门动态编程语言，包括实例变量在内的所有变量都是在运行时创建的。这样的话，在一个类的任意方法中创建实例变量都是没问题的。例如，在9.2节中，我们调用reset方法来创建实例变量_value。那只是个临时的解决方案，因为当时还没有学到构造函数。

你知道构造函数会在任何方法调用之前被调用，所以在构造函数中创建的任意实例变量都可以保证在所有方法中是可用的。相反，在普通方法中创建实例变量是危险的。考虑9.2节中的代码。如果程序员在没有调用reset方法之前就调用新创建对象的click方法，click方法试图为不存在的变量_value加1时就会出现一个运行时错误。

因此，你应该养成习惯，在构造函数中创建所有的实例变量。

专题9.2　类变量

有时候，一个值是属于类的，而不属于该类的任何对象。你可以使用类变量来实现这个目的。（类变量通常被称为“静态变量”——来自于C++语言的一个术语。）

这里是个典型的例子：我们想顺序分配银行账号。也就是说，我们想让银行账号构造函数创建的第一个账号为1001，下一个是1002，以此类推。为了解决这个问题，我们需要有一个值_lastAssignedNumber是属于类的属性，而不属于该类的任何对象。类变量是和方法在同一个级别上声明的。（相反，实例变量是在构造函数中创建的。）

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07269.jpeg)

每个BankAccount对象都有自己的实例变量_balance和_accountNumber，但是只有一个_lastAssignedNumber变量。这个变量保存在一个独立的位置，在任何BankAccount对象之外。

注意，你应使用BankAccount._lastAssignedNumber这样的形式访问类变量。

和实例变量一样，类变量应该总是设置为私有的，保证其他类的方法不能修改它们的值。然而，类常量应该是公开的。例如，BankAccount类可以定义个公开的常量值，例如

![](../Images/image07270.gif)

任何类的方法都可以使用BankAccount.OVERDRAFT_FEE的形式来访问这个常量。