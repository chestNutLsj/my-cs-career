   

## 9.7　测试一个类

在上一节中，我们完成了CashRegister类的实现。使用它你可以做什么？长远来看，你的类可能会成为一个用来完成和用户交互、把数据存入文件或其他任务的更大程序的一部分。然而，在把一个类集成到程序中之前，对类进行单独测试是一个好主意。在完整程序之外进行的隔离测试称作单元测试。

为了测试你的类，我们有两个选择。一些交互式开发环境提供了对Python shell（见编程小提示1.1）的访问，其中可以执行独立的语句。你可以通过创建一个对象，调用方法，验证是否得到预期的返回值来测试一个类。下面显示了一个用来测试CashRegister类的交互式会话：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07271.jpeg)

交互式测试非常快捷也很方便，但是有个缺点。发现并修复一个错误时，你需要再次输入测试代码。

随着你的类变得越来越复杂，你应该编写测试程序。测试程序是导入该类并包含运行该类方法的语句的驱动程序。一个测试程序通常会执行下面的步骤：

1.构造被测试类的一个或多个对象。

2.调用一个或多个方法。

3.输出一个或多个结果。

4.输出预期结果。

下面是运行CashRegister类的方法的程序。它构造了CashRegister类的一个对象，调用了三次addItem方法，然后显示getCount和getTotal方法的值。

ch09/sec07/registertester.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07272.jpeg)

程序运行结果

![](../Images/image07273.gif)

在我们的示例程序中，我们增加3次得到总金额$5.40。显示方法结果的同时，我们也显示了描述预期值的信息。

这是一个非常重要的步骤。在你运行测试程序之前，你会花费一些时间来思考预期的结果。这个思考的过程有助于你理解程序应该如何表现，也有助于在早期发现错误。

你需要把要测试的类（这里也就是CashRegister类）导入到驱动模块中：

![](../Images/image07274.gif)

运行程序的具体细节依赖于你的开发环境，但是在大多数环境中，两个模块必须保存在同一个文件夹中。

自测题

28.如何补充测试程序来测试clear方法？

29.运行registertester.py程序时，创建了多少个CashRegister对象？

30.与解释器的交互测试会话相比，registertester.py程序的优点是什么？

练习它　现在你可以尝试本章最后的练习：P9.10，P9.11，P9.24。

如何做9.1　实现一个类

实现一个类，该类对象可以执行一组特定的动作，这是很常见的任务。这个如何做会带你一步一步来完成。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07275.jpeg)

作为一个例子，考虑类Menu。这个类的对象可以显示一个菜单，例如：

![](../Images/image07276.gif)

然后这个菜单等待用户提供一个值。如果用户不提供有效值，菜单就再次显示，用户可以再次尝试。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　获取你的对象职责的一个非正式列表。

注意把自己限制到问题实际需要的特征上。对于真实世界的事物，例如出纳机或者银行账号，可能有大量的特征值得去实现。但是你的工作不是去忠实地模拟真实世界。你只需要确定那些解决特定问题实际需要的职责。

对于菜单的情况，你需要：

![](../Images/image07277.gif)

现在，查找问题描述中没有提到的隐蔽职责。对象如何创建？还有哪些活动需要发生，例如在每一笔交易之前把出纳机清零？

在菜单的例子中，考虑一下如何产生一个菜单。程序员创建一个空的菜单对象，然后增加选项“Open new account”、“Help”，等等。这是另一个职责：

![](../Images/image07278.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　指定公开接口。

把第1步中的列表转换为一组方法，使用指定的形参变量和返回值。如果写出应用到一个样例对象的方法调用，很多程序员会发现这一步更简单，例如：

![](../Images/image07279.gif)

现在我们有了一个明确的方法列表。

·addOption(option)

·getInput()

那么显示菜单呢？一般不会有场合只是显示菜单而不要求用户输入。然而，如果用户提供了无效输入时，getInput可能需要多次显示菜单。这样一来，display是一个不错的候选辅助方法。

为了完成公开接口，你需要详细说明构造函数。自问一下创建该类对象时需要什么信息。如果你需要用户提供值，那么构造函数必须指定一个或多个形参变量。

在菜单的例子中，我们使用不带参数的构造函数就可以了。

下面是这些公开接口：

![](../Images/image07280.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　编写公开接口的文档。

为类提供文档化的注释，然后注释每个方法。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07281.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　确定实例变量。

自问一下，为了完成任务，一个对象需要保存哪些信息。对象需要能够使用自己的实例变量和方法参数处理每个方法。

走查每个方法，或许从一个简单的或者有趣的开始，自问为了执行方法的任务该对象需要什么信息。除了方法参数外还需要哪些数据项？为那些数据项创建实例变量。

在我们的例子中，从addOption方法开始。很明显，我们需要保存增加的菜单项以便可以在后面作为菜单的一部分进行显示。我们应该如何保存这些选项呢？使用字符串列表？使用一个长字符串？两种方法都可以工作。我们在这里使用列表。练习P9.3会要求你使用另一个方法来实现。

现在，考虑一下getInput方法。它会显示保存的选项并读取一个整数。检查输入是否合法时，我们需要知道菜单项的数量。因为我们使用列表保存这些菜单项，所以菜单项的数量也就是列表的大小。如果你使用一个长字符串保存这些菜单项，你可能需要另外的实例变量来保存菜单项的数量。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　实现构造函数。

实现类的构造函数，定义和初始化实例变量。在这里，_options被设置为空列表。

![](../Images/image07282.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　实现方法。

实现类中的方法，一次实现一个，从最容易的开始。例如，下面是addOption方法的实现：

![](../Images/image07283.gif)

下面是getInput方法。这个方法稍微复杂一点。它会一直循环，直到获得了有效输入，并且在读取输入之前显示菜单项：

![](../Images/image07284.gif)

如果你发现实现某些方法时有困难，你可能需要重新思考一下实例变量的选择。初学者很容易使用一组不能精确描述对象状态的实例变量。不要犹豫，立刻回退，重新思考一下你的实现策略。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第7步　测试你的类。

编写一个简短的测试程序并执行它。测试程序应该调用你在第2步中确定的方法。

![](../Images/image07285.gif)

程序运行结果

![](../Images/image07286.gif)

下面给出了完整的Menu类和menutester程序。

ch09/how_to_1/menu.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07287.jpeg)

ch09/how_to_1/menutester.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07288.jpeg)

编程实战9.1　实现一个银行账号类

问题描述　你的任务是编写一个类模拟银行账号。客户可以存款和取款。如果取款时没有足够的余额，收取10美元透支罚款。月末会把利息增加到账号上，其中利息每个月可能会变化。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　获取你的对象职责的非正式列表。

下面的职责是在问题描述中提到的：

![](../Images/image07289.gif)

还有一个隐藏的职责。我们需要能够确定账号里有多少钱。

![](../Images/image07290.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　指定公开接口

我们需要提供形参变量并确定哪些方法是访问器和修改器。

为了存款或取款，需要知道存款或取款的金额：

![](../Images/image07291.gif)

为了增加利息，需要知道应该使用的利率：

![](../Images/image07292.gif)

很明显，所有这些方法都是修改器，因为它们会改变余额。

最后，我们有：

![](../Images/image07293.gif)

这个方法是访问器，因为查询余额不会改变它。

现在我们来看构造函数。构造函数应该接收账号的初始余额。但是使用默认值参数（见专题9.1）允许初始余额为0也是很有帮助的。

下面是完整的公开接口：

·构造函数

![](../Images/image07294.gif)

·修改器

![](../Images/image07295.gif)

·访问器

![](../Images/image07296.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　编写公开接口的文档。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07297.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07298.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　确定实例变量。

很明显，我们需要保存账号余额：

![](../Images/image07299.gif)

我们需要保存利率吗？不需要——它每个月都是变化的，作为addInterest的参数提供就可以了。那么取款时的透支罚金呢？问题描述中说它是固定的10美元，所以我们不需要保存。如果罚金也需要随时间变化，就像很多真实的银行账号那样，我们就需要在别的地方（或许在Bank对象中）保存它，但是模拟真实世界的每个方面并不是我们的工作。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　实现构造函数和方法。

让我们从简单的一个开始：

![](../Images/image07300.gif)

deposit方法稍微有点意思：

![](../Images/image07301.gif)

withdraw方法在没有足够多的金额时需要收取罚金：

![](../Images/image07302.gif)

最后是addInterest方法。我们计算利息并增加到余额上：

![](../Images/image07303.gif)

构造函数非常简单：

![](../Images/image07304.gif)

这样就完成了所有的实现（见源码中的ch09/worked_example_1/bankaccount.py）

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　测试你的类。

下面是用来调用所有方法的一个简单测试程序：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07305.jpeg)

程序运行结果

![](../Images/image07306.gif)