   

## 11.5　排列

在本节中，我们会研究一个更加复杂的递归例子，这个例子使用简单循环是很难实现的。（就像编程练习P11.15一样，可以避免使用递归，但是得到的方案非常复杂，并且也不快。）

我们会设计一个函数，列出字符串的所有排列。排列是指字符串中字母的重新组织。

例如，字符串"eat"有6个排列（包括原始字符串自己）：

![](../Images/image07645.gif)

现在我们需要一个方法来递归生成这些排列。考虑字符串"eat"。我们把问题简化一下。首先，我们生成以字母"e"开头的所有排列，然后生成以"a"开头的那些，最后是以"t"开头的那些。如何生成以"e"开头的排列呢？我们需要知道子字符串"at"的所有排列。但是对于更简单的输入，也就是短字符串"at"，仍存在同样的问题——生成所有排列。这样，我们可以使用递归。生成子字符串"at"的所有排列，也就是：

![](../Images/image07646.gif)

对于那个子字符串的每个排列，在前面加上字母"e"得到"eat"的排列中以"e"开头的那些，也就是：

![](../Images/image07647.gif)

现在我们再来看"eat"的排列中以"a"开头的那些。我们需要生成剩余字母"et"的排列，它们是：

![](../Images/image07648.gif)

把字母"a"增加到字符串的前面，得到：

![](../Images/image07649.gif)

我们以同样的方式生成以"t"开头的那些排列。

思路就是这样的。实现是非常直观的。在permutations函数中，我们循环要排列的单词中的所有位置。对于其中每一个，计算删除第i个字母之后得到的更短的单词：

![](../Images/image07650.gif)

然后计算短单词的排列：

![](../Images/image07651.gif)

最后，在短单词的所有排列前面加上刚才删除的字母。

![](../Images/image07652.gif)

按惯例，我们必须提供最简单字符串的特殊情况。最简单的字符串就是空字符串，它只有一个排列——就是它自己。

下面是完整的程序：

ch11/sec05/permutations.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07653.jpeg)

程序运行结果

![](../Images/image07654.gif)

比较permutations.py和triangle.py这两个程序。两个程序都基于同样的理论。当作用于复杂输入时，首先解决一个更简单的输入的问题。然后把简单输入的结果组合到一起再配合一点额外的工作来得到复杂输入的结果。如果在那个级别上考虑解决方案，该过程的背后实际上不复杂。然而，在背后，简单的输入会创建更简单的输入，得到另一个简化，依此类推，直到遇到一个简单到不需要更多帮助就能得到结果的输入。思考这个过程是很有意思的，但是可能也会有些困惑。重要的是你可以把精力放在真正起作用的一个级别上——根据稍微简单的问题得到解决方案，而忽略更简单的问题也需要递归来得到答案这样的事实。

自测题

17.四个字母的单词beat的所有排列是什么？

18.我们用于排列生成器的递归在遇到空字符串时结束。进行什么样的简单修改可以使得递归在遇到长度为0或1的字符串时结束呢？

19.对于排列生成器而言，为什么不容易开发出迭代方案呢？

练习它　现在你可以尝试本章最后的练习：P11.12，P11.13，P11.14。

计算与社会11.1　计算的极限

你有没有想过你的老师或者评分机是怎么确认你的编程作业是正确的？很有可能它们会看一下你的方案然后使用一些测试输入运行它。但是，一般来说他们已经有一个正确的方案。那意味着可能会有一个更容易的方式。或许他们会把你的程序和他们的正确程序输入到一个“程序比较器”，一个可以分析两个程序并确定它们是否计算出同样结果的计算机程序。当然，你的方案和已知正确的程序不需要严格一样——真正重要的是它们是否能在给定同样输入时生成同样的输出。

这样一个程序比较器会如何工作呢？Python解释器就知道如何读取一个程序并且使得类、函数和语句有意义。所以看上去似乎确实有人能够经过一定的努力编写出程序来读取两个Python程序，分析它们做的事情，决定它们是否解决同一个任务。当然，这样的程序对于老师是非常有吸引力的，因为可以自动化评分过程。这样的话，即使现在还没有这样的程序，尝试开发一个然后卖给全世界的大学，似乎是一个不错的想法。

然而，在开始为这个努力筹集风险资本之前，你应该知道理论计算机科学家已经证明了开发这样一个程序是不可能的，与你的努力程度无关。

有很多无法解决的问题。第一个称作停机问题，是由英国研究人员阿兰·图灵在1936年发现的。因为他的研究比第一台真正的计算机诞生还要早，图灵不得不设计了一个理论设备——图灵机来解释计算机可以如何工作。图灵机包含一个很长的磁带，一个读/写头，以及一个包含如下形式的有限指令：“If the current symbol under the head is x，then replace it with y，move the head one unit left or right，and continue with instruction n”。非常有趣的是，使用这些指令，你可以像Python一样编写程序，尽管这个过程超级乏味。理论计算机科学家喜欢图灵机，因为它们不需要数学公式之外的东西就可以描述。

就Python而言，停机问题认为：“不可能编写一个接收两个输入的程序，也就是一个任意Python程序P的源代码和一个字符串I，然后让程序决定程序P在输入I上执行是否会停机。也就是说，程序对于给定输入不会陷入无限循环。”当然，对于某些类型的程序和输入，是有可能决定程序是否可以以给定输入停机。停机问题断言，不可能得到适用于所有算法和输入的单个决策算法。注意，你不能简单在输入I上运行程序P来解决这个问题。如果程序运行了1000天，你不知道程序是否陷入了无限循环。或许只需要再多等一天程序就会停止了。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07655.jpeg)

阿兰·图灵

如果能够编写出来的话，这样一个“停机检查器”对于作业评分也是很有用的。老师可以使用它检查学生作业，对于特定的输入，看看程序会不会进入无限循环，然后停止检查。然而，图灵已经证明，这样的程序是写不出来的。他的论据非常聪明，也很简单。

假设存在一个“停机检查器”程序，让我们把它称作H。根据H，我们可以开发另一个程序，“杀手程序”K。K执行下面的计算。它的输入是一个包含程序R的源代码的字符串，然后在输入程序R和输入字符串R上使用停机检查器。也就是说，它检查如果输入是自己的源代码时程序R会不会停机。把一个程序输入给它自己听起来很奇怪，但并不是不可能的。例如，一个单词统计程序可以在自己的源代码上统计单词。

当K从H得到答案认为R作用于自己时会停机，就进入了一个无限循环，否则K退出。使用Python的话，程序可能看起来像下面这样：

![](../Images/image07656.gif)

![](../Images/image07657.gif)

现在问一下自己：如果要问K以K作为输入时是否会停机，check函数会回答什么？可能发现K对于这样一个输入会进入无限循环。但是等一下，那可能不是正确的。那意味着，如果r是K的源代码时，check(r，r)返回False。你很容易发现，在那种情况下，杀手程序会退出，所以K不会进入无限循环。那表示K在分析自己时必须停机，所以check(r，r)应该返回True。但是那样的话杀手程序就不会终止——它会进入无限循环。那表明实现一个可以检查是否每个程序对于特定输入都会停机的程序在逻辑上是不可能的。

需要很清醒地认识到计算是有极限的。有些问题是不论多么聪明的计算机程序都无法回答的。

理论计算机科学家致力于涉及计算本质的其他研究。直到今天仍然没有解决的一个重要的问题实际上也是一个非常耗时的问题。可能这些问题在本质上就是非常难的，这种情况下试图寻找更好的算法不会有结果。这样的理论研究有非常重要的实际应用。例如，现在没有人知道今天使用最多的加密方案会不会有一天被一个新算法所破解。知道不存在很快的破解特定编码的算法，我们就不会担心加密方案的安全性了。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07658.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image07659.jpeg)

图灵机