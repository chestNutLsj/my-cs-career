   

## 5.4　返回值

你使用return语句来指定函数的结果。在前面的例子中，每个return语句返回一个变量。然而，return语句可以返回任意表达式的值。一般来说，不会先把返回值保存到变量中然后再返回变量，而是不使用变量而返回一个复杂点的表达式的值：

![](../Images/image06222.gif)

处理return语句时，函数立刻退出。一些程序员发现，这个行为用来在函数开始处理异常情况非常方便：

![](../Images/image06223.gif)

如果调用函数时给sideLength传递了负数，函数返回0并且函数的剩余代码不会被执行。（见图5-4。）

函数的每个分支都应该返回一个值。考虑下面这个不正确的函数：

![](../Images/image06224.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06225.jpeg)

图5-4　return语句立刻退出函数

编译器不会把这个报告为错误。相反，函数会返回一个特殊的值None。正确的实现为：

![](../Images/image06226.gif)

一些程序员不喜欢在一个函数中使用多个return语句。你可以通过把函数结果保存在一个变量中然后在函数的最后一个语句中返回这个值来避免使用多个return语句。例如：

![](../Images/image06227.gif)

查看源代码ch05/sec04/earthquake.py中完整程序来理解返回一个值的函数。

自测题

13.假设cubeVolume函数体改成

![](../Images/image06228.gif)

那么这个函数和本节描述的版本有什么区别呢？

14.下面的函数是用来做什么的？

![](../Images/image06229.gif)

15.使用单个return语句实现自测题14中的mystery函数。

练习它　现在你可以尝试本章最后的练习：R5.13，P5.20。

专题5.1　使用单行复合语句

Python中的复合语句一般都是跨多行来写的，头部占一行，体在接下来的行中，并且体内的每个语句缩进到同样层次。然而，如果体中只包含一个语句，复合语句可以写在单行内。例如，可以不编写下面形式的if语句：

![](../Images/image06230.gif)

你可以使用特殊的单行形式，因为体内只包含一个语句

![](../Images/image06231.gif)

这个形式在从一个集合中选择一个值并返回的函数中非常有用。例如，下面的代码使用单行形式得到了更容易阅读的浓缩代码。

![](../Images/image06232.gif)

有时候，单行复合语句的使用可能容易让人分心或者可能会使得读者不小心跳过重要的细节。因此，在本书中，我们尽量不在包含return语句的if语句中这样使用。

如何做5.1　实现一个函数

函数是可以使用不同参数进行多次使用的计算，要么在同一个程序中，要么在不同的程序中。不论何时，只要一个计算可能需要使用多次，就转换成一个函数。

问题描述　假设你正在帮助研究埃及金字塔的考古学家。你已经接受了任务要编写根据给定高度和基底边长来计算金字塔体积的程序。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　描述函数应该做什么。

提供简单的文字描述，例如“计算基底是正方形的金字塔的体积。”

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　决定函数的“输入”。

整理一个所有可变参数的列表。对于初学者而言，很容易实现完全有针对性的函数。例如，你可能知道吉萨金字塔，也是埃及最大的金字塔，高度是146米，基底边长是230米。你不应该在计算中使用这些数字，即使原始问题也是仅仅要求计算最大金字塔的体积。编写可以计算任意金字塔体积的函数非常容易，当然也非常有用。在我们的例子中，参数就是金字塔的高度和基底长度。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　确定形参变量和返回值的类型。

高度和基底边长都可以是浮点数，计算的体积也是浮点数，所以返回值类型也是浮点数。因此，该函数的文档是

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06233.jpeg)

函数可以定义为：

![](../Images/image06234.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　编写能够得到预期结果的伪代码

在大多数情况下，函数需要执行多个步骤才能得到预期的答案。你可能需要使用数学公式、分支结构或者循环结构。使用伪代码表达你的函数。

上网搜索一下可以得到金字塔体积的计算公式为

![](../Images/image06235.gif)

因为基底是正方形，我们有

![](../Images/image06236.gif)

使用这两个方程，我们可以根据参数来计算体积。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　实现函数体。

在我们的例子中，函数体非常简单。注意用来返回结果的return语句的用法。

![](../Images/image06237.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　测试你的函数。

函数实现之后，你还应该专门进行测试。这样的测试称作单元测试。手工设计几个测试用例，然后确保函数能够给出正确结果。

例如，对于一个高度为9并且基底边长为10的金字塔，我们希望得到的体积（原文这里是面积。——译者注）为1/3×9×100=300。如果高度为0，我们希望得到的体积（原文这里是面积。——译者注）为0。

![](../Images/image06238.gif)

输出确认了函数功能和预期相符：

![](../Images/image06239.gif)

下面给出了计算金字塔体积的完整程序。

ch05/how_to_1/pyramids.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06240.jpeg)

编程实战5.1　生成随机密码

问题描述　很多网站和软件包要求创建至少包含一位数字和一位特殊字符的密码。你的任务是编写程序生成这样一个给定长度的密码，其中的字符应该是随机选择的。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06241.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　描述函数应该做什么。

问题描述要求你编程一个程序，而不是一个函数。你将要编写一个密码生成函数，然后在程序的main函数中调用它。

让我们把函数再精确一些。它会生成一个给定数量字符的密码。我们可以包含多个数字和特殊字符，但是为了简单，我们决定每种只包含一个。我们需要确定哪些特殊字符是合法的。对于我们的方案，我们会使用下面这一组：

![](../Images/image06242.gif)

密码中的其他字符是英文字母。为了简单，我们将会只使用英语字母表里的小写字母。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　确定函数的“输入”。

只有一个参数：密码的长度。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　确定形参变量和返回值的类型。

到了这里，我们已经有了足够的信息来编写文档和指定函数的头部：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06243.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　编写能够获得预期答案的伪代码。

下面是生成密码的一个方法：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06244.jpeg)

我们如何生成一个随机字母、数字或者符号呢？我们如何在随机位置插入数字或符号呢？我们会把那些任务交给辅助函数。那些函数的每一个都会开始一个新的步骤序列，为了更加清晰，我们会把那些函数放在这个函数的步骤后面。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　实现函数体。

我们需要知道第4步中描述的两个辅助函数（会在这个函数之后完成他们）的“黑盒子”描述。也就是下面的样子：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06245.jpeg)

现在我们可以把第4步中的伪代码转换为Python代码：

![](../Images/image06246.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06247.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　测试你的函数。

因为你的函数依赖于几个辅助函数，我们必须先实现辅助函数，如同下一节中的描述。（如果你没有耐心的话，可以使用编程小提示5.5中描述的插桩技术。）

下面是一个简单的main函数，其中调用了makePassword函数：

![](../Images/image06248.gif)

把所有函数放到一个叫作password.py的文件中，增加一个调用main函数的语句，然后运行几次程序。下面是几个可能的输出：

![](../Images/image06249.gif)

每个输出长度为8并且包含一个数字和一个特殊符号。

重复上面的过程，实现第一个辅助函数

现在是时候实现生成一个随机字母、数字或特殊符号的辅助函数了。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　描述函数应该做什么。

我们如何处理在字母、数字或者特殊符号之间的选择？当然，我们可以编写3个独立的函数，但是如果我们能够在单个函数中解决3个任务会好很多。我们会需要一个参数，例如，1表示字母，2表示数字，3表示特殊符号。但是，稍微做一点让步，我们可以给出一个更加通用的函数，可以从任意集合中选择一个随机符号。传递字符串"abcdefghijklmnopqrstuvwxyz"可以生成一个随机小写字母，要想得到一个随机数字，就传递字符串"0123456789"。

现在我们知道函数应该做什么了。给定任意字符串，它应该返回其中的一个随机字符。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　确定函数的“输入”。

输入可以是任意字符串。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　确定形参变量和返回值的类型。

输入类型很显然是字符串，返回值也是一样。

函数头部为：

![](../Images/image06250.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　编写可以获得预期结果的伪代码。

![](../Images/image06251.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　实现函数体。

简单地把伪代码翻译成Python语言就可以：

![](../Images/image06252.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　测试你的函数。

提供一个只用来测试这个函数的程序文件：

![](../Images/image06253.gif)

当你运行这个程序时，你可能会得到下面这样的输出：

![](../Images/image06254.gif)

这说明这个函数是可以正确工作的。

重复上面的过程，实现第二个辅助函数

最后，我们实现第二个辅助函数，把包含单个字符的字符串插入到另一个字符串的随机位置。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　描述函数应该做什么。

假设我们有一个字符串"arxcsw"和一个字符串"8"。第二个字符串应该插入到第一个字符串的随机位置，返回一个类似于"ar8xcsw"或者"arxcsw8"的字符串。实际上，第二个字符串的长度是否为1并没有关系，所以我们就简单地指定我们的函数应该把一个任意字符串插入到给定的字符串中。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　确定函数的“输入”。

第一个输入是一个字符串，另一个字符串应该被插入到这个字符串。第二个字符串是要插入的字符串。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　确定形参变量和返回值的类型。

输入都是字符串，结果也是字符串。现在可以完整描述我们的函数了：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06255.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　编写能够获得预期结果的伪代码。

没有预定义的函数用来把一个字符串插入到另一个。相反，我们需要查找插入位置，然后把第一个字符串“拆”成两个子字符串：插入位置之前的字符，插入位置之后的字符。

插入位置有多少种选择呢？如果字符串长度为6，有7种选择：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06256.jpeg)

一般地，如果字符串长度为n，有n+1种选择，从0（字符串开始位置之前）到n（字符串结束位置之后）。

下面是伪代码：

![](../Images/image06257.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　实现函数体。

把伪代码翻译成Python语言：

![](../Images/image06258.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　测试你的程序。

提供一个针对这个函数进行测试的程序文件：

![](../Images/image06259.gif)

当你运行这个程序时，可能会得到下面这样的输出：

![](../Images/image06260.gif)

输出结果显示第二个字符串正在被插入到任意位置，包括第一个字符串的开始和结束位置。

在源码中查看ch05/worked_example_1/password.py完整的程序。