   

### 5.9.5　使用工具包

创建函数并放入工具包文件中之后，你就可以像使用标准库中的函数一样使用它们了：导入想要使用的函数。在下面的例子中，我们使用import语句把模块中的所有函数都导入了（见专题2.1）。程序提示用户输入图像文件名，显示一个可用操作的菜单，并且根据用户的选择对图像进行处理。

ch05/sec09/processimg.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06361.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06362.jpeg)

自测题

35.如何修改adjustBrightness函数使得可以以不同比例调整每个像素的单个颜色分量？

36.如果要给图像增加边框并创建新图像，那么函数需要接收什么参数？

练习它　现在你可以尝试本章最后的练习：P5.37，P5.40，P5.41。

编程实战5.5　绘制增长或衰减图

当你把钱存入银行账号时，得到的利息是复合的。也就是说，你所得的利息，不仅来自于存入银行账号的钱，还来自于之前所得的利息。如果时间足够长的话，银行账号的余额会急剧增长，这个现象叫作指数级增长。

如果数量以给定的比例持续减少则会出现另一个相反的现象。放射性衰变是其中一个例子。例如，在carbon dating中使用的碳14同位素以每年百分之0.0121进行衰减。5730年之后，将会流失一半。

问题描述　使用工具箱3.2中描述的绘图工具包，编写一个函数，用来生成能够展示较长一段时间内增长或衰减的柱状图。通过在指定时间点绘制柱来限制柱的数量。如图5-9所示。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06363.jpeg)

图5-9　增长和衰减的例子

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06364.jpeg)

图5-9　（续）

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　描述函数应该做什么。

柱状图的目的是展示每年以给定百分比进行增长或衰减时数量的变化。每隔几年，绘制一个表示当前数量的柱，直到要求的年跨度结束。

函数应该生成一个与图5-9类似漂亮的柱状图。这要求增加一个图标题和标签并为两个坐标轴标上刻度。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　确定函数的输入。

函数需要5个输入：

1.初始数量

2.变化的年百分比（负数表示衰减）

3.要跟踪的年数

4.连续柱之间的年数

5.图的标题

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　确定参数类型和返回值。

很明显初始数量和年利率应该是浮点数。要显示的年数和柱之间的年数是整数。标题是字符串。函数不需要返回值，而是在pyplot窗口中创建一个图形。

现在我们拥有了足够的信息来创建文档和指定函数头：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06365.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　编写获得预期结果的源代码。

下面是生成图形的一个方法：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06366.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　实现函数体。

首先，我们绘制初始柱。你会注意到x坐标轴的值在柱下面居中对齐。默认地，柱是左对齐的。为了让x轴的值居中对齐，我们给pyplot.bar函数增加一个具名参数align="center"：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06367.jpeg)

变量bar是柱的计数器，每显示一个柱就增加1。

接下来，循环给定的年数并更新数量。对于每一年，我们需要确定是否要绘制一个柱。参数bardistance提供了柱之间的年数。如果year正好是bardistance的整数倍，就绘制一个柱。例如，如果bardistance是500，在第500、1000、1500等年时会绘制一个柱。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06368.jpeg)

图的标题已经给定了，但是我们会增加一个描述增长率或衰减率的子标题：

![](../Images/image06369.gif)

下面的代码用来对坐标轴进行配置。我们想为每个柱创建刻度，并且每个刻度都具有年份标签。注意生成两个刻度列表时range函数的用法。例如，图5-9中的第一个图，bar的值是11，year的值是501，bardistance的值是50。所以，range函数给出[0，1，2，3，...，9，10]和[0，50，100，150，...，500]。

![](../Images/image06370.gif)

![](../Images/image06371.gif)

最后，调整绘图区域。因为柱居中，我们需要把区域稍微往左移动一点。然后显示图形，任务完成。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06372.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　测试你的函数。

下面的一个简单的main函数，使用两个典型场景调用drawGrowthChart函数：

![](../Images/image06373.gif)

第一个图显示即使百分之一这样微小的利率，如果你拥有足够长的投资时间，1000美元也可以急剧增长。第二个图显示了放射性衰减。可以发现，6000年后，碳14原始数量的一半将会流失。

在源码ch05/worked_example_5/growth.py中可以查看完整程序。