   

## 5.10　递归函数（可选）

递归函数是调用自己的函数。并不像听起来那么不常见。假设你正面临清理整个房子的艰巨任务。你可能会对自己说“我会选择一个房间来打扫，然后再打扫其他房间。”换句话说，清理房间的任务调用了自己，但是接收一个简单些的输入。最终，所有的房间都被清理完。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06374.jpeg)

清理房子可以递归分解：清理一个房间，然后清理其余的房间

在Python中，递归函数遵循同样的原理。下面是一个典型的例子。我们想输出如下所示的三角形。

![](../Images/image06375.gif)

特别地，我们的任务是给出一个函数

![](../Images/image06376.gif)

上面给出的三角形是通过调用printTriangle(4)输出得到的。为了看清楚递归的作用，考虑一下如何通过边长为3的三角形得到边长为4的三角形。

![](../Images/image06377.gif)

更一般地，下面是适用于任意边长的Python指令：

![](../Images/image06378.gif)

这个想法还有一个问题需要解决。当边长为1时，我们不想调用printTriangle(0)、printTriangle(-1)等等。解决方案是把这作为一个特殊情况来处理，当边长小于1时不输出任何东西。

![](../Images/image06379.gif)

再看一下printTriangle函数，看看是否足够合理：如果边长为0，没有东西需要输出。下一部分也是合理的。输出一个小一些的三角形，不要考虑为什么可以正常工作。然后输出一行[]。很明显，结果是预期大小的三角形。

确保递归成功有两个关键需求：

·每一次递归必须能以某种方式对问题进行简化。

·必须有一个特殊情况能够直接处理最简单的任务。

printTriangle函数使用越来越小的边长再次调用自己。最终边长达到0，然后函数停止调用自己。

下面是输出边长为4的三角形时发生的事情。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06380.jpeg)

递归函数的调用模式看起来很复杂，成功设计递归函数的关键是不要去想它。

打印上面的三角形形状时实际上不是必须使用递归。你可以使用嵌套循环：

![](../Images/image06381.gif)

然而，这个循环有点不容易理解。很多人发现递归方案更容易理解。下面给出了完整程序ch05/sec10/triangle.py。

ch05/sec10/triangle.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06382.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06383.jpeg)

自测题

37.下面的代码printTriangle函数进行了一些修改：

![](../Images/image06384.gif)

那么printTriangle(4)的结果是什么？

38.下面的递归函数：

![](../Images/image06385.gif)

mystery(4)的结果是什么？

39.下面的递归函数：

![](../Images/image06386.gif)

mystery(20)的结果是什么？

40.编写递归函数在一行内输出n个[]。

41.5.7节中的intName函数接收<；1000的参数。使用递归调用，把那个函数的范围扩展到999 999。例如，输入12 345应该返回"twelve thousand three hundred forty five"。

练习它　现在你可以尝试本章最后的练习：R5.15，P5.16，P5.18。

如何做5.2　递归思想

和编写循环相比，递归解决问题需要不同的思维模式。实际上，如果你有一点懒并且想让其他人完成大部分工作时，这种模式是有帮助的。如果你需要解决一个复杂的问题，假装“其他人”会完成大部分的累活并且解决所有简单输入的问题。然后你只需要规划出如何把这些简单输入的解决方案转换成整个问题的解决方案。这里，我们演示一下递归思考的过程。

问题描述　考虑4.2节中的问题，计算一个数字的所有位上的数字之和。我们想设计一个函数digitSum来计算一个整数n的所有位之和。例如，digitSum(1729)=1+7+2+9=19。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　把输入分解为可以单独作为问题输入的多个部分。

在脑子里，对于想要解决的任务，想象一个或一组特定的输入，思考一下如何简化这些输入。寻找能够被同样任务解决的简化方案，并且其解决方案与原始任务相关。

对于上面的各位数字求和问题，从考虑如何简化n=1729这样的输入开始。减1会有帮助吗？毕竟digitSum(1729)=digitSum(1728)+1。但是，考虑一下n=1000。看起来digitSum(1000)和digitSum(999)之间并没有明显的关系。

一个有意义的想法是移除最后一位，也就是计算n//10=172。172的各位数字之和和1729的各位数字之和有直接关系。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　把多个简单输入的解决方案组合为原始问题的解决方案。

在脑子里，考虑一下第1步中发现的针对简单输入的解决方案。不要担心如何获得那些解决方案，简单地认为可用就行了。告诉自己：这些是简单输入，会有别人帮我解决这些问题的。

对于各位数字求和的任务，思考一下，如果已知digitSum(172)应该如何获得digitSum(1729)。你只需要把最后一位（9）加上去就可以完成任务了。如何得到最后一位呢？计算余数n%10就可以了。所以，digitSum(n)的值可以如下获得

![](../Images/image06387.gif)

不要担心digitSum(n//10)如何计算，这个输入更小一些，可以正常工作。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　寻找最简单输入的解决方案。

递归计算会一直简化它的输入。为了确保递归能够停止，你必须单独处理最简单的输入，对它们进行特殊的计算。那通常是非常容易的。

看一下对于digitSum问题的最简单输入：

·只有一位的数字

·0

一位数字是它自己的和，所以你可以在n<；10时停止递归并返回n。或者，你可以更懒一些。如果n只有一位，那么digitSum(n//10)+n%10等于digitSum(0)+n。你可以简单地在n等于0时结束递归。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　通过组合简单情况和递推步骤实现解决方案。

现在你已经准备好实现解决方案了。把第3步中考虑的简单输入当作特殊情况处理。如果输入不是几种最简单的情况之一，使用第2步中的逻辑。

下面给出了完整的digitSum函数和测试程序。

ch05/how_to_2/digits.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06388.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06389.jpeg)