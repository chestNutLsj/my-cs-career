   

### 7.4.3　图像文件

在这一节中，你会学习到BMP图像文件的格式。与更常见的GIF、PNG以及JPEG格式不一样，BMP格式非常简单，因为没有使用数据压缩。带来的结果是BMP文件非常大，你在实际应用中很少见到它们。然而，图像编辑器可以把任意图像转换为BMP格式。

BMP格式有多个不同的版本，我们这里只介绍最简单也是最常见的一个，有时也称作24位真彩色格式。在这种格式中，每个像素使用3个字节来表示，分别用来表示蓝、绿和红色分量的值。例如，青色（蓝色和绿色的混合）是255 255 0，红色是0 0 255，中灰色是128 128 128。

BMP文件的头部包含了多个信息，我们只需要下面的几项：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06919.jpeg)

为了从BMP文件中读取一个整数，你需要读取4个字节（b0，b1，b2，b3）然后使用下面的公式把它们组合为一个整数

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06920.jpeg)

实现这个任务的Python代码是：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06921.jpeg)

（注意，b0是1的系数，b3是2563的系数，这叫作“小端”字节顺序。有些文件格式使用相反的字节顺序，称作“大端”，其中第一个字节是256的最高阶的系数。处理二进制文件时，你必须确定使用的字节顺序。）

图像被保存为一系列像素行，从图像的最底部行的像素开始。每个像素行包含一系列蓝/绿/红三元组。行尾会填充一些附加字节使得行中的字节数量能够被4整除（见图7-3）。例如，如果某一行只包含3个像素，一个青色，一个红色，一个中灰色，该行会被编码为：

![](../Images/image06922.gif)

其中x y z是填充字节，用来把行的长度变为12，也就是4个倍数。正是这些小调整使得处理实际文件格式成为一个快乐的体验。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06923.jpeg)

图7-3　24位真彩色图像的BMP文件格式