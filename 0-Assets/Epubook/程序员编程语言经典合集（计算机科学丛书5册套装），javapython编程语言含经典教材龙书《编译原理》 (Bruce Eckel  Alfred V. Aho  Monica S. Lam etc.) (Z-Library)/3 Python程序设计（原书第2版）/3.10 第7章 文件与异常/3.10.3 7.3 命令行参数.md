   

## 7.3　命令行参数

依赖于使用的操作系统和Python开发环境，有不同的方式可以启动一个程序。例如，在开发环境中选择“Run”菜单，单击一个图标，或者在终端窗口输入程序的名字。后面的方式称作“在命令行调用程序”。当你使用这种方式时，你当然必须输入程序的名字，但是你也可以输入程序可以使用的附加信息。这些附加的字符串称作命令行参数。例如，如果你在命令行启动一个程序：

![](../Images/image06867.gif)

那么程序接收到两个命令行参数：字符串"-v"和"input.dat"。对这些字符串做什么完全取决于程序。把以连字符（-）开始的字符串解释为程序选项是一个习惯。

你应该为你的程序支持命令行参数，还是应该以图形用户界面来提示用户呢？对于临时使用的用户，交互式用户接口更好一些。用户界面引导用户以并使得在没有太多知识的情况下使用应用程序成为可能。但是对于经常使用的用户，命令行接口有个重要的优势：容易自动化。如果你每天需要处理上百个文件，你可能要花费所有的时间在文件选择对话框中输入文件名。然而，通过使用批处理文件或者脚本（你的计算机操作系统的一个特性），你可以使用不同的命令行参数自动多次调用一个程序。

你的程序把命令行参数接收进sys模块定义的argv列表中。在我们的例子中，argv列表长度为3，包含字符串：

![](../Images/image06868.gif)

让我们编写一个加密文件的程序——把它变为乱码从而不可读，除非知道解密方法。忽略加密领域2 000年的发展，我们使用一种比较熟知的尤利乌斯.凯撒加密方法，把A替换为D，B替换为E，等等（见图7-1）。注意，凯撒密码只修改大写和小写字母，空格和标点符号保持不变。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06869.jpeg)

图7-1　凯撒加密

程序接收下面的命令行参数：

·可选的-d标记来表示解密而不是加密

·输入文件名字

·输出文件名字

例如，

![](../Images/image06870.gif)

对文件input.txt进行加密并把结果放入encrypt.txt中。

![](../Images/image06871.gif)

对文件encrypt.txt进行解密并把结果放入output.txt中。

ch07/sec03/cipher.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06872.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06873.jpeg)

自测题

12.如果使用python cipher.py-d file1.txt调用程序，argv中的元素是什么？

13.跟踪自测题12中调用程序的执行过程。

14.如果程序以下面的方式调用，会正确执行吗？

![](../Images/image06874.gif)

如果可以的话，为什么？如果不可以，为什么？

15.使用原始的凯撒密码加密CAESAR。

16.你如何修改程序使得用户可以通过-k选项来指定加密密钥而不是3？例如，

![](../Images/image06875.gif)

练习它　现在你可以尝试本章最后的习题：R7.4，P7.8，P7.9。

如何做7.1　处理文本文件

处理包含真实数据的文本文件可能会非常困难。这个如何做一步一步指导你完成这样的任务。

问题描述　读取两个国家数据文件，worldpop.txt和worldarea.txt（在ch07/how_to_1中）。两个文件中以同样的顺序包含同样的国家。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06876.jpeg)

新加坡是世界上人口密度最大的国家之一  

写入文件world_pop_densities、txt，其中包含国家名字和人口密度（每平方千米的人口数量），并且国家名字左对齐，数量右对齐：

![](../Images/image06877.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　理解处理任务。

一如既往，在设计解决方案之前你需要对任务有一个清晰的理解。你能手工解决这个任务吗（或许使用较小的输入文件）？如果不能，那就获取关于的问题的更多信息。

你需要考虑的一个重要方面是你是否可以在数据可用时处理它，或者你是否需要先把数据保存起来。例如，如果要求输出排序后的数据，你首先需要收集所有输入，或许要把数据放入一个列表。然而，可能通常会立刻处理数据，不需要进行保存。

在我们的例子中，我们可以一次读取文件中的一行并对每行计算密度，因为我们的输入文件是以同样顺序存储人口和面积数据的。

下面的伪代码描述了我们的处理任务。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06878.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　确定你需要读写哪个文件。

根据问题描述，这一点应该是清晰的。在我们的例子中，有两个输入文件，人口数据和面积数据，还有一个输出文件。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　选择一个获取文件名的机制。

有3个选择：

·硬编码文件名（以"worldpop.txt"为例）

![](../Images/image06879.gif)

·要求用户输入：

![](../Images/image06880.gif)

·使用命令行参数获取文件名。

在我们的例子中，为了简单，我们使用硬编码的文件名。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　在迭代文件或读取独立行之间做出选择。

根据经验，如果记录是按行分组的可以迭代输入数据。收集数据分散在多行的记录时，你会需要读取独立的行并显式检查文件尾。

在我们的例子中，我们不得不读取独立行，因为我们是从两个输入文件中读取数据。如果我们是从一个文件中读取，可以使用for循环来迭代文件。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　根据面向行的输入，提取需要的数据。

使用for循环读取输入的行很简单。然后你需要提取独立字段的数据。这可以像7.2.2节中描述的那样来完成。一般地，你可以使用split或rsplit方法来完成。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　使用函数提炼出通用的任务。

处理输入文件通常有一些重复性的任务，例如切分字符串和把字符串转换为数字。编写函数来处理这些枯燥的操作会有不少好处。

在我们的例子中，我们有一个需要辅助函数的通用任务：提取国家名字和后面的值。因为两个文件具有同样的格式，国家名字后面跟着一个值，我们可以使用单个函数来提取一个数据记录。我们像7.2.4节描述的那样实现这个函数：

![](../Images/image06881.gif)

下面是完整的程序源码。

ch07/how_to_1/population.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06882.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06883.jpeg)

编程实战7.1　分析婴儿名字

社会保障事务管理局在他们的网站[http://www.ssa.gov/0ACT/babynames/](http://www.ssa.gov/0ACT/babynames/)上发布了最流行婴儿名字的清单。当你查询给定年份的1000个最流行名字时，浏览器会在屏幕上显示结果（见图“查询婴儿名字”）。

为了把这些数据保存为文本，可以选择然后把结果粘贴进文件中。配套代码中包含的文件babynames.txt中有2011年的数据。

文件中的每一行有5个项目：

·排名（从1到1000）

·名字和该排名中男性名字的比例

·名字和该排名中女性名字的比例

例如，下面这一行

![](../Images/image06884.gif)

显示第6个最常用的男孩名字是Michael，在2011年出生的人中占百分之0.8247。第6个最常用的女孩名字是Emily。

问题描述　为什么Michael比Emily更常用呢？父母好像使用了更广泛的女孩名字，使得每一个女孩名字都不那么频繁。你的任务是通过确定清单中前百分之50的男孩名字和女孩名字来测试那个推测。简单地输出男孩和女孩名字以及它们的排名，直到到达百分之50的限制。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　理解处理任务。

为了处理每一行，我们读取一整行然后在空格处进行切分。然后提取解决任务所需要的5个值（排名，男孩名字，男孩比例，女孩名字，女孩比例），把排名转换为整数，把百分比转换为浮点数。为了在达到百分之50时停止，我们可以增加百分比并在达到百分之50时停止。

我们需要分离男孩和女孩的总数，当一个总数达到百分之50时，停止输出。当两个总数都达到百分之50时，停止读取。

下面的伪代码描述了我们的处理任务。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06885.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　确定要读写哪个文件。

我们只需要读取单个文件，也就是babynames.txt。因为没有要求把结果保存到文件中，所以我们直接输出到终端。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　选择获取文件名的机制。

我们不需要提示用户输入文件名。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06886.jpeg)

查询婴儿名字

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　在迭代文件或者读取独立行之间做出选择。

因为我们不会读取整个文件，而是在男孩名字或女孩名字达到百分之50时就停止，我们需要读取独立的行。当迭代整个文件时会使用for循环。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　对于面向行的输入，提取需要的数据。

我们可以使用split方法把输入行切分成5个组成部分，因为没有名字包含空格，就像“Mary Jane”。提取排名和百分比时，排名必须被转换成整数，百分比必须转换成浮点数。在转换成浮点数之前，我们还需要从百分比字符串中删除百分号。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　使用函数提炼通用任务。

在伪代码中，我们有一步是Repeat for girl part。很明显，这是个需要辅助函数的通用任务。它涉及两个任务：

![](../Images/image06887.gif)

最后一个任务提出一个技术问题。在Python中，让一个函数更新一个数字参数是不可能的。所以，我们的函数会接收一个总数并返回更新后的值，然后再保存更新后的值，就像：

![](../Images/image06888.gif)

如你所见，函数还需要接收名字和百分比。下面是这个函数的代码：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06889.jpeg)

下面给出了完整的程序。看一下程序输出。比较引人注目的是，所有出生婴儿的前一半中只有141个男孩名字和324个女孩名字。这对于那些生产个性化小物件的商人来说是个好消息。练习P7.10要求你研究不同年份中这个分布是如何变化的。

ch07/worked_example_1/babynames.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06890.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06891.jpeg)

程序运行结果

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06892.jpeg)

工具箱7.2　处理文件和文件夹

操作系统负责管理你的计算机上的文件系统。你的程序打开文件时，Python使用操作系统提供的工具来处理那个操作。有时候，你可能不仅仅是要打开文件。例如，假设你想获取一个文件夹中的内容或者确定一个文件是否存在。在这个工具箱中，你会学习到如何完成这个任务以及更多关于Python标准库os提供的操作系统工具的知识。

你使用Python打开一个文件时，操作系统在程序所在的文件夹中查找这个文件，也就是所谓的当前工作目录。有时为程序用户提供要访问的输入文件和输出文件所在的文件夹名字可能会更好一些。为了获取当前工作目录的名字，使用函数调用

![](../Images/image06893.gif)

如果程序使用的数据文件保存在不同的文件夹中，例如reports，你可以在打开文件之前修改程序的当前工作目录：

![](../Images/image06894.gif)

通过本章前面的学习你已经知道，以读模式打开文件时，它必须存在，否则会引发异常。你可以在打开文件之前测试一下该文件是否存在。exists函数接收文件名作为参数并返回表示文件是否存在的布尔值：

![](../Images/image06895.gif)

这个函数在提示用户输入文件名时会用得上。你可以在循环中使用它，不停地提示用户输入文件名，直到输入了已存在的文件名。

![](../Images/image06896.gif)

你可以进一步增强程序的可用性，在提示输入文件名之前提供当前文件夹的内容清单。函数listdir：

![](../Images/image06897.gif)

返回一个字符串列表，每个字符串表示当前文件夹中的一个文件。获取文件名列表之后，你可以迭代这个列表并输出这些字符串：

![](../Images/image06898.gif)

为了获得另一个文件夹中的文件清单，你可以把那个文件夹的名字作为参数传递给listdir函数：

![](../Images/image06899.gif)

listdir函数不仅可以返回一个文件夹中的文件名字，还可以返回任何子文件夹的名字。显示用户应该选择的文件名清单时，你不应该包括这些子文件夹的名字。

你可以测试列表中的字符串是否是一个文件的名字：

![](../Images/image06900.gif)

或者是否是一个文件夹的名字：

![](../Images/image06901.gif)

表7-6列出了处理文件的其他有用的函数。其中大部分在os和os.path模块中。然而，复制文件的函数是在shutil模块中的。

表7-6　os、os.path和shutil模块中的函数

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06902.jpeg)

下面的程序输出当前文件夹及其子文件夹中所有GIF图像文件的名字。遍历整个文件系统或多个文件夹中的内容比较高级一些，需要使用到递归（见编程实战11.1）。

ch07/toolbox_2/listgifs.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06903.jpeg)

计算与社会7.1　加密算法

本章的练习中给出了几个用来加密文本的算法。不要真的使用这些算法中的任何一个给你的爱人发送加密的信息。任何有经验的破解密码者都可以在很短的时间里破解这些方案——在不知道密钥的情况下重构原始文本。

1978年，Ron Rivest，Adi Shamir和Leonard Adleman介绍了一个强壮得多的加密方法。这个方法叫作RSA加密，是以它的发明者的姓来命名的。精确的加密方案过于复杂，这里就不描述了，但是并不是很难理解。你可以查看[http://theory.lcs.mit.edu/~rivest/rsapaper.pdf](http://theory.lcs.mit.edu/~rivest/rsapaper.pdf)了解有关的细节。

RSA是一个非常棒的加密方法，有两个密钥：一个公钥和一个私钥（见图“公钥加密”）。你可以把公钥印在名片上（或者邮件签名块中）然后发给任何人，然后他们就可以给你发送只有你自己能解密的信息了。即使其他人知道你的公钥，即使他们截获了发给你的所有信息，他们也不能破解这个加密方案和阅读这些信息。1994年，上百位研究人员通过互联网合作破解了使用129位密钥加密的RSA信息，使用230位或更长的密钥加密的信息被认为是安全的。

这个算法的发明者为此获得了专利。专利是社会和发明者之间的一个交易。在20年内，发明者拥有商业化的唯一权力，可以向打算使用这个发明的人收取版税，也可以阻止竞争者共同使用它。反过来，发明者必须发布这个发明以便别人可以从中学习，并且必须在专利期结束之后放弃所有权力。假定没有专利法的话，发明者可能会不愿意花费精力去发明，或者会试图隐藏他们的技术来防止其他人复制他们的设备。

关于RSA专利已经有了一些争议。如果没有专利保护，发明者也会发布他们的方法从而在没有20年专利期费用的前期下让社会受益吗？在这种情况下，答案是肯定的。发明者是靠工资而不是靠销售支票生活的科研人员，并且通常会随着个人声望或职业生涯中的一些发现而获得报酬。他们的跟随者会在发现（和申请专利）改进方面一样活跃吗？当然，这就无从得知了。一个算法是否还值得专利保护，或者是不属于任何人的数学事实？专利局在很长一段时间里持有后面的观点。RSA发明者和很多研究人员使用想象的电子设备来描述他们的发明，而不是使用算法，这样可以绕过这个限制。现在，专利局会授予软件专利了。

RSA故事还有另一个有意思的方面。一个程序员，Phil Zimmermann，开发了一个叫作PGP（Pretty Good Privacy的缩写）的基于RSA的程序。任何人都可以使用这个程序加密信息，即使使用最强的计算机也不能解密。你可以在GNU项目（[http://www.gnupg.org](http://www.gnupg.org)）获得一份PGP实现的免费版本。强加密方法的存在长期困扰着美国政府。罪犯和境外代理可以发送警察局和情报局都无法解密的通信。政府考虑控诉Zimmermann违背了禁止未授权军火输出的法律，认为他应该知道他的程序会出现在互联网上。已经有严肃的提案认定普通公民使用这些加密方法或者密钥对法律实施保密是非法的。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06904.jpeg)

公钥加密