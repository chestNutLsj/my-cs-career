   

## 3.4　多重选择

在3.1节介绍了如何使用if语句实现双分支结构。在很多场合下有多于两个分支。在本节中，你会了解到如何实现多个分支的选择结构。

例如，考虑编写程序显示地震的影响，以里氏震级为单位（见表3-4）。

表3-4　里氏震级

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05658.jpeg)

里氏震级是地震强度的一个衡量标准。在这个震级的每一级，例如从6.0到7.0，表示了地震强度十倍的增加。

在上面描述的情况下，有5个分支：4个分别对应于表中描述的4个破坏程度，1个对应于没有破坏的情况。图3-4给出了这个多分支语句的流程图。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05659.jpeg)

图3-4　多重选择

你可以使用多个if语句来实现多个选择，就像：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05660.jpeg)

但是这样的代码可读性很差，并且，随着分支数量的增加，由于缩进的要求，代码会越来越靠右。Python提供了一个特殊的结构elif用来创建包含多分支的if语句。使用elif语句，上面的代码片段可以重写为：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05661.jpeg)

只要这4个测试的任何一个成功，就会显示该震级对应的影响，并且其他测试不会被尝试。如果4个分支没有一个能够匹配，最后的else子句就起作用了，输出默认的信息。

这里你必须根据最大的结束条件对已知条件和测试进行排序。假设我们按照相反的顺序进行测试：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05662.jpeg)

这样的逻辑是无法工作的。假设震级为7.1，这个值大于4.5，与第一个分支相匹配，其他的测试永远不会被尝试。

补救办法是首先测试更加有针对性的条件。这里，条件richter>；=8.0比条件richter>；=7.0更加具体，而条件richter>；=4.5与上面两个条件相比则更加一般化（也就是说，被大多数值所满足）。

在这个例子中，我们使用if/elif序列也非常重要，而不是仅仅使用多个独立的if语句。考虑下面多个独立的测试序列：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05663.jpeg)

![](../Images/image05664.gif)

现在这些选择不再是互斥的。如果richter为7.1，那么后面的3个测试都是满足的，3个信息都会被输出。

下面给出了根据给定里氏震级来输出地震描述信息的完整程序：

ch03/sec04/earthquake.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05665.jpeg)

自测题

16.在一个游戏程序中，选手A和B的分数分别存储在scoreA和scoreB中。假设得分高的选手赢得比赛，编写if/elif序列输出”A won”，“B won”，或者”Game tied”。

17.编写一个具有3个分支的条件语句，如果x为整数则把s设置为1，如果x为负数则把s设置为-1，如果x为0则把s设置为0.

18.如果要求使用2个分支实现自测题17的任务，你应该如何实现？

19.初学者有时候会写出下面的代码：

![](../Images/image05666.gif)

解释如何改进和优化上面的代码。

20.假设用户运行地震程序时输入-1，会输出什么？

21.假设我们想让地震程序检查用户是否输入了负数，你会在if语句中加入什么样的分支？会在哪里加入呢？

练习它　现在你可以尝试本章最后的练习：R3.22，R3.9，R3.40。

工具箱3.1　发送电子邮件

假设你的工作是教授助理，并且需要通知很多学生告知他们的测验成绩。如果在电子邮件程序中依次输入每个信息，这将会是一个大工程。幸运的是，你可以使用Python的email模块自动完成这个任务。

创建电子邮件信息

首先，你需要组织一个信息。一般地，信息由文本和附件组成，例如图像和文件。MIME（MultiPurpose Internet Mail Extensions）描述了电子邮件信息需要按照什么格式进行组织。幸运的是，你并不需要知道这个格式的细节，只需要简单地使用Python提供的MIME类就可以。使用下面的语句导入这些类：

![](../Images/image05667.gif)

你需要首先创建一个可以包含多个部分的信息对象：

![](../Images/image05668.gif)

然后指定发信人和一个或多个收信人的电子邮件地址：

![](../Images/image05669.gif)

使用下面的代码添加抄送人和密送人：

![](../Images/image05670.gif)

使用下面的命令设置邮件标题：

![](../Images/image05671.gif)

现在你可以包含信息的主体部分了，如果信息主体是一个简单的文本字符串，直接调用

![](../Images/image05672.gif)

你也可以通过调用下面的语句来附加HTML版本的文本信息：

![](../Images/image05673.gif)

如果你同时使用了两种形式，那么收信人的邮件程序会显示其中一个，取决于用户的偏好设置和接收设备的能力。

如果你想在电子邮件中包含一个图像，首先需要从文件中读取。我们会在第7章详细讨论文件操作，但在这里的情况下非常容易实现。只需要使用“读取二进制数据”的方式打开文件，读取数据，创建一个MIMEImage对象就可以了。然后关闭文件，把图像附加到邮件信息中：

![](../Images/image05674.gif)

对于其他的附件，例如PDF文件或者电子表格，你需要根据文件创建MIMEApplication对象。增加一个头部信息告诉收信人这个文件是可以保存的附件。

![](../Images/image05675.gif)

![](../Images/image05676.gif)

收信人可以通过点击某个图标来保存文件。默认情况下，文件会使用指定的名字，但是大部分电子邮件阅读程序都允许收信人修改这个名字。（你不应该在附件头部包含目录名，因为收信人可能没有同样的目录）。

当然，不是每个电子邮件都有图像和文件附件，只需要跳过有关的部分并直接发送文本信息就可以。

发送信息

完成信息的组建之后，你需要使用smtplib模块来发送这个信息。SMTP是“Simple Mail Transport Protocol”的缩写，是用来和邮件服务器进行通信的规格说明书。导入模块：

![](../Images/image05677.gif)

然后连接邮件服务器。你需要指定主机名和端口号。这里我们以谷歌的Gmail服务为例。使用Gmail（和大部分其他邮件服务器），你需要使用端口号587实现“传输层安全”。也就是说，你的机器和邮件服务器之间的通信是被加密的。如果你使用不同的电子邮件服务，需要自己查找相应的主机名和端口号。

![](../Images/image05678.gif)

SMTP函数返回一个对象，你可以用它和服务器通信。首先，切换为安全通信：

![](../Images/image05679.gif)

然后使用你的电子邮件名字和密码登录。

![](../Images/image05680.gif)

最后使用send_message方法发送你的电子邮件，结束会话。

![](../Images/image05681.gif)

电子邮件程序例子

如你所见，使用Python程序发送电子邮件非常容易，只需要组装一个信息然后发送给服务器。现在让我们回到那位需要通知每个学生考试成绩的助教的问题。如果学生考得好，就发送一个赞扬的信息，如果学生看起来需要家庭教师的话，就发送信息并建议去家教中心。

编写这样的程序时，你应该在程序中包含自己的信息（电子邮件地址、账号名字、服务器名字等），这样就不用每次都输入了。然而，更明智的做法是不要在程序中保存密码，而是每次运行程序时读入密码。

下面给了程序的开头部分：

![](../Images/image05682.gif)

![](../Images/image05683.gif)

然后提示并输入收信人的电子邮件地址和考试成绩，根据成绩创建信息主体。

![](../Images/image05684.gif)

现在就可以组装信息了。这里你只需要发送简单的文本信息。本章最后的练习P3.42～P3.45给出了一些增强的建议。

![](../Images/image05685.gif)

最后，发送信息：

![](../Images/image05686.gif)

成功，个性化的信息正在去往收信人的路上！完整的程序见ch03/toolbox_1/mail.py。

这个程序发送了一个简单的电子邮件信息。在第4章，你会学习到如何编写发送多个信息的循环。在第7章你会学习到如何读取一个电子表格。然后你就可以改进这个程序实现自动给所有学生发送信息，这些学生的电子邮件地址和考试成绩都在电子表格中。