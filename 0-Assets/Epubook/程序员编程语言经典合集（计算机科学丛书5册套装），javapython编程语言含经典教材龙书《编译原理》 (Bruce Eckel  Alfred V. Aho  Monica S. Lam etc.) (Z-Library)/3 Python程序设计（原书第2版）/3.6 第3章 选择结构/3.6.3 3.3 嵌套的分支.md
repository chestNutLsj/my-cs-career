   

## 3.3　嵌套的分支

经常需要在另一个if语句包含if语句。这样的组织形式称作嵌套的语句集合。

下面是一个典型的例子：在美国，根据纳税人的婚姻状况不同，使用的税率也不同。对于单身和已婚纳税人有不同的税收方案。已婚纳税人把收入加到一起然后按照总数进行纳税。表3-3给出了税率计算方法，使用了2008年实际税收方案的简化版本。对于每个等级使用了不同的税率。在这个方案中，收入在第一等级的税率为10%，第二等级收入的税率是25%。每个等级的收入限制又依赖于婚姻状况。

表3-3　联邦税率方案

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05641.jpeg)

现在计算应交的税，根据给定的婚姻状况和收入情况。关键点是需要做两级判断才能得出最终结果。首先，必须根据婚姻状况进行分支。然后，对于每个婚姻状况，你必须根据收入水平再次进行分支。

两级判断的过程表现为本节最后程序的两级if语句（流程图见图3-3。）理论上，嵌套可以超过两级。三级判断的过程（首先按州，然后按婚姻状况，然后按收入水平）需要使用三级嵌套。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05642.jpeg)

图3-3　所得税计算

Ch03/sec03/taxes.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05643.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05644.jpeg)

程序运行结果

![](../Images/image05645.gif)

自测题

12.如果单身纳税人收入为32 000美元，应交税额是多少？

13.如果第一个嵌套的if语句从

![](../Images/image05646.gif)

变为

![](../Images/image05647.gif)

税额会发生改变吗？

14.假设Harry和Sally每人年收入为40 000美元，如果他们结婚的话，税收会减少吗？

15.一些人反对高收入高税率的做法，抱怨说如果升职或者努力工作的话，税后反而可能会剩下更少的钱。这个观点错在哪里？

练习它　现在你可以尝试本章最后的练习：R3.9，P3.1，P3.2。

编程小提示3.2　手动跟踪

在理解一个程序是否能够正常工作时，一个非常有用的技巧是手动跟踪。你在一张纸上模拟程序的行为，你可以对伪代码或Python代码使用这个方法。

拿一张索引卡，一张纸巾，或者能够拿到的任意一张纸。为每个变量准备一列。准备好程序代码。使用回形针之类的东西来标记当前语句。记住，每次执行一条语句。每次变量的值发生变化时，划掉旧的值，然后在旧值的下方写下新值。

让我们跟踪前面的程序taxes.py，并使用当时运行程序时的输入。在第12行和13行，变量income和maritalStatus被输入语句初始化。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05648.jpeg)

在第16和17行，tax1和tax2被初始化为0.0。

![](../Images/image05649.gif)

因为婚姻状况不是”s”，我们跳至外层if语句的else分支（第25行）。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05650.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05651.jpeg)

因为收入不是<；=64000，我们跳至内层if语句的else分支（第28行）。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05652.jpeg)

变量tax1和tax2的值被更新。

![](../Images/image05653.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05654.jpeg)

总和totalTax被计算并输出，然后程序结束。

![](../Images/image05655.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05656.jpeg)

因为程序跟踪给出了预期的输出（10 400美元），成功说明这个测试用例可以正确工作。

计算与社会3.1　丹佛的行李处理系统

根据不同的条件做出不同的决定，这在任何计算机程序中都是很重要的一部分。没有任何地方比在机场帮助排列行李的计算机系统更加明显了。扫描行李识别码之后，系统进行排序并把行李放置到不同的传送带上。然后人类操作员把行李放置到车上。在丹佛建造大型机场替代一个过时且拥堵的设施时，行李处理系统的合同方考虑的稍微有点多。新系统使用机器人小货车代替人工操作员。不幸的是，这个系统无法工作。新系统无法准确地解决行李如何落到轨道和小货车上之类的机械问题，一些软件小错误也把新系统折磨得不行。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05657.jpeg)

丹佛机场最初有一个使用机器人小货车替代人工操作员的全自动系统。不幸的是，这个系统从来没有工作，并且在机场投入使用之前被拆除了

明明别的地方需要小货车，它们却毫无意义地停留在一个不需要的地方。

机场本来计划1993年投入使用，但是因为没有可以正常工作的行李处理系统而延期一年多，期间合同方一直在尝试解决问题。合同方一直没有成功，最终不得不安装了手工处理系统。延期耗费了这个城市和机场近亿美元，而作为美国行李处理系统重要生产商的合同方被迫破产。

很明显，基于从来没有在小的应用场合尝试过的技术来构建大型系统，是有很大风险的。随着时间的推移，机器人和控制机器人的软件都有很大改善，它们在未来会完成更多的行李处理任务。但是这很可能会以逐步递增的方式慢慢实现。