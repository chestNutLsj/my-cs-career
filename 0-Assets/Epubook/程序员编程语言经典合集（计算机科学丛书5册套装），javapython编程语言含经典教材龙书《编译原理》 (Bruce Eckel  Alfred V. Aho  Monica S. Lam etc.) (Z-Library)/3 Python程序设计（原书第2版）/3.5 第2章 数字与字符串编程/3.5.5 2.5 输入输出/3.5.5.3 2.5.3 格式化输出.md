   

### 2.5.3　格式化输出

当输出计算结果时，你经常需要控制它的显示形式。例如，输出美元和美分的数量时，你通常想把它四舍五入为2位有效数字，也就是说，你想像下面这样输出：

![](../Images/image05399.gif)

而不是

![](../Images/image05400.gif)

下面的命令使用小数点后面带有两位数字的形式显示价格：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05401.jpeg)

你也可以指定一个域的宽度（字符的总数量，包括空格），就像：

![](../Images/image05402.gif)

语法2.3　字符串格式运算符

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05403.jpeg)

价格使用10个字符并且右对齐的形式输出：6个空格，然后是4个字符1.22。

![](../Images/image05404.gif)

传递给函数print的参数

![](../Images/image05405.gif)

指定了字符串将被如何格式化。结果是一个可以被输出或保存到变量中的字符串。

你在前面已经知道%符号用来计算向下取整除法的余数，但那只是运算符的左右两侧都是数字时的一种用法。如果左侧是一个字符串的话，%符号就变成了字符串格式化运算符（string format operator）。

结构%10.2f被称作格式限定符：用来描述一个值应如何格式化。格式限定符尾部的字母f表示我们正在格式化一个浮点数。使用d表示格式化一个整数，s表示格式化一个字符串，表2-9给出了更多例子。

表2-9　格式限定符举例

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05406.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05407.jpeg)

格式字符串（字符串格式化运算符左侧的字符串）可以包含一个或多个格式限定符和字面字符。不是格式限定符的任何字符都会按字面意思进行对待。例如，命令

![](../Images/image05408.gif)

会得到字符串

![](../Images/image05409.gif)

你可以使用一个字符串格式化运算符格式化多个值，但是必须把它们放在一个闭合的圆括号中并且使用逗号进行分隔。下面是一个典型的例子：

![](../Images/image05410.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05411.jpeg)

要格式化的值（在上面的例子中是quantity和total）按出现的先后顺序进行格式化。也就是说，第一个值使用第一个格式限定符（%d）格式化，第二个值（total中存储的值）使用第二个格式限定符（%10.2f）格式化，以此类推。

当指定宽度时，值在给定数量的列中是右对齐的。尽管这是以表格格式输出数字值时的常见布局，字符串数据一般并不采用这个样式。例如，语句

![](../Images/image05412.gif)

会给出下面的输出：

![](../Images/image05413.gif)

然而，如果标题左对齐的话输出会更好看一些。为了指定左对齐方式，在字符串域宽度之前增加一个负号：

![](../Images/image05414.gif)

结果看上去好得多

![](../Images/image05415.gif)

我们下一个例程会提示6罐装的价格和每一罐的容量，然后输出每盎司的价格。程序使用到了你刚学会的读取输入和格式化输出的知识。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05416.jpeg)

程序运行结果

![](../Images/image05417.gif)

自测题

22.编写语句提示并读取用户的年龄。

23.下面的语句序列有什么问题？

![](../Images/image05418.gif)

24.下面的语句序列有什么问题？

![](../Images/image05419.gif)

25.下面的语句序列的输出是什么？

![](../Images/image05420.gif)

26.使用字符串格式化运算符，输出变量bottles和cans的值，使得输出看起来像下面一样：

![](../Images/image05421.gif)

右边的数字应该对齐。（你可以假设数字都是整数并且最多8位数字。）

练习它　现在你可以尝试本章最后的练习：R2.10，P2.6，P2.7。

编程小提示2.4　尽早转换

从用户输入获取数字值时，你应该在输入操作之后立刻将其从字符串表达形式转换为相应的数字值。

获取字符串并保存到一个临时变量，然后在下一个语句中立即将其转换为数字。不要保存字符串形式而且在每次计算中需要数字值时进行转换：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05422.jpeg)

多次重复同样的操作是一个不好的方式。如果这样做的话，你很容易忘记执行这个转换操作。

相反，应该立刻把字符串输入转换成数字：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05423.jpeg)

或者，更好一些的方式是，把函数input和float的调用组合到一个语句中：

![](../Images/image05424.gif)

函数input返回的字符串直接传递给函数float，而不是保存到一个变量中。

如何做2.1　编写一个简单的程序

这个“如何做”演示如何把一个问题描述转换成伪代码，并最终转换成一个Python程序。

问题描述　编写一个程序模拟一个自动售货机。客户选择要买的商品并把钞票插入自动售货机。自动售货机给出购买的商品和零钱。假设所有物品的价格都是25美分的整数倍，机器找零时只能提供美元硬币和四分之一美元的硬币。你的任务是计算每种类型的硬币应该找回多少。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　理解问题：输入是什么？期望的输出是什么？

在这个问题中，有两个输入：

·用户插入的钞票面额

·购买物品的价格

有两个期望的输出：

·机器找回的美元硬币的数量

·机器找回的四分之一美元硬币的数量

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　手工计算具体的实例。

这是一个非常重要的步骤。如果你不能手工计算一些解决方案，很可能你无法写出一个可以自动计算的程序。

我们假设客户购买的物品价值2.25美元而插入了一张5美元的钞票。客户应该得到2.75美元的零钱，或者2个美元硬币和3个1/4美元的硬币。

这对你来说很容易，但是Python程序应该如何得到这个结论呢？关键是要使用便士进行计算，而不是美元。应该找给客户的零钱是275便士。除以100得到2，是美元的数量，余数（75）除以25得到3，是1/4美元的数量。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　编写计算答案的伪代码。

在上一步中，你计算了这个问题的一个具体例子。现在你需要得到一个通用的方法。

如果给定任意的物品价格和付款，你应该如何计算该找零的硬币呢？首先，计算零钱是多少个便士：

![](../Images/image05425.gif)

为了得到美元的数量，除以100并丢弃小数部分：

![](../Images/image05426.gif)

如果你喜欢，可以使用Python中的整除符号：

![](../Images/image05427.gif)

但你不必这样做。伪代码的目的是使用人类容易阅读的形式来描述计算，而不是使用某个特定编程语言的语法。

剩余的零钱可以使用两种方法来计算。如果你知道可以使用整除运算的余数来计算（在Python中，使用求余运算符），你可以这样简单计算：

![](../Images/image05428.gif)

作为替代，也可以使用零钱总数减去美元硬币换算成的便士：

![](../Images/image05429.gif)

为了得到1/4美元的数量，除以25：

![](../Images/image05430.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　声明你需要的变量和常量，并确定它们保存什么类型的值。这里，我们有5个变量：

·billValue

·itemPrice

·changeDue

·dollarCoins

·quarters

我们是否应该引入常量PENNIES_PER_DOLLAR和PENNIES_PER_QUARTER来解释100和25呢？这样做可以使程序很容易适应国际市场，所以我们采用了这个步骤。

因为使用了整除和求余运算符，我们希望所有值都是整数。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　把伪代码翻译成Python程序。

如果你完全使用伪代码完成任务，这个步骤会很容易。当然，你必须知道在Python中如何表示算术运算（例如整除和求余）。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05431.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　提供输入和输出。

开始计算之前，我们提示用户输入钞票面额和物品价格：

![](../Images/image05432.gif)

完成计算之后，我们再显示结果。为使输出更友好，我们对输出的字符串进行格式化，保证输出能够排列整齐：

![](../Images/image05433.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第7步　给出Python程序。

你的计算需要放到一个程序中。确定一个能够描述计算目的的程序名字。在我们的例子中，我们选择使用vending。

在这个程序中，你需要声明常量和变量（第4步），执行计算（第5步），提供输入和输出（第6步）。很明显，你应该首先获得输入，然后执行计算，最后显示输出。在程序开始处定义常量，而在使用之前定义相应的变量。

下面是完成的程序：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05434.jpeg)

程序运行结果

![](../Images/image05435.gif)

编程实战2.2　计算邮票价格

问题描述　模拟一个邮票自动售货机。客户插入美元钞票然后按下“购买”按钮。自动售货机根据客户的付款给出尽可能多的一等邮票，并使用便士（一美分）邮票进行找零。本书完成时一等邮票的价格是44美分。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　理解问题：输入是什么？期望的输出是什么？

在这个问题中，有一个输入：

·客户插入的钱数

有2个期望的输出：

·机器返回的一等邮票的数量

·机器返回的便士邮票的数量

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　手工计算具体的实例。

我们假设一等邮票的价格是44美分，客户插入了1美元。这些钱足够买2张邮票（88美分）但不够买3张邮票（1.32美元）。因此，机器返回2张一等邮票和12张便士邮票。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　编写计算答案的伪代码。

给定钱数和一等邮票的价格，你如何计算这些钱能买多少一等邮票？很明显，答案与下面的商有关

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05436.jpeg)

例如，假设客户支付了1美元，使用便携计算器计算一下商：$1.00/$0.44=2.27。

你如何从2.27得到“2张邮票”呢？它其实就是不带小数部分的商。在Python中，如果两个参数都是整数，这很容易计算。所以，我们直接使用便士进行计算，得到

![](../Images/image05437.gif)

如果用户输入2美元该怎么办呢？分子变成200就可以了。如果邮票价格上涨怎么办？一个更加通用的公式是

![](../Images/image05438.gif)

零钱怎么计算呢？下面给出了一个方法。当客户得到邮票之后，零钱就是客户支付的费用减去已购买邮票的价格。在我们的例子中，零钱是12美分——100与2×44的差。下面是通用的公式：

![](../Images/image05439.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　定义你需要的变量和常量，并决定它们的值的类型。

这里，我们有3个变量：

·dollars

·firstClassStamps

·change

另外还有一个常量FIRST_CLASS_STAMP_PRICE。通过使用常量，我们可以在一个地方修改价格而不需要搜索和替换程序中表示邮票价格的每一个44。

变量dollars和常量FIRST_CLASS_STAMP_PRICE必须是整数，因为firstClassStamps的计算使用了向下整除运算。其他变量也是整数类型，用来保存一等邮票和便士邮票的数量。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　把伪代码转换为Python语句。

我们的计算依赖于用户提供的美元数量，把数学公式翻译为Python语言得到下面的语句：

![](../Images/image05440.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　提供输入和输出。

在计算之前，我们提示用户输入美元的数量并获取这个值：

![](../Images/image05441.gif)

当计算完成之后，显示结果。

![](../Images/image05442.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第7步　编写Python程序。

下面是完整的程序：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05443.jpeg)

程序运行结果

![](../Images/image05444.gif)

计算与社会2.2　奔腾处理器的浮点数bug

1994年，Intel公司发布了当时功能最强大的处理器，奔腾（Pentium）。与之前版本的处理器不同，Pentium拥有一个非常快的浮点数运算单元。Intel公司的目标是与高端处理器厂商在工作站领域强势竞争。奔腾处理器立刻获得了巨大成功。

1994年夏天，来自弗吉尼亚林奇堡学院的Thomas Nicely博士运行了大量计算来分析特定素数系列的倒数之和。结果并不总是与理论预测的值相符，即使他考虑了不可避免的舍入错误。然后Nicely博士注意到同样的程序运行于Intel生产线上在Pentium之前生产的486处理器时可以得到正确的结果。这是不应该发生的事情。浮点数运算的最佳舍入行为已经被电气与电子工程师学会（the Institute for Electrical and Electronics Engineers，IEEE）标准化了，并且Intel公司声称在486和Pentium处理器中都遵守IEEE标准。经过进一步检查，Nicely博士发现确实存在很少的一组数字，其中两个数字的乘法在两种处理器中的计算结果是不一样的。例如，

4 195 835-((4 195 835/3 145 727)×3 145 727)

在数学上等于0，在486处理器上计算也确实可以得到0，但是在Pentium处理器上的结果是256。

事实证明，Intel自己在测试中已经独立地发现了这个bug，并已经开始生产修正了这个bug的芯片。这个bug是该处理器的浮点数乘法运算中用到的一个表的错误引起的。Intel认为这个问题极其罕见。他们声称在正常使用的情况下普通用户每隔27 000年才会遇到一次这样的问题。非常不幸的是，Nicely博士并不是一个普通的用户。

然后Intel公司遇到了一个非常棘手的问题。替换所有已销售的Pentium处理器需要一大笔费用，并且Intel还有大量的超出生产能力的订单。如果不得不作为替换品免费分发这些供不应求的芯片而不是销售这些芯片，这将是一件非常让人恼火的事情。Intel管理层决定赌一下，最初只为那些能够证明自己确实在数学运算中用到了绝对精度的用户替换处理器。很自然地，这并不能行得通，毕竟有几十万的消费者为Pentium处理器支付了700美元甚至更多，他们可不想活在阴影中，因为或许有一天他们的税收程序就会给出一个错误的返回结果。

最终，Intel公司向公众投降，并替换了所有有缺陷的芯片，耗费了大概4.75亿美元。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05445.jpeg)

该图显示了一组数字，最初的Pentium处理器对这些数字计算时会得到错误的商