   

## 4.6　for循环

你经常需要访问一个字符串中的每个字符。Python的for循环（见语法4.2）使得这个过程非常容易实现。例如，假设我们想打印一个字符串，并且每行一个字符。我们不能简单地使用print()函数来打印这个字符串。相反，我们需要迭代这个字符串中的每个字符，并且每迭代一个就立刻打印一个。下面是使用for循环完成这个任务的方法：

![](../Images/image05952.gif)

输出结果为

![](../Images/image05953.gif)

对于字符串stateName中从第一个位置开始的每个字符，循环体都会被执行。在每次循环迭代的开始，下一个字符被赋值给变量letter，然后执行循环体。你应该把这个循环读作“for each letter in stateName”。这个循环等价于下面显式使用了索引变量的while循环：

![](../Images/image05954.gif)

注意for循环和while循环的一个重要区别。在for循环中，元素变量letter被赋值为stateName[0]、stateName[1]，等等。在while循环中，索引变量i被赋值为0、1，等等。

语法4.2　for语句

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05955.jpeg)

for循环可以用来迭代任何容器（包含或存储多个元素的对象）内的元素。字符串是一个存储多个字符的容器，在后面的章节中我们还会学习到Python提供的其他类型的容器。

正如前面的小节中看到的，用来迭代一个范围内整数值的循环是非常常见的。为了简化这类循环的写法，Python提供了range函数来生成可以在for循环中使用的一系列整数。循环

![](../Images/image05956.gif)

按顺序打印从1到9的整数。range函数根据提供的参数来生成一系列值，第一个参数是序列中的第一个值，小于第二个参数值的数值都会被包含在生成的序列中。上面的for循环等价于下面的while循环：

![](../Images/image05957.gif)

注意，结束值（range函数的第二个参数）是不包含在生成的序列中的，所以等价的while循环也在到达这个值之前结束。

默认地，range函数以1为步长创建序列，这可以通过包含一个步长值作为第三个参数来修改。

![](../Images/image05958.gif)

现在，只会输出从1到9之间的奇数。我们也可以让for循环从大到小进行：

![](../Images/image05959.gif)

最后，你可以使用只有一个参数的range函数。这时，range函数生成的数值序列从0开始。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05960.jpeg)

语法4.3　带range函数的for语句

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05961.jpeg)

使用单个参数时，序列为从0开始到小于参数值之间的整数且以1作为步长。如果我们需要执行循环体指定次数，这个形式非常有用，如前面的例子所示。表4-2给出了更多的例子。

下面是for循环的一个典型应用。我们想输出几年内银行账号的余额，如表所示：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05962.jpeg)

这里适合使用for循环，因为变量year从1开始，以固定的增幅移动，直到到达目标值：

![](../Images/image05963.gif)

下面是完整的程序。图4-4给出了对应的流程图。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05964.jpeg)

图4-4　for循环的流程图

ch04/sec06/investment.py

![](../Images/image05965.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05966.jpeg)

程序运行结果

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05967.jpeg)

表4-2　for循环示例

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05968.jpeg)

自测题

25.把程序investment.py中的for循环改成while循环。

26.下面的循环会输出多少个数？

![](../Images/image05969.gif)

27.写一个for循环，输出10到20（包含20）之间的所有偶数。

28.写一个for循环，计算从1到n的所有整数之和。

29.在程序investment.py中，如果要求投资翻倍之后再输出余额，应如何改写？

练习它　现在你可以尝试本章最后的练习：R4.18，R4.19，P4.8。

编程小提示4.1　统计迭代次数

为循环确定正确的下边界和上边界是比较麻烦的事情。应该从0还是从1开始？应该使用<；=b还是<；b作为结束条件？

数一数迭代的次数对于理解循环是非常有用的。对于非对称边界的循环而言，比较容易数。循环

![](../Images/image05970.gif)

被执行b-a次。下面等价的for循环也是一样的。

![](../Images/image05971.gif)

这样的非对称边界对于遍历一个字符串中所有字符的情况是非常有用的：循环

![](../Images/image05972.gif)

运行len(str)次，i从0到len(str)-1遍历字符串的所有合法位置。（因为这样的循环太常见了，你可以省略range函数中的0。）

带有对称边界的循环，

![](../Images/image05973.gif)

被执行b-a+1次。那个“+1”是很多编程错误的根源。例如，a是10而b为20时，i的取值分别为10、11、12、13、14、15、16、17、18、19和20，一共有11个数：20-10+1。

可视化“+1”错误的一个方法是观察护栏。每一节在左侧有一个柱子，并且最后一节的右侧还有最后一个柱子。忘记数最后的值通常被称作“护栏柱子错误”。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05974.jpeg)

4节护栏需要多少根柱子？很容易出现类似的“差一”问题。

在Python的for循环中，“+1”可以非常明显：

![](../Images/image05975.gif)

你必须指定比指定范围内最后一个值大1的值作为上边界。

如何做4.1　编写一个循环

这个“如何做”带你一起实现一个循环语句。

问题描述　读取12个温度值（每月1个），显示最高温度对应的月份。例如，根据[http://worldclimate.com](http://worldclimate.com)，死亡谷的平均最高温度（按月份顺序，以摄氏度为单位）：

![](../Images/image05976.gif)

在这个例子中，温度最高（45.7摄氏度）的月份是7月，程序应该显示7。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　确定哪些工作必须在循环内完成。

每个循环都需要做某些类型的重复性工作，例如

·读取另一个项目。

·更新一个值（例如银行余额或总数）。

·把计数器加1。

如果你不清楚应该把什么放在循环内部，就把手工解决问题会采取的步骤都写下来。例如，对于最高温度问题，你可能会写下

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05977.jpeg)

现在仔细观察这些步骤，把它们归纳为一组可以放进循环体的统一动作。第一个动作很容易：

![](../Images/image05978.gif)

下一个动作要复杂一些。在我们的描述中，我们使用的测试是“高于第一个”、“高于第一个和第二个”和“高于目前为止看到的最高温度”。我们需要得到一个可以适用于所有迭代的测试。最后的形式是最通用的。

类似地，我们必须找到一个设置最高温度月份的一般方法。我们需要一个变量来存储当前月份，从1到12变化。然后把第二个循环动作形式化为：

![](../Images/image05979.gif)

完整的循环为

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05980.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　指定循环条件。

在循环中想要达到什么目标？比较典型的例子有

·计数器到达其终值了吗？

·读取到最后一个输入的值了吗？

·某个值到达给定的阈值了吗？

在我们的例子中，只是简单想让当前月份到达12。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　决定循环类型。

我们把循环分为两大类。计数控制的循环会执行定义好的次数，事件控制的循环无法提前知道迭代次数——循环在特定事件发生之前会一直执行。

计数控制的循环可以使用for语句来实现。for语句既可以迭代字符串之类的容器中单个元素，又可以结合range函数来迭代一系列整数。

事件控制的循环使用while循环实现，由循环条件决定循环何时结束。有时，决定循环的条件会在循环体内部发生改变。在那种情况下，你可以使用布尔变量来指定何时想离开循环，这样的变量称作标志。一般用法如下：

![](../Images/image05981.gif)

总起来说，

·如果你需要迭代一个容器的所有元素，并且不考虑它们的位置，使用简单的for循环即可。

·如果你需要迭代某个范围内的整数，使用带range函数的for循环。

·其他情况下，使用while循环。

在我们的例子中，我们读取12个温度值。因此，可以使用for循环并且使用range函数迭代一系列整数。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　设置首次进行循环时用到的变量。

列出在循环内使用和更新的所有变量，然后确定如何初始化它们。一般地，计数器被初始化为0或1，总数被初始化为0。

在我们的例子中，变量有

![](../Images/image05982.gif)

我们要很仔细地设置最高温度的值，不能简单地设置为0。毕竟，我们的程序需要适用于南极洲的温度值，所有的温度可能都是负数。

一个不错的选择是把最高温度值设置为第一个输入的值。当然，接下来我们需要记住还剩下11个值要读取，当前月份从2开始。

我们还需要把最高温度的月份设置为1。毕竟，在南极洲的城市，我们可能永远找不出比一月更温暖的月份了。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　处理循环结束后的结果。

在很多情况下，想要的结果就是在循环体内更新的变量值。例如，在我们的温度程序中，结果是最高温度的月份。有时候，循环会计算很多值以便确定最终结果。例如，假设要求计算温度的平均值。那么循环就应该计算所有温度之和，而不是平均值。循环结束后，才能计算平均值：用总和除以输入的数量：

下面是完整的循环：

![](../Images/image05983.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　使用具体的例子来跟踪循环。

像4.2节那样手工跟踪你的循环。选择几个不太复杂的样本值——执行3到5次循环一般就可以发现一些常见错误了。要特别注意循环的第一次和最后一次进入。

有时，你可能想做一些小的改动使得跟踪更容易。例如，在手工跟踪投资翻倍程序时，把利率从5%替换为20%。在手工跟踪温度循环时，使用4个数据值，而不是12个。

假设数据为22.6 36.6 44.5 24.2，下面是跟踪的过程：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05984.jpeg)

上面的跟踪过程说明highest month和highest value的设置都是正确的。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第7步　使用Python实现循环。

下面是我们例子的循环。练习P4.4会让你写出完整的程序。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05985.jpeg)