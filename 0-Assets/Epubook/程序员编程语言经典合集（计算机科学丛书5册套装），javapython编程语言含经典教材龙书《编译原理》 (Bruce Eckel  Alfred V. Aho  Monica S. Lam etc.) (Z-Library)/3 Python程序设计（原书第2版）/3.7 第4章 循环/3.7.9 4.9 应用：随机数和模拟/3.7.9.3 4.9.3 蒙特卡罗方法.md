   

### 4.9.3　蒙特卡罗方法

对于那些不能精确求解的问题，蒙特卡罗方法是一种非常巧妙的寻找近似解的方法。（该方法以蒙特卡罗的著名赌场命名。）这里是一个经典的例子。圆周率π是很难计算的，但是使用下面的模拟可以很好地近似它。

模拟往一个半径为1的圆的外切正方形内发射飞镖。那很容易：随机生成介于-1和1之间的数字作为x坐标和y坐标就可以。

如果生成的点落在圆内，称作一次命中，也就是x2+y2≤1成立的情况。因为我们发射飞镖是完全随机的，可以认为hits/tries的比值非常近似于圆的面积与正方形面积的比值，也就是π/4。因此，我们使用4×hits/tries来逼近π。这个方法可以得到π的近似值，只需要使用很简单的数学。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06034.jpeg)

为了生成介于边界a和b之间的浮点数，计算

![](../Images/image06035.gif)

由于r介于0（包括）和1（不包括）之间，所以x介于a（包括）和b（不包括）之间。在我们的应用中，x永远不会到达上边界（b=1），这没什么关系。满足方程x=1的点位于面积为0的一条直线上。

下面是实现这个模拟的程序：

ch04/sec09/montecarlo.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06036.jpeg)

程序运行结果

![](../Images/image06037.gif)

自测题

40.如何使用random方法模拟投掷硬币？

41.如何模拟随机挑选一张扑克牌？

42.为什么程序dice.py的循环体内调用两次randint(1，6)？

43.在很多游戏中，你会投掷一对骰子然后得到介于2和12之间的一个数字。下面模拟投掷一对骰子的代码有什么错误？

![](../Images/image06038.gif)

44.如何生成大于等于0并且小于100的随机浮点数？

练习它　现在你可以尝试本章最后的练习：R4.27，P4.7，P4.25。

编程实战4.3　图形：靶心

问题描述　开发一个图形程序，在浅灰色背景上绘制交替的黑色和白色环，并且在中心绘制一个红色的靶心。

靶子上圆环的数量应该由用户提供，但必须介于2和10之间。每个圆环25像素宽，靶心的直径应该是圆环宽度的两倍。最外层的圆环必须是黑色的，然后接下来的圆环白色和黑色交替。最后，图形窗口的尺寸应该适应靶子的尺寸，并且图形窗口的四个边都距离靶子最外层圆环10个像素。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第1步　定义常量。

你应该为问题描述中指定的约束和尺寸定义常量。这也使得可以在必要的时候很方便地修改这些约束。

该问题上指定了几个幻数：

![](../Images/image06039.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第2步　由用户提供圆环的数量。

因为靶子上圆环的数量有限制，我们需要验证用户输入：

![](../Images/image06040.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第3步　决定如何绘制圆环。

每个圆环可以绘制为填充的圆，从外到内依次绘制每个圆即可。里面的圆会填充外面较大圆的中心部分，形成圆环的效果

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第4步　决定图形窗口的尺寸。

图形窗口的尺寸是依赖于靶子的尺寸的，而靶子的尺寸也就是最外层圆环的尺寸。为了决定最外层圆环的半径，我们可以累加所有圆环宽度和靶心的半径（与一个圆环的宽度相等）。我们知道圆环的数量和每个圆环的宽度，所以计算为

![](../Images/image06041.gif)

靶子的尺寸就是最外层圆环的直径，或者半径的两倍：

![](../Images/image06042.gif)

最后，靶子与图形窗口的边框还有TARGET_OFFSET个像素的距离。综合考虑偏移量和靶子的尺寸，我们如下计算图形窗口的尺寸

![](../Images/image06043.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第5步　绘制靶子的圆环。

为了绘制靶子上的圆环，我们从最外层的圆开始往里绘制。我们可以使用一个基本的for循环，每次迭代时绘制一个圆，包含几个步骤：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06044.jpeg)

最先绘制的最外层圆的直径必须在循环的第一次迭代之前初始化。最外层圆的直径与靶子的尺寸相等。靶子的限定盒子在水平和垂直两个方向都与图形窗口有TARGET_OFFSET个像素的距离。

![](../Images/image06045.gif)

为了选择绘制圆的颜色，我们可以根据循环变量i的值来做决定。因为循环变量从0开始，当循环变量为偶数时绘制黑色圆，为奇数时绘制白色圆。

![](../Images/image06046.gif)

为了绘制圆，使用画布的drawOval方法，并且指定限定盒子的宽度和高度都是这个圆的直径。drawOval方法还需要指定限定盒子的左上角位置：

![](../Images/image06047.gif)

里面每个圆的直径需要减少2次圆环的宽度，限定盒子的位置需要在两个方向上往里移动一个圆环的宽度。

![](../Images/image06048.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第6步　在中心绘制靶心。

绘制完黑色和白色圆环之后，我们还需要在中心位置把靶心绘制为一个红色填充的圆。当循环结束时，圆的参数（位置和直径）会被设置为绘制那个圆需要的值。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05174.jpeg)第7步　使用Python实现你的解决方案。

下面给出了完整的程序。注意，我们使用画布的setBackground方法来设置画布的背景颜色为浅灰色，而不是默认的白色。（ezgraphics模块的完整描述参见[http://ezgraphics.org](http://ezgraphics.org)。）

ch04/worked_example_3/bullseye.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06049.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image06050.jpeg)