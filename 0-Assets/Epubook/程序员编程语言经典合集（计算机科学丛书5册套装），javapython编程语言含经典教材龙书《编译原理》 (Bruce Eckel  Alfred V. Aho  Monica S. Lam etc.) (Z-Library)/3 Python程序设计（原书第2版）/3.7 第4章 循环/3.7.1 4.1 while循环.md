   

## 4.1　while循环

在本节中，你会学习到循环语句，在达到目标之前重复执行指令。

回顾第1章中的投资问题。你把10 000美元存入银行账号，每年5%的利息。多少年之后账号余额会翻倍呢？

在第1章中，我们编写了下面的算法来解决这个问题：

![](../Images/image05873.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05874.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05875.jpeg)

你现在知道如何在Python中创建和更新变量了，还不知道的是如何执行“Repeat steps while the balance is less than$20 000”。

在Python中，while语句实现这样一个重复（见语法4.1）。形式为：

![](../Images/image05876.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05877.jpeg)

在粒子加速器中，亚原子粒子在环形隧道中穿梭多次，最终获得物理实验需要的速度。类似地，在计算机科学中循环中的语句在条件成立时会一直执行  

只要条件保持成立，while语句中的语句就一直执行。这个语句块叫作while语句的循环体。

语法4.1　while语句

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05878.jpeg)

在我们的例子中，当余额少于目标余额20 000美元之前，年度计数器加1并且增加利息：

![](../Images/image05879.gif)

while语句是循环的一个例子。如果你画出流程图，执行流再次转向条件测试的位置（见图4-1）。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05880.jpeg)

图4-1　while循环的流程图

你经常会想执行一系列语句一定的次数，可以使用由一个计数器控制的while循环，就像下面的代码：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05881.jpeg)

有人称这个循环是计数控制的。作为对比，程序doubleinv.py中的while循环被称作是事件控制的，因为它会一直执行，直到发生某个事件，也就是余额达到预期目标。另一个常用于计数控制的循环的词是确定的。你从外面就可以知道循环体会被执行确定的次数，在我们的例子中，10次。与之相反，你不知道积累到目标余额需要多少次迭代，这样的循环称为不确定的。

下面是解决投资问题的程序，图4-2演示了这个程序的执行过程。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05882.jpeg)

图4-2　Execution of the doubleinv.py Loop

ch04/sec01/doubleinv.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05883.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05884.jpeg)

程序运行结果

![](../Images/image05885.gif)

自测题

1.投资变成3倍需要多少年？修改并运行程序。

2.如果利率是每年10%，投资翻倍需要多少年？修改并运行程序。

3.修改程序，每年输出一次余额。你如何实现？

4.假设我们修改程序使得循环条件为

![](../Images/image05886.gif)

会对程序造成什么影响？为什么？

5.下面的循环会输出什么？

![](../Images/image05887.gif)

练习它　现在你可以尝试本章最后的练习：R4.1，R4.5，P4.13。

表4-1展示了while循环的例子。

表4-1　while循环例子

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05888.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05889.jpeg)

常见错误4.1　不要想“我们完成了吗？”

在做某个重复的事情时，大多数人想知道什么时候才能完成。例如，你可能会想，“我想得到至少20 000美元”，然后把循环条件设置为

![](../Images/image05890.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05891.jpeg)

在编写循环条件时，不要问“我们完成了吗？”，条件是用来决定循环要运行多久的  

但是while循环想的恰好与我们相反：我被允许执行多久？正确的循环条件是

![](../Images/image05892.gif)

换句话说：“当余额少于目标时就一直执行。”

常见错误4.2　无限循环

一个非常让人上火的循环错误是无限循环：一直运行并且只能通过杀死程序或者重启计算机来结束的循环。如果循环内有输出语句，那么会有很多行输出在屏幕上飞过。否则，程序就静止地待在那儿挂着，好像什么事情也没有做。在某些系统中，你可以通过按下Ctrl+C组合键来结束一个没有反应的程序。在其他系统中，你可以通过关闭计算机来结束这样的程序。

无限循环的一个常见原因是忘了更新控制循环的变量：

![](../Images/image05893.gif)

在这个代码中，程序员忘记在循环中增加一个语句year=year+1。结果就是year一直保持为1，循环永远无法结束。

无限循环另一个常见原因是不小心把本应该减少的计数器增加了（或者相反）。看下面的例子：

![](../Images/image05894.gif)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05895.jpeg)

就像无法在跑步机上停止跑步的仓鼠一样，无限循环永远不会结束  

变量year应该是逐步减少的，而不是增加。这是一个非常常见的错误，因为增加计数器远比减少更常见，以至于你的手指不由自主地就打成了+。作为结果，year总是大于0，循环永远不会结束。

常见错误4.3　差一错误

考虑我们关于投资翻倍需要的年数的计算：

![](../Images/image05896.gif)

变量year应该从0开始还是从1开始？测试条件应该是balance<；TARGET还是balance<；=TARGET？在这些表达式中很容易出现差一错误。

有人试图通过随机插入+1或-1直到程序看起来能够工作，这是一个非常糟糕的策略。这样需要很长的时间去测试所有的可能。花费一点点脑力会节省很多时间。

幸运的是，差一错误很容易避免，设计一组测试用例，使用测试用例的信息得出一个用于判断和决策的依据。

变量year应该从0还是1开始？看一个使用简单值的场景：初始余额为100美元而利率为50%。1年以后余额为150美元，2年以后为225美元，超出了200美元。所以投资会在2年后翻倍。循环执行两次，每次把year增加1，所以变量year必须从0开始，而不是1。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05897.jpeg)

换句话说，变量balance表示每个年末的余额。在循环开始之前，变量balance包含0年之后的余额，而不是1年之后的余额。

接下来，我们应该在测试中使用<；还是<；=呢？这稍微有点麻烦，因为余额很难恰好是初始余额的两倍。在利率为100%时会发生这种情况，循环执行一次。现在year为1，balance精确等于2*INITIAL_BALANCE。1年以后投资翻倍了吗？是的。因此，循环不应该再执行了。如果条件是balance<；TARGET，循环结束，和应该发生的情况一样。如果测试条件被写作balance<；=TARGET，循环会多执行一次。

就是说，在余额还没有被翻倍之前就持续增加利息。

计算与社会4.1　第一个bug

据说，第一个bug是在哈佛大学的巨型机电式计算机Mark II中发现的。那真的是被一个虫子引起的——一只飞蛾掉进了继电器开关。

实际上，从操作员在日志本上飞蛾旁边做的记录来看（见图），术语“bug”那时就已经开始使用了。

计算机科学家先驱Maurice Wilkes写道：“在莫尔学院以来，人们总是认为让程序正确工作不会有什么特别的困难。我可以记住那个时刻，让我意识到我未来生命中的一大部分时间可能会花费在查找自己程序中的错误上。”

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05898.jpeg)

第一个Bug