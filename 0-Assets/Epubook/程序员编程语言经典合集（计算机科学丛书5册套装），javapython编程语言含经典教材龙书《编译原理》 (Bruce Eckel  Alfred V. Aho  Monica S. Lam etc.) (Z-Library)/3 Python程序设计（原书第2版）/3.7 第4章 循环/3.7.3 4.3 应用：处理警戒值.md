   

## 4.3　应用：处理警戒值

在这一节中，你会学习到如何编写循环读取和处理一系列输入的值。

无论何时，只要你读取一系列输入，就需要有个方法能够暗示这个序列的结束。有时候你很幸运，没有值为0的输入。这时，你可以提示用户一直输入数字，或者输入0表示结束这个序列。如果允许输入0而不允许输入负数，你可以使用-1表示输入的结束。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05914.jpeg)

在军队中，哨兵看守一个边界或通道。在计算机科学中，警戒值表示一个输入序列的结束，或者两个输入序列的 边界  

这样的值不是实际的输入，而是用来作为结束的符号，叫作警戒值。

让我们在计算一组工资值的平均值的程序中使用这个技术。在我们的程序中，一个雇员很确定不可能得到负数的工资，但是有可能会有免费工作的志愿者。

在循环内部，我们读取一个输入。如果输入是非负值，我们就处理它。为了计算平均值，我们需要计算所有工资的和以及输入的数量。

![](../Images/image05915.gif)

任何负数都可以结束循环，但是我们提示使用-1作为警戒值，以便用户不需要考虑输入哪个负数。注意，如果没有检测到警戒值我们就会一直待在循环内。

![](../Images/image05916.gif)

有一个问题：第一次进入循环时，还没有读入任何值。我们必须保证使用一个值来初始化salary，而这个值可以满足while循环条件使得循环至少执行一次。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05917.jpeg)

循环结束之后，我们计算和打印平均值。

下面是完整的程序：

ch04/sec03/sentinel.py

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image05918.jpeg)

程序运行结果

![](../Images/image05919.gif)

有些程序员不喜欢使用警戒值之外的其他值来初始化输入变量这样的小技巧。这样尽管可以解决问题，但是需要在循环体内使用一个if语句测试警戒值。另一种方法是使用两个输入语句，一个在循环之前来获取第一个值，另一个在循环底部来读取更多的值：

![](../Images/image05920.gif)

如果用户输入的第一个值就是警戒值，那么循环体内的代码永远不会执行。否则，这个值会像前一个版本的循环一样被处理。循环之前的输入操作称作预读取，因为它用来准备或初始化循环变量。

循环底部的输入操作用来获取下一个输入，一般称作修改读取，因为它会在循环内部修改循环变量的值。注意，这是循环的下一次迭代之前最后一条被执行的语句。如果用户输入警戒值，循环结束。否则，循环继续并处理这个输入。

专题4.1给出了处理警戒值的第三种方法，其中用到了布尔变量。

现在让我们来考虑可以接收任意数字（正数、负数或0）的情况。这时，你必须使用不是数字的警戒值，例如字母Q。

由于input函数接收用户输入并返回一个字符串，你可以在将其转换为数字值用来计算之前检查这个字符串并判断用户是否输入了字母Q。

![](../Images/image05921.gif)

注意，把输入转换为实数的操作是循环内的第一条语句，这样可以同时处理预读取和修改读取的字符串。

最后，考虑你需要输入多个字符串的情况，例如，一系列姓名。我们仍然需要一个警戒值来标记数据提取的结束。使用类似于Q这样的字符串不是个好主意，因为它可能是一个合法的输入。你可以使用空字符串来代替。当用户没有输入任何内容就直接按下回车键，input函数返回空字符串：

![](../Images/image05922.gif)

自测题

11.如果在提示输入一个值时用户直接输入了-1，程序sentinel.py会输出什么？

12.程序sentinel.py为什么有两个下面形式的检查

![](../Images/image05923.gif)

13.在程序sentinel.py中，如果把salary变量的初始化修改为

![](../Images/image05924.gif)

会发生什么？

14.在本节第二个例子中，我们提示用户“Enter a value or Q to quit.”当用户输入一个不同的字母时会发生什么？

练习它　现在你可以尝试本章最后的练习：R4.14，P4.30，P4.31。

专题4.1　使用布尔变量处理警戒值

也可以使用布尔变量处理警戒值来控制循环的结束：

![](../Images/image05925.gif)

用于决定循环是否结束的真正测试是在循环中间进行的，而不是在顶部。这称作半路循环，因为执行到半路才能知道循环是否应该结束。作为一种替代，你也可以使用break语句：

![](../Images/image05926.gif)

break语句会跳出所在的循环，与循环条件无关。当遇到break语句时，循环结束，继续执行紧跟着循环的语句。

在半路循环中，break语句是非常有用的。但是很难说清楚什么时候使用break是安全的和什么时候应该避免使用break语句。在本书中，我们不使用break语句。

专题4.2　输入与输出重定向

考虑计算输入序列值的平均值的程序sentinel.py。如果你使用这样的程序，很可能你的数据已经在一个文件中了，如果还要再重新输入一遍这些数据就有点耻辱了。操作系统的命令行界面提供了一种方法可以把文件连接到程序的输入，就好像文件中的所有字符真的由用户输入一样。如果你键入

![](../Images/image05927.gif)

程序被执行，但是不再从键盘接收输入。所有的输入命令都会从文件numbers.txt中获取它们的输入，这叫做输入重定向。

输入重定向是用来测试程序的一个非常棒的工具。在开发程序和修复bug时，每次运行程序时都要把同样的内容重新输入一遍，这是非常烦人的。花费几分钟把这些输入放到一个文件中，然后使用输入重定向，可以完美地解决这个问题。

你还可以对输出进行重定向。在这个程序中，那是非常有用的。如果你运行

![](../Images/image05928.gif)

文件output.txt中包含了输入提示和最终输出，例如

![](../Images/image05929.gif)

然而，重定向输出对于会产生大量输出的程序是很有用的。你可以对包含输出的文件进行格式化和打印。