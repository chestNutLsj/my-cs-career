   

### 4.2.9　断言检查

断言（assertion）是一种对程序状态进行声明的语言。断言可以为真或假，但是应该只有在程序中不包含错误时才为真。例如，下面代码中所有的语句都是断言：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10047.jpeg)

注意，尽管这些断言中的每一个都会根据n和limit的值取值为真或假，但是如果该程序在正确地执行，那么它们都应该为真。断言“断言”在程序执行达到断言所在的位置时，程序代码的某些状态为真。尽管本例是一个循环，但是你也可以在其他情况中编写断言。

在Java中，你可以检查某个断言是否为真，并且如果不为真，可以停止程序并显示错误消息。Java中的断言检查具有下面的形式：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10048.jpeg)

如果以某种方式运行程序，并且Boolean_Expression为假，那么程序就会在显示一条有关断言失败的错误消息后结束。但是，如果Boolean_Expression为真，那么就不会发生任何特殊的事情，程序会继续执行。

例如，前面的代码可以写成如下的形式，其中的两行注释被替换成了断言检查：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10049.jpeg)

注意，我们只将三行注释中的两行转译成了断言检查。并非所有的断言注释都可以转换为断言检查。例如，最后一条注释是一个断言，其要么为真要么为假，如果程序代码是正确的，那么它必然为真。但是，没有任何简单的方式可以将最后这条注释转译为一个布尔表达式。这么做并非不可能，但是你需要使用其自身比待检查的代码还要更复杂的代码来实现此目的。关于是否要将一条注释转译为断言检查，取决于特定场景下的细节。

你可以打开或关闭断言检查。在调试代码时打开断言检查，让失败的断言停止程序，并显示错误消息。一旦代码完成调试，就可以关闭断言检查，从而忽略断言检查，让代码运行得更高效。因此，你可以在程序中留下断言检查，但是在调试完程序后忽略它们。

运行程序的正常方式是将断言检查关闭。为了将断言检查打开运行程序，可以使用下面的命令：

![](../Images/image10050.gif)

如果使用的是集成开发环境（IDE），可以查看其文档，找到设置断言检查的选项。

回顾：断言检查

语法

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10051.jpeg)

你可以将断言检查放置在代码中的任何位置上。如果断言检查被打开，并且Boolean_Expression为假，那么程序就会显示一条恰当的错误消息并终止执行。如果断言检查没有被打开，那么就会将断言检查当作注释处理。

示例

![](../Images/image10052.gif)

自测问题

21.4.2.8节中代码的缺陷是什么？

22.在下面的代码中添加合适的输出语句，使得所有变量都可以被跟踪：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10053.jpeg)

23.上一个问题的代码中的缺陷是什么？

24.什么是断言？给出一些断言的例子。

25.假设你的Java中没有断言检查（早期版本的Java确实没有），编写一些代码来模拟下面的断言检查，其中balance是double类型的变量：

![](../Images/image10054.gif)