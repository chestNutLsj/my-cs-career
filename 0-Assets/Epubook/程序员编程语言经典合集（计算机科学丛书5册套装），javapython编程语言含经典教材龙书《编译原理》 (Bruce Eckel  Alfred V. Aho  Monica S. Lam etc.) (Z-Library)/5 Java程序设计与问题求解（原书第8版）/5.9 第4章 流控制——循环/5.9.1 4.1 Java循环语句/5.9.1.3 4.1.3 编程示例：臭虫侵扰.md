   

### 4.1.3　编程示例：臭虫侵扰

本例涉及的是真正的臭虫，而不是编程缺陷！假设你的家乡遭受了蟑螂的侵扰，这可不是什么喜闻乐见的好事，但幸运的是，当地一家名为Debugging Expert（灭虫专家）的公司拥有能够消灭房屋中蟑螂的办法。俗话说，“脏活累活总得有人去干。”唯一的问题是镇上的公民过于自以为是，在情况失去控制之前，他们不可能花力气去消灭蟑螂。因此，这家公司在当地的一家购物中心安装了一台计算机，让人们了解他们房屋里的问题会有多糟糕。这台计算机上的程序会计算蟑螂的数量从地板到房顶充满整个房屋所需花费的星期数。

蟑螂数量的增长相对较慢，但是情况仍旧十分糟糕。如果听之任之，那么蟑螂的数量几乎每周就会翻一倍。如果每周数量翻一倍，那么其增长率就会达到每周100%，聊以自慰的是，实际情况是每周为95%。这些蟑螂还会长大。按照体积来计算，它们的平均尺寸为0.002立方英尺[^1]稍小一点。该程序会做一些简化假设，它假设房屋中没有任何家具，而蟑螂在填充房屋时彼此之间没有任何空隙。当然，真实的情况远比这个程序所描绘的场景要复杂得多。

让我们来思考解决这个问题所需的步骤。算法的第一个草稿版本看起来如下所示。

蟑螂数量问题的算法（草稿）

1.获取房屋的体积

2.获取房屋中初始的蟑螂数量

3.计算蟑螂填满房屋的星期数

4.显示结果

因为我们知道蟑螂数量的增长率和它们的平均尺寸，所以不需要读入这些值，但是在程序中应该把它们定义为常量。

我们的算法看起来十分简单，但是先别着急召集程序员来开发。第3步如何处理？它是解决方案的核心，但是我们没有给出任何如何执行该计算的信息。让我们再思考一下。我们需要计算星期数，因此用一个初值为0的计数器来计数。因为我们知道蟑螂的平均尺寸和初始的蟑螂数量，所以通过将这两个值相乘就可以得到蟑螂的总体积。这样就得到了第0周的蟑螂总体积。完事了吗？如果这些蟑螂已经填满了整个房屋，那么确实就完事了。如果没填满，那就必须再加上第1周孵化出来的新蟑螂的体积。我们再次询问是否完事了。如果没有，继续加上第2周孵化出来的新蟑螂的体积，以此类推。啊！我们需要的是一个循环。

应该使用什么样的循环呢？在有些情况下，我们可能无法立即决定，这两种循环都可以。但是对于这个问题，我们发现初始的蟑螂数可能就已经能够填满房屋了。如果属于这种情况，不需要计算任何东西，即，我们不需要执行设计出来的循环体。因此，我们应该使用while循环，而不是do-while循环。但是，让我们来看看在没有得出这个结论之前，应该做些什么。

无论我们是否知道应该使用哪种循环，都可以设计如下的常量和变量：

·GROWTH_RATE——蟑螂数量每周的增长率（常量0.95）。

·ONE_BUG_VOLUME——蟑螂的平均体积（常量0.002）。

·houseVolume——房屋的体积。

·startPopulation——初始的蟑螂数量。

·countWeeks——星期的计数器。

·totalBugVolume——所有蟑螂的总体积。

·newBugs——这一周新孵化的蟑螂数量。

·newBugVolume——新蟑螂的体积。

你可能无法一下子考虑清楚会用到的所有变量。随着对伪代码的不断精化，你可以将想起来的其他变量添加到上面的列表中。在设计和编写程序时，维护一张单独的变量及其含义的列表会显得非常有价值。

编程窍门：做笔记

在编写第一条Java语句之前，应该先花时间去设计程序。编写伪代码、画图和编写变量及其含义的列表。也就是说，将思想组织起来，呈现在纸面上。这样产生的程序比仓促编码的程序在组织结构和正确性上都要好很多。

我们可以将算法中的第3步替换为下面的步骤：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09955.jpeg)

3b.重复直至房屋被臭虫填满。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09956.jpeg)

观察步骤3b，可以注意到Java中并没有“重复直至”结构，我们可以重新描述为“当房屋没有被臭虫填满时，重复直至房屋被臭虫填满”，或者“当臭虫的体积小于房屋的体积时重复”。因此，我们使用下面的结构：

![](../Images/image09957.gif)

将这些片段组装起来，就可以获得下面的算法：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09958.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09959.jpeg)

我们的循环直接更新了蟑螂的数量、蟑螂的体积和星期的计数器。因为增长率和一只臭虫的体积都是正数，所以我们知道population的值以及totalBugVolume的值将在每次循环迭代中增大。因此，最终totalBugVolume的值会超过houseVolume的值，并且控制布尔表达式：

![](../Images/image09960.gif)

会变成假并终止while循环。

变量countWeeks初始值为0，并且在循环的每次迭代中递增1。因此，当循环终止时，countWeeks的值就是蟑螂的体积超过房屋体积时所花的星期数。

程序清单4.3展示了我们的Java程序和样例输出。

程序清单4.3　计算蟑螂数量的程序

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09961.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09962.jpeg)

疑难杂症：无限循环

一种常见的程序缺陷是循环无法终止，永远不停地重复其循环体。（在概念上永远地执行。）永无停止地迭代其循环体的循环称为无限循环。正常情况下，while循环或do-while循环的循环体中的某条语句会修改一个或多个变量，以便能够使控制布尔表达式变成假。但是，如果这些变量没有以正确的方式改变，那么就有可能会陷入无限循环。

例如，让我们思考一个与程序清单4.3中程序稍有变化的版本。假设你的家乡出现了大批吃蟑螂的青蛙，这些青蛙吃蟑螂的速度极快，以至于蟑螂的数量在下降。这样，蟑螂的增长率就为负值。为了反映这个事实，你可以将一个具名常量的定义修改为下面的样子，然后重新编译该程序：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09963.jpeg)

如果做出上述修改并运行程序，那么只要房屋中初始的蟑螂数量是一个相对较小的值，while循环就会是一个无限循环。因为蟑螂的总量在持续下降，蟑螂的总体积因而也在不断下降，所以控制布尔表达式totalBugVolume<houseVolume会一直为真。因此，该循环永远无法终止。

有些无限循环并不会真的永远运行，程序会在某种系统资源被耗尽时终止。但是，有些无限循环如果不加干涉，就会永远运行。为了能够终止包含无限循环的程序，你应该学习如何强制程序停止运行。实现此目的的方式取决于操作系统，在许多系统中（但并非在所有系统中）可以通过键入Ctrl-C来停止程序的执行，即按住Ctrl键的同时按下C键。

有时，程序员可能会有意识地编写无限循环。例如，ATM机在典型情况下是由程序中的无限循环控制的，该循环不停地处理存钱和取钱的操作。但是，在此刻，你设计的程序中产生的无限循环可能就是个错误。

自测问题

1.下面的代码会产生什么样的输出？

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09964.jpeg)

2.while的循环体可以执行0次吗？do-while的循环体可以执行0次吗？

3.下面的代码会产生什么样的输出？

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09965.jpeg)

4.修改下面的代码，让其使用while循环而不是do-while循环：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09966.jpeg)

5.下面的代码会产生什么样的输出？

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09967.jpeg)

6.设想有一个程序，使用下面的语句来读取城市的人口数量：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09968.jpeg)

在这些语句后面编写一个while循环，确保population为正数。如果用户输入的人口数量为负数或0，那么就要求用户输入一个非负值。

[^1]:  1立方英尺＝0.028 316 8立方米。——编辑注

[^2]:  1立方英寸＝0.000 016 4立方米。——编辑注