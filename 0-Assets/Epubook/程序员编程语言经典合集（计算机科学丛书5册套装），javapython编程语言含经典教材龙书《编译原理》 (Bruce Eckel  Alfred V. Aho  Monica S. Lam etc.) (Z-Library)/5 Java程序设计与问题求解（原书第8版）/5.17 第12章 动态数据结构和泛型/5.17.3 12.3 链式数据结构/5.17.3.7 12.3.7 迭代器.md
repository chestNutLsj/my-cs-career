   

### 12.3.7　迭代器

当我们持有像链表节点这样的对象集合时，经常需要遍历集合中的所有对象，并在每个对象上执行一些动作，例如将其显示到屏幕上，或者以某种方式编辑其数据。迭代器是指任何使得我们可以以这种方式遍历列表的变量。

程序清单12.7　节点类作为内部类的链表

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11379.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11380.jpeg)

我们将从研究数组的迭代器入手，因为它比链表的迭代器更容易编程。数组是具有相同数据类型的元素的集合，数组的迭代器是int变量。如果数组名为anArray，该int变量名为index，那么我们可以按照下面的方式遍历数组中的所有元素：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11381.jpeg)

int变量index是迭代器。我们可以用index++这个动作来迭代，即逐个元素地遍历。

如果我们创建了一个由某个链表中所有数据对象构成的数组，那么就可以迭代遍历该数组。这个过程等价于迭代遍历该链表，前提是我们并不想修改该链表中的数据，而只是想查看这些数据。正是因为这个原因，列表类中通常会有一个方法将链表中的所有数据都放入一个数组中。程序清单12.8展示了一个这样的方法，这个方法名为toArray，可以添加到程序清单12.7的列表类中。（StringLinkedListSelfContained类也包含这个方法，该类可在网站上的源代码中找到。）

程序清单12.8　将链表的数据放入一个数组

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11382.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11383.jpeg)

回顾：迭代器

任何使得我们可以以合理的方式每次访问一项地遍历像数组或链表这样的数据项集合的变量都称为迭代器。这里“合理的方式”是指在一次完整的迭代循环中，每一项都只会被访问一次，且每一项的数据都会被读取，如果这些数据项允许，还可以修改它们。

如果想要得到一个迭代器，通过它可以遍历链表，并且使得我们可以执行诸如修改节点中的数据和插入或删除节点这类的操作，那么仅仅得到由链表数据构成的数组是不够的。但是，数组的迭代器已经暗示了我们可以如何处理。就像索引指定了数组元素一样，节点的引用指定了节点。因此，如果在程序清单12.7的链表类StringLinkedListSelfContained中添加一个实例变量，其名称可以为current，那么就可以将这个实例变量用作迭代器。我们在程序清单12.9中就是这么做的，并将这个类重命名成了StirngLinkedListWith-Iterator。正如你所见，我们添加了许多方法来操作实例变量current。这个实例变量就是迭代器，但是因为它被标记为了private，所以我们需要操作它的方法。我们还添加了用于在链表中任意位置添加和删除节点的方法，迭代器使得我们可以更容易地表示这些添加和删除节点的方法，因为它为我们提供了一种可以命名任意节点的方式。让我们过一遍其中的细节。

程序清单12.9　带有迭代器的链表

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11384.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11385.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11386.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11387.jpeg)

除了实例变量head和current，我们还添加了名为previous的实例变量。这里的想法是，就像current引用沿着链接在链表中向前移动一样，previous引用会沿着链接在链表中往回移动一个节点。这种设置为我们提供了一种方式，可以引用由current命名的节点前面的节点。因为链表中的链接都是按照一个方向移动的，所以我们需要previous节点，这样才能执行相当于往回移动一个节点的操作。

resetIteration方法会通过给current赋值为对第一个（头）节点的引用将current的初始值设为链表的开头，如下所示：

![](../Images/image11388.gif)

因为实例变量previous没有可以引用的上一个节点，所以通过resetIteration方法将其直接赋值为null。

goToNext方法会将迭代器移动到下一个节点，如下所示：

![](../Images/image11389.gif)

这个过程如图12.7所示。在goToNext方法中，多重if-else语句的后两个子句会在使用goToNext方法显得无意义的场景下产生一条错误消息。

moreToIterate方法会在current不等于null时，即，只要current中包含对某个节点的引用时，就返回true。这个结果在大多数情况下都是有意义的，但是为什么在current包含对最后一个节点的引用时，这个方法也会返回true呢？当current引用的是最后一个节点时，我们的程序无从知晓它是最后一个节点，只有再次调用goToNext时，此刻current才被设置成了null。研究图12.7或者goToNext的定义可以了解这个过程是如何工作的。当current等于null时，moreToIterate会返回false，表示整个列表都已经被遍历。

现在，我们的链表拥有了迭代器，我们的代码也就拥有了可以引用链表中任意节点的途径。current实例变量可以持有对另一个节点的引用，这个节点称为迭代器处的节点。insertNodeAfterIterator会将新节点插入到迭代器处（current处）的节点后面，图12.8展示了这个过程。deleteCurrentNode会删除迭代器处的节点，图12.9展示了这个过程。

旁白：内部和外部迭代器  

StringLinkedListWithIterator类（程序清单12.9）使用了ListNode类型的实例变量current作为迭代器来逐个遍历链表中的节点。在链表中以这种方式定义的类称为内部迭代器。  

如果通过toArray方法将链表中的值复制到一个数组中，那么我们就可以使用int类型的变量作为数组上的迭代器。这个int变量持有的是该数组的一个索引，因此，它指定的是数组中的一个元素和链表中的一个数据项。如果将该int变量命名为position而将该数组命名为a，那么迭代器position指定的就是元素a[position]。为了移动到下一项，可以直接将position的值递增1。在链表外部定义的迭代器（例如int变量position）称为外部迭代器。注意，要点不是数组在链表外部，而是作为迭代器的int变量position在链表外部，为了更好地理解这一点，注意，int变量position也是该数组的外部迭代器。  

你可以同时拥有若干个外部迭代器，每个都指向同一个列表中不同的位置。这对于内部迭代器而言是不可能的，这是它的一个明显劣势。  

我们可以定义一个外部迭代器，它直接操作链表而不是链表数据的数组。但是，这项技术有一点复杂，我们在本书中将不做深入讨论。  

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11390.jpeg)

图12.7　链表的goToNext的效果

StringLinkedListWithIterator类（程序清单12.9）中的其他方法都相当直观，我们将它们的定义留给你去解读，以了解它们是如何工作的。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11391.jpeg)

图12.8　使用insertNodeAfterIterator在链表中添加一个节点

自测问题

22.什么是内部类？

23.为什么程序清单12.7中的内部类ListNode的定义不像程序清单12.4中的ListNode类的定义那样具有访问器和修改器方法getLink、setLink、getData和setData？

24.什么是像数组和链表这样的项的集合上的迭代器？