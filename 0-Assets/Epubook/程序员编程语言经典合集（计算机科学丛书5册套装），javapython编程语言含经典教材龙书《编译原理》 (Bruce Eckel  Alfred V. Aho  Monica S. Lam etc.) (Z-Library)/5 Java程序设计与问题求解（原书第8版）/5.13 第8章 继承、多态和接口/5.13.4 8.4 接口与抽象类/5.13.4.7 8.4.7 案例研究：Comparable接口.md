   

### 8.4.7　案例研究：Comparable接口

Java有许多预定义的接口，许多类都用到了它们。其中之一就是Comparable接口，可用来在实现它的对象上添加排序机制。Comparable接口只有一个方法头，即compareTo，实现Comparable接口的每个类都必须编写该方法：

![](../Images/image10899.gif)

该接口使得我们可以指定一个对象在与另一个对象进行比较时，何时属于“出现在另一个对象前面”，何时属于“出现在另一个对象后面”，何时属于“相等”。正确地遵循这些语义是程序员的职责。例如，如果我们定义A出现在B的前面，而B又出现在C的前面，那么就不应该允许C出现在A的前面。

compareTo方法应该返回：

·一个负数，如果调用对象出现在参数other的前面。

·0，如果调用对象等于参数other。

·一个正数，如果调用对象出现在参数other的后面。

例如，考虑一下“人们无法将苹果与橙子相提并论”这句格言所描绘的场景。让我们来展示这句格言不是十分适用于Java类，因为我们可以见机行事地定义compareTo方法。首先尝试定义一个可以表示苹果和橙子的Fruit类，它的代码看起来如程序清单8.16所示。这个简单的类使用了一个String来存储水果的名字，同时还包含了设置和获取该名字的方法。构造器将接受水果的名字。最初的这次尝试没有实现任何接口。

程序清单8.16　定义Fruit类的首次尝试

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10900.jpeg)

程序清单8.17给出了一个试图使用Fruit类的简短的演示程序。在这个示例中，我们创建了一个包含4个Fruit对象的数组，然后试图使用7.4节描述的Arrays.sort方法对该数组排序。

程序清单8.17　对Fruit对象数组排序的程序

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10901.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10902.jpeg)

程序清单8.17中的程序可以编译运行，但是会产生下面的运行时错误：

![](../Images/image10903.gif)

这个错误之所以会出现，是因为Java不知道如何互相比较两个Fruit类的实例，以便在对该数组排序时，可以查看一个对象是否出现在另一个对象之后。更准确地讲，Arrays.sort方法已经编写为期望传递给它的数组中的对象具有按照Comparable接口编写的compareTo方法。Arrays.sort试图在数组中的对象上调用compareTo方法（例如，查看fruits[0]是否大于fruits[1]），使得它们可以按照顺序重新排列，但是因为该方法并不存在，所以产生了错误。

解决方案是确保Fruit类实现了具有compareTo方法的Comparable接口。有一种将一种水果与另一种水果比较的方式是使用水果名的字典序。当两个字符串要么包含全大写字母，要么包含全小写字母时，字典序与字母序是相同的。例如，苹果出现在橙子前面是因为单词"apple"在字典序中出现在"orange"前面。为了实现此目的，我们可以使用String类中定义的compareTo方法。即，如果我们有两个字符串str1和str2，那么

![](../Images/image10904.gif)

将返回一个负数（str1在字典序中位于str2之前）；或者返回0（str1等于str2）或者返回一个正数（str1在字典序中位于str2之后）。由此，我们为Fruit类编写的compareTo方法可以返回被比较的水果名的compareTo方法的结果。程序清单8.18中的代码包含了突出显示修改部分的Fruit版本。

程序清单8.18　实现Comparable的Fruit类

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10905.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10906.jpeg)

注意，程序清单8.17中的程序运行后会产生下面的输出：

![](../Images/image10907.gif)

Array.sort方法现在可以成功执行了，因为它可以调用compareTo方法来比较数组中的对象并对它们重新排序。为了理清重点，即compareTo方法是在Arrays.sort方法中被调用的，我们可以重新定义compareTo，用不同的标准来对水果排序。我们不再使用字典序，而是使用水果名的长度作为比较的标准。名字短的水果将出现在名字长的水果的前面。下面是compareTo方法的另一种可行的定义：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10908.jpeg)

程序清单8.17中的程序现在会产生下面的输出：

![](../Images/image10909.gif)

水果现在是按照最短的单词出现在最前面的顺序排序的。