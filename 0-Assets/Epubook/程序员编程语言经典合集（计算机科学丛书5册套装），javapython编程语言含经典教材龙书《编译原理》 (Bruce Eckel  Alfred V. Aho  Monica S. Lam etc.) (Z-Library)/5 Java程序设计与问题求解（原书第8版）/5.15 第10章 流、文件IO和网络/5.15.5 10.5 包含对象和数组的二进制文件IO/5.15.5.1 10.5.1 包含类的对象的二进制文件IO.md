   

### 10.5.1　包含类的对象的二进制文件I/O

我们已经看到了如何将基本类型值和字符串写入二进制文件中，以及如何再次将它们读取出来。如何写入和读取字符串之外的其他对象呢？当然，我们可以将对象的实例变量写入文件中，然后再发明某种方式在读取文件内容时重构该对象。因为实例变量自身可能又是另一个对象，而这个对象又可能还有一个实例变量是对象，所以，完成这项任务听起来就让人觉得难以应付。

幸运的是，Java提供了一种称为对象序列化的简单方式，可以将对象表示成能够写入二进制文件的字节序列。这种处理会在任何可序列化类的对象上自动发生。让类可序列化很容易，我们只需在类定义的头部添加两个词implements Serializable，如下面的例子所示：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11165.jpeg)

实际上，我们确实需要格外注意有关类的实例变量的一些细节，但是因为这些细节与我们的示例无关，所以会推迟到下一节再讨论它们，那时我们还将讨论序列化的意义。

Serializable是位于java.io包中的Java类库的接口。该接口是空的，因此，我们无须实现任何额外的方法。尽管空接口看起来似乎没什么用，但是这个接口在告知Java让该类可序列化。通过包含下面的import语句就可以让我们的程序可以使用该接口：

![](../Images/image11166.gif)

在程序清单10.9中，我们让第5章程序清单5.17中看到过的Species类成为可序列化的类，并且添加了toString方法。让我们用Species类来演示如何对二进制文件读写对象。

我们可以通过使用ObjectOutputStream类的writeObject方法将可序列化的类的对象写入二进制文件中，然后使用ObjectInputStream类的readObject方法将这些对象从二进制文件中读出。程序清单10.10提供了整个过程的示例。为了将Species类的对象写入二进制文件，我们将该对象当作引元传递给writeObject方法，就像下面的语句一样：

![](../Images/image11167.gif)

其中outputStream是ObjectOutputStream类型的流，而oneSpecies是Species类型的对象。

程序清单10.9　为二进制文件I/O而序列化的Species类

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11168.jpeg)

程序清单10.10　类的对象的文件I/O

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11169.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11170.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11171.jpeg)

牢记：将对象写入二进制文件

只要对象的类是可序列化的，你可以用writeObject将对象写入二进制文件。在查看预定义类的文档时，请查看该类是否实现了Serializable。

用writeObject方法写入二进制文件的对象可以用ObjectInputStream流类的readObject方法读出，就像从程序清单10.10中抽取的下面这个例子：

![](../Images/image11172.gif)

其中，inputStream是ObjectInputStream类型的流，与用ObjectOutputStream类的writeObject写入数据的文件连接了起来。数据由Species类的对象构成，而变量readOne的类型为Species。注意，readObject会将它的值作为Object类型的对象返回。如果想要将返回的对象当作Species类型的对象来使用，那么就必须将它强制类型转换为Species类型。

在结束这个示例之前，我们来澄清一个可能会存在的误解。Species类有一个toString方法，我们需要用这个方法来确保使用println输出到屏幕上或者输出到文本文件中的内容看起来是正确的。但是，toString方法与将对象I/O到二进制文件中没有任何关系。即使一个类没有覆盖toString方法，它的对象也可以I/O到二进制文件中。