   

### 10.3.6　案例研究：处理由逗号分隔的数值文件

逗号分隔的数值文件（comma-separated values）即CSV文件，是一种用来存储记录列表的简单文本格式。将逗号当作界定符来分隔每条记录中的各个域（也称为列）。这种格式通常可用来在电子表格程序、数据库或定制的应用程序之间传递数据。例如，考虑收银机的例子，它会将一天内的销售日志记录到名为Transactions.txt的CSV文件中，这个文本文件包含下面的数据：

![](../Images/image11134.gif)

文件的第一行是标识各个域的文件头。第一个域SKU表示库存单位（Stock-Keeping Unit），这是与每种销售产品相关联的唯一标识符。第二个域是交易中售出的SKU的数量。第三个域是单价，最后一个域是对销售物品的描述。例如，文件的第二行表示以$0.99的单价售出了50单位的苏打，而苏打的SKU是4039。

有许多方式可以用来处理数据，在这个案例研究中，我们呈现的是一种简单策略，用来读取文件中的每个域，将每笔交易按照更像英语的格式输出，并且计算收银机的销售总额。大致的算法如下：

1.读取并跳过文件头行。

2.在到达文件末尾之前，重复下面的操作：

a）从文件中将一个整行（一条记录）当作字符串读出。

b）用读取的行创建一个字符串数组，其中array[0]是第一个域的值，array[1]是第二个域的值，以此类推。

c）将字符串数组中任何数字型的域转换为适合的数字型数据类型。

d）处理各个域。

算法中步骤2b看起来好像很困难。在这一步，我们刚刚从文件中读取了一行，在本例中，我们将第一行"4039，50，0.99，SODA"读取到了String类型的变量中。因为逗号用来分隔各个域，所以我们搜索这个字符串中的第一个逗号，抽取出从该字符串开头到这个逗号之间的子字符串，从而抽取出第一个域，然后，对后续的域重复此过程。但是，与String类关联的split方法会帮我们实现此操作，其定义如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11135.jpeg)

该方法会将字符串按照delimiter的匹配进行分割，返回由delimiter分隔的字符串数组。将delimiter参数当作正则表达式来解释，这是一种很灵活的用来匹配模式的方式。考虑到我们的目标，在使用这个方法时，直接使用了包含逗号界定符的字符串。下面的示例展示了split的用法：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11136.jpeg)

程序清单10.4将这项技术应用到了销售交易的场景中，剩下的部分就是读取文件、将数量解析为整数、将价格解析为double，并添加了业务逻辑，通过将产品销售数量与单价相乘来计算销售总额。在这个程序中，我们使用了System.out.printf将单价和总额格式化为包含两位小数。

程序清单10.4　处理包含销售交易的由逗号隔开的数值文件

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11137.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11138.jpeg)