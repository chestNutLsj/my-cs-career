   

### 10.4.6　EOFException类

许多从二进制文件中读取数据的方法都会在试图从超出文件末尾的位置上读取数据时抛出EOFException。就像程序清单10.7中所展示的，在使用ObjectInputStream时，EOFException类可用来测试是否达到了文件的末尾。在这个样例程序中，从文件中读取数据的语句被放置在一个布尔表达式为true的while循环中。尽管这个循环看起来就像是“无限的”，但是它确实会终止：当到达文件末尾时，就会抛出异常，从而终止整个try块，将控制权传递给catch块。

程序清单10.7　使用EOFException

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11157.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11158.jpeg)

将程序清单10.7中的程序与程序清单10.6中类似的程序进行比较会显得很有意义。程序清单10.6中的程序通过测试是否是负数来检查是否到达了文件末尾。这种方式不错，但是它意味着文件中除了用作哨兵值的负数之外，不能存储任何其他负数。另一方面，程序清单10.7中的程序使用EOFException来检查是否到达了文件末尾。因此，它可以处理存储了任何种类整数的文件，包括负整数。

回顾：EOFException类

当使用图10.6中列举的ObjectInputStream类的方法从二进制文件中读取基本类型数据时，如果你的程序试图从超过文件末尾的位置读取数据，那么就会抛出EOFException。这个异常可以用来终止从文件中读取所有数据的循环。

EOFException类是从IOException类中派生的，所以每一个EOFException类型的异常同时也具有IOException类型。

编程窍门：总是要检查是否到达了文件的末尾

如果你的程序从超过文件末尾的位置读取数据，那么不会有任何好果子吃。具体会发生什么取决于程序的细节：它可能会进入无限循环，或者会异常地终止。总是要确保你的程序会检查是否到达了文件的末尾，并且在到达时执行恰当的操作。尽管你认为你的程序不会越过文件末尾去读取数据，你还是应该提供对这种偶发事件的检查，以应对可能会产生程序并未完全按照你计划的方式执行的情况。

疑难杂症：以错误的方式检查是否到达了文件的末尾

不同的文件读取方法会以不同的方式检查是否到达了文件的末尾，这些方法通常位于不同的类中。有些会在试图越过文件末尾读取数据时抛出EOFException类的异常，有些会返回特殊的值，例如null。在从文件中读取数据时，你必须仔细地以正确的方式测试是否到达了文件的末尾，这时可能会发生两件事：要么你的程序将无意中进行无限循环，要么你的程序会异常地终止。

并非所有类中的所有方法都会在试图越过文件末尾位置读取数据时抛出EOFException异常。对于本书中讨论的类，具体规则如下：如果你的程序是在从二进制文件中读取基本类型数据，那么它会抛出EOFException异常。但是，如果你的程序是在从文本文件中读取数据，那么它会返回文件末尾处的某个特殊值，例如null，并且不会抛出任何EOFException异常。

回顾：探测二进制文件中数据的末尾

你可以用下面两种方式之一来读取二进制文件中的所有数据：

·通过探测在文件末尾写入的哨兵值。

·通过捕获EOFException异常。