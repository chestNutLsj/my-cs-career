   

### 10.4.5　从二进制文件中读取内容

如果使用ObjectOutputStream向二进制文件中写入内容，那么我们可以使用Object-InputStream流类从该文件中读取内容。图10.6给出了这个类的一些最常用的方法。如果将这些方法与图10.5中ObjectOutputStream类的方法进行比较，就会发现每个输出方法都有一个对应的输入方法。例如，如果用ObjectOutputStream的writeInt方法向某个文件中写入一个整数，那么我们就可以用ObjectInputStream的readInt方法从该文件中读取这个整数。如果用ObjectOutputStream的writeDouble方法向某个文件中写入一个数字，那么我们就可以用ObjectInputStream的readDouble方法从该文件中读取这个数字，以此类推。

我们可以用ObjectInputStream打开一个二进制文件用于输入，打开方式与已经看到过的用ObjectOutputStream打开二进制文件用于输出类似。程序清单10.6中的程序打开了一个二进制文件，并且将其连接到了一个名为inputStream的流上，就像下面这样：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11150.jpeg)

注意，这条语句与程序清单10.5中类似的语句很像，只是这里我们使用的是Object-InputStream和FileInputStream类而不是ObjectOutputStream和FileOutput-Stream类。与前面一样，定义了我们所需方法的类没有接受字符串作为引元的构造器。另外，FileInputStream的构造器可能会抛出FileNotFoundException异常，这是一种IOEx-ception。如果FileInputStream的构造器成功执行，那么ObjectInputStream的构造器有可能会抛出另一个不同的IOException。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11151.jpeg)

图10.6　ObjectInputStream类中的一些方法

ObjectInputStream使得我们可以从同一个文件中读取不同类型的输入。因此，我们可以读取int值、double值和String值的组合。但是，如果文件中下一个数据项不是读取方法所期望的类型，那么读取的结果可能就有些令人恼火了。例如，如果我们的程序用writeInt写入了一个整数，那么任何读取该整数的程序都应该使用readInt来读取它。如果我们使用的是readLong或readDouble，那么我们的程序就会以不可预知的方式产生错误的行为。

程序清单10.6　使用ObjectInputStream从文件中读取内容

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11152.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11153.jpeg)

回顾：从二进制文件中读取

语法

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11154.jpeg)

示例

请查看程序清单10.6。

回顾：FileInputStream和FileOutputStream

在本书中，我们只使用了FileInputStream和FileOutputStream类的构造器，没有用到其他东西。这两个类都有一个接受文件名作为引元的构造器。我们使用这些构造器来产生传递给流类的构造器的引元，例如ObjectInputStream和ObjectOutputStream类，这些类的构造器无法接受文件名作为引元。下面是使用FileInputStream和File-OutputStream的示例：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11155.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11156.jpeg)

我们分别在程序清单10.6和程序清单10.5中使用了类似的语句。FileInputStream和FileOutputStream的构造器可以抛出FileNotFoundException类的异常，而FileNot-FoundException是一种IOException。

疑难杂症：使用ObjectInputStream读取文本文件

二进制文件和文本文件对数据编码的方式不同。因此，期望读取二进制文件的流（例如ObjectInputStream类中的流）在读取文本文件时就会有问题。如果试图使用ObjectInputStream类中的流去读取文本文件，那么你的程序要么会读取到“垃圾值”，要么会碰到某种其他的错误情况。类似地，如果试图使用Scanner将二进制文件当作文本文件读取，同样会遇到麻烦。

自测问题

16.编写一些Java代码，创建一个名为fromFile的ObjectInputStream类型的输入流，并将其与名为stuff.data的文件连接起来。

17.给出三条语句，从文件stuff.data中读取3个double类型数字。请使用你在上一个自测问题中创建的fromFile流。声明三个变量持有这三个数字。

18.给出一条语句，关闭在上两个自测问题中创建的fromFile流。

19.你是否可以用writeInt向文件中写入一个数字，然后用readLong读出它？你是否可以用readDouble读出它？

20.你是否可以用readUTF从文本文件中读取一个字符串？

21.编写一个完整的Java程序，让用户输入二进制文件的名字，并将该文件中的第一个数据项输出到屏幕上。假设第一个数据项是一个用writeUTF方法写入该文件的字符串。