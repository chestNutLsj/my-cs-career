   

### 2.1.14　案例研究：售货机找零

售货机通常有一个小型的计算机，用来控制其操作。在这个案例研究中，我们将编写一个程序来处理一项需要由这样的小型计算机执行的任务，该程序的输入和输出分别经由键盘和屏幕来执行。为了将这个程序集成到售货机的计算机中，我们必须将这段代码嵌入更大的程序中，这个更大的程序可以从键盘之外的其他地方获取数据，并且可以将结果输出到除屏幕之外的地方，但那是另外一个场景了。在这个案例研究中，用户会输入从1到99美分的零钱金额，而程序的响应是告知用户一种硬币组合方案，使得所有硬币的金额总和等于零钱的金额。

例如，如果用户输入表示55美分的55，那么程序就会告知用户55美分可以由两个25美分的硬币和一个5美分的硬币组成。假设我们认为用户和程序之间的交互应该像下面这样：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09578.jpeg)

实际上，像这样在对程序编码之前编写样例对话框，会有助于我们解决问题。

程序需要变量来存储零钱的金额和每种硬币的数量。因此，程序中至少需要下面的变量：

![](../Images/image09579.gif)

处理了例行任务之后，现在，我们已经准备好处理该问题的核心了。

我们需要一个用来计算每种硬币数量的算法。假设我们想出了下面的伪代码：

计算amount美分中硬币数量的算法

1.读取金额到变量amount中。

2.将变量quarters设置为等于amount中允许的25美分硬币的最大数量。

3.将amount重置为扣除25美分硬币金额之后的剩余金额。

4.将变量dimes设置为等于amount中允许的10美分硬币的最大数量。

5.将amount重置为扣除10美分硬币金额之后的剩余金额。

6.将变量nickels设置为等于amount中允许的5美分硬币的最大数量。

7.将amount重置为扣除5美分硬币金额之后的剩余金额。

8.pennies=amount；

9.显示最初的金额和每种硬币的数量。

这些步骤看起来很合理，但是在急于编码之前，还是先用一个例子试试看。如果我们有87美分，那么可以将amount设置为87。87美分中有多少个25美分呢？3个。因此quarters变成了3，我们还剩87–3*25，即12美分，将其存储在amount中。amount中的12美分就是一个10美分和两个1美分，因此，dimes为1，nickels为0，而pennies为2。

我们来显示结果。最初我们有多少钱？amount现在为2。我们的87美分呢？该算法改变了amount的值，但是我们在最后需要显示原始的amount的值。为了修正这个错误，我们要么在改变amount的值之前先显示它的值，要么将其原始的值存储到一个新的变量originalAmount中。如果选择后一种方式，那么就可以像下面这样修改伪代码：

计算amount美分中硬币数量的算法（修正版）

1.读取金额到变量amount中。

2.originalAmount=amount；

3.将变量quarters设置为等于amount中允许的25美分硬币的最大数量。

4.将amount重置为扣除25美分硬币金额之后的剩余金额。

5.将变量dimes设置为等于amount中允许的10美分硬币的最大数量。

6.将amount重置为扣除10美分硬币金额之后的剩余金额。

7.将变量nickels设置为等于amount中允许的5美分硬币的最大数量。

8.将amount重置为扣除5美分硬币金额之后的剩余金额。

9.pennies=amount；

10.显示originalAmount和每种硬币的数量。

我们需要编写出与伪代码执行相同操作的Java代码，其中许多部分是例行操作。伪代码的第一行直接用命令行提示用户，然后读取键盘上的输入。下面的Java代码对应于伪代码的第一行：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09580.jpeg)

伪代码的下一行设置了originalAmount的值，它已经是Java代码了，所以我们无须做任何转译。

到目前为止，程序的主要部分读起来像下面这样：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09581.jpeg)

接下来，我们需要将下面的两个步骤转译为Java代码：

3.将变量quarters设置为等于amount中允许的25美分硬币的最大数量。

4.将amount重置为扣除25美分硬币金额之后的剩余金额。

让我们思考一下。在之前的示例中，我们有87美分。为了获得87美分中25美分的数量，我们会看看87是25的多少倍，即用87除以25得到商为3、余数为12。因此quarters为3。因为余数12小于25，所以我们无法在87美分中凑出4个25美分，而是只能有3个。哦！我们意识到了可以使用操作符/和%来执行这种除法。例如，

87/25等于3（87中25的最大数量）

87%25等于12（余数）

使用amount来代替87，就会得到下面两行语句：

![](../Images/image09582.gif)

按照类似的方式来处理dimes和nickels，得到下面的代码：

![](../Images/image09583.gif)

程序编码的剩余部分很简单，最终的程序显示在程序清单2.3中。

程序清单2.3　找零程序

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09584.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09585.jpeg)

编写好程序之后，需要在大量不同类型的数据上进行测试。对于我们的程序，测试数据值应该包括使所有可能的硬币种类的数量分别为0的各个值，以及像25美分和26美分这样的值，它们产生的结果包含了从全部由25美分构成到由25美分和另一个硬币构成的各种不同情况。例如，我们会使用下面的输入测试程序：0、4、5、6、10、11、25、26、35、55、65、75和76，等等。

尽管所有测试都会成功，但是程序的输出并不一定使用了正确的语法。例如，当输入为26美分时，会产生下面的输出：

![](../Images/image09586.gif)

这些数字是正确的，但是如果能够输出1 quarter而不是1 quarters，1 penny而不是1 pennies，会显得更好。我们将会在下一章介绍产生这种更精细的输出所需的技术。目前，我们结束这个项目，其输出是正确的，且是可理解的。

编程窍门：程序的基本结构

许多应用程序（包括我们刚刚编写的案例研究中的程序）都具有类似的基本结构。它们的基本步骤很像Dale Carnegie（1888—1955）曾经在演讲中给出的建议：“告诉听众你要讲什么，然后开始讲，讲完后再次告诉他们你讲了什么。”编程通常遵循以下步骤：

1.准备（Prepare）：声明变量并向用户解释该程序。

2.输入（Input）：提示用户并从用户处获得输入。

3.处理（Process）：执行当前的任务。

4.输出（Output）：显示结果。

这种结构（可以缩写为PIPO）对最初上手时编写的程序非常适用。牢记这些步骤有助于在设计和编程时组织你的思路。

自测问题

17.考虑下面这条来自程序清单2.3中的语句：

![](../Images/image09587.gif)

假设用下面这行代码替换上面的语句：

![](../Images/image09588.gif)

这种改变会使得程序清单2.3给出怎样的样例输出？