   

### 2.5.2　介绍JOptionPane类

程序清单2.10包含了一个非常简单的具有窗口化接口的Java应用程序。这个程序会产生3个窗口，每次产生一个。第一个出现的窗口在程序清单2.10中被标记成了Dialog 1，用户可以在这个窗口的文本域中输入一个数字，然后用鼠标点击OK按钮。然后，第一个窗口消失，第二个窗口出现。用户可以按照类似的方式处理这个窗口。当用户在第二个窗口上点击OK按钮时，第二个窗口消失，第三个窗口出现。让我们看看细节。

程序清单2.10　使用JOptionPane类来实现I/O的程序

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09703.jpeg)

牢记：运行JOptionPane程序

你可以按照运行其他任何应用程序的方式来运行使用JOptionPane的程序，例如程序清单2.10中的程序。你不必将其当作小应用程序（applet）来运行。

这个程序使用JOptionPane类来构建与用户交互的窗口。JOptionPane是随Java安装的标准的预定义类。为了在程序中可以使用它，需要编写：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09704.jpeg)

这条语句告诉计算机到哪里去找JOptionPane类的定义。你可以回忆一下，我们提到过名为Swing的库，它是由我们可以用于窗口化界面的类构成的库。这些库称为包，在Java程序中，Swing包指代javax.swing，其中s是小写的。JOptionPane类就在这个包中，之前的import语句就说明了这个事实。你可以将这条语句放在所有使用JOptionPane类的程序文件的开头部分。

在第1章中，我们提到JavaFX正在代替Swing。但是，在此处讨论的JavaFX版本中，没有在简洁性上能与JOptionPane匹敌的版本。正因为此，我们继续使用JOptionPane，直至在JavaFX中出现更好的选择为止。

发送给计算机的第一条程序指令如下：

![](../Images/image09705.gif)

它将appleString声明为String类型的变量，然后启动了窗口化动作。这两行是单条语句，或称为单条指令，通常会写作一行，除非这么做会使得这一行长得令人感到不便。

JOptionPane是用来产生特殊窗口的类，这些窗口称为对话窗口、对话框或直接称为对话，它们要么可以获取输入，要么用来显示程序的输出。showInputDialog方法会产生一个用于获取输入的对话框，其字符串引元（即本例中的"Enter number of apples："）会显示在窗口中，告诉用户需要输入什么。作为程序员，之所以选择这个字符串，是根据所需的输入类型而决定的。这个对showInputDialog方法的调用将产生程序清单2.10中所示的第一个对话框。用户在文本域中点击鼠标，然后键入一些输入。一旦用户完成输入，就可以点击OK按钮，这个窗口就会随之消失。作为另一种操作方式，用户也可以通过按下回车键来代替点击OK按钮。这些都是在帮助完成用户的输入任务，但是我们的程序是如何获得这个输入的呢？继续读下去。

下面的方法调用：

![](../Images/image09706.gif)

将返回（也就是产生）用户在文本域中键入的值。这个调用在用来存储该输入的赋值语句内部，具体来说，该字符串输入会存入变量appleString中。当使用JOptionPane来读取用户输入时，只会读取字符串值。如果想要读取数字，程序就必须将输入字符串转换为数字。

旁白：所有输入和输出都是字符串  

所有来自用户的输入和所有给用户的输出都是由字符串构成的。当使用JOptionPane类读取数字型输入时，必须将读取的字符串转换为想要的数字，就像你将要看到的那样。甚至Scanner类也是将用户的输入当作字符串读取的。但是，当调用像nextInt或nextDouble这样的方法时，会自动地执行从字符串输入到数字型输入的转换。  

下一条语句始于将变量appleCount声明为int，其中int表示存储到变量apple-Count中的值必须是整数。编写这个程序的程序员想让用户在第一个输入窗口中输入一个整数，并且想让该程序将这个整数存储到变量appleCount中。因为JOptionPane只读取字符串，所以这意味着我们需要将字符串转换为int类型的值。为了了解这种转换为什么是必需的，让我们假设用户在对话框中输入了10，表示有10个苹果。用户实际上输入的是字符'1'，后面跟着字符'0'，从而产生了字符串"10"。当使用这些输入窗口时，你必须意识到所有来自用户的输入以及相应的给用户的输出都是由字符串构成的。如果想要让程序将来自输入窗口的输入当作数字看待，那么就必须将像"10"这样的字符串转换成像本例中的10这样对应的数字。对计算机而言，"10"和10是完全不同的东西。（在现实生活中，它们也不同，但是我们通常会忽略这种差异。）"10"是一个由两个字符构成的字符串，而10是一个可以和其他数字执行加减操作的数字。

在程序清单2.10中，用户键入的字符串存储在变量appleString中。因为我们希望用户键入的是整数的各个数字位，所以我们的程序需要将这个字符串转换为一个整数。我们将所产生的int值存储在变量appleCount中，就像下面这样：

![](../Images/image09707.gif)

Integer是Java提供的类，parseInt是Integer类的方法。方法调用Integer.parseInt（appleString）会将存储在变量appleString中的字符串转换为对应的整数。例如，如果存储在变量appleString中的字符串是"10"，那么这个方法调用将会返回整数10。

常见问题：为什么在调用某些方法时，需要使用类名而不是对象名？

正常情况下，方法调用使用的是对象名。例如，如果greeting是一个String类型的变量，那么我们会编写greeting.length（）来调用方法length。但是，当调用JOptionPane类的方法时，我们使用的是类名JOptionPane，而不是对象名。调用Integer类的parseInt方法时，也是如此。这是怎么回事呢？有些特殊的方法并不需要在对象上调用，而是可以使用类名来调用。这些方法称为静态方法，我们将在第6章讨论它们。尽管静态方法只占所有方法中很小的一部分，但是它们会用于执行某些基础任务，例如I/O，因此，我们很早就已经碰到它们了。通过在Oracle网站上查看Java类库中某个类的文档，就可以知道其某个标准方法是否是静态的。

疑难杂症：不恰当的输入

当程序非正常终止时，我们称其崩溃了，其原因通常是某些东西出错了。当一个程序像程序清单2.10那样使用JOptionPane.showInputDialog来获取输入时，用户必须以正确的格式键入输入信息，否则该程序很可能会崩溃。如果一个程序希望输入的是整数，并且用户输入的是2，000而不是2000，那么该程序将崩溃，因为Java中的整数不能包含逗号。稍后你将会学习到如何编写更健壮的窗口化程序，它们并不要求用户要非常内行并且非常仔细。在这之前，你必须告诉用户要非常仔细地输入。

程序清单2.10中接下来的几条语句与我们刚刚讨论的语句相比，只是稍微有些变化。它们会产生程序清单2.10中的第二个对话框，并且获取来自用户的输入字符串。该字符串会被转换成对应的整数，并存储到变量orangeCount中。

该程序接下来的一行对你来说并不包含任何新特性：

![](../Images/image09708.gif)

它将totalFruitCount声明为int类型的变量，并且将它的值设置为两个变量apple-Count和orangeCount中的int值的和。

现在，这个程序该显示存储在变量totalFruitCount中的数字了，这个输出任务是由下面这条语句完成的：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09709.jpeg)

这条语句调用了showMessageDialog方法，它是JOptionPane类的另一个方法。这个方法显示了一个用于展示输出的对话框，它有两个引元，由逗号分隔。目前，我们暂时让第一个引元总是写作null，以后我们再对null的含义做出解释，在此之前，你不需要对null做过多考虑，只需将它看作是一个占位符，因为我们不需要任何“实际的”第一个引元。第二个引元很容易解释，它是要在输出对话框中显示的字符串。因此，前面这个方法调用会产生程序清单2.10中所示的第三个对话框。这个对话框会一直停留在屏幕上，直至用户用鼠标点击OK按钮或按下回车键，此时，该窗口会消失。

注意，你可以像在使用System.out.println时向其传递作为引元的字符串时所采用的方式一样，使用加号向showMessageDialog传递其字符串引元。也就是说，你可以将存储在totalFruitCount中的整数值追加到一个字符串字面值后面。而且，Java会自动地将这个存储在totalFruitCount中的整数值转换为对应的字符串。

疑难杂症：只显示一个数字

在程序清单2.10中，最终的程序输出通过下面的语句被发送到了输出窗口中：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09710.jpeg)

对所有输出都进行标记说明是一种良好的样式。因此，显示下面的字符串：

![](../Images/image09711.gif)

对于程序的样式和可理解性而言，都很重要。而且，对showMessageDialog方法的调用甚至无法编译，除非在输出中包含字符串。例如，下面的语句是无法编译的：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09712.jpeg)

showMessageDialog方法不会接受int值以及任何其他基本类型的值作为第二个引元。但是如果将这个变量或数字通过加号与字符串连接起来，那么这个数字就会被转换为字符串，然后这个引元就可以被接受了。

程序清单2.10中最后一条程序语句：

![](../Images/image09713.gif)

直接声明该程序应该终止。System是一个Java会自动提供的预定义类，而exit是System类中的方法。exit方法会在其被调用时立即终止程序。在我们编写的程序中，整数引元0可以是任何整数，但是按照惯例，我们会使用0，因为它用来表示程序正常终止。下一章我们将正式讨论这个方法。

疑难杂症：忘了System.exit（0）；

如果从程序清单2.10的程序中删除最后一行：

![](../Images/image09714.gif)

那么我们之前描述的各项任务都可以完成。用户将使用输入窗口键入输入信息，输出窗口将显示输出。但是，当用户点击输出窗口中的OK按钮时，输出窗口将消失，但是程序不会终止。“不可视的”程序将仍旧在那里消耗计算机的资源并且可能会阻碍你做其他事情。对于窗口化程序而言，一切尘埃落定才算真正的结束。程序实际上是由System.exit（0）终结的，而不是靠执行完所有语句终结的。因此，不要忘了在所有窗口化程序中调用System.exit（0）。

如果忘记了调用System.exit（0），并且程序自身无法终止时，该怎么办呢？你可以终止一个自身无法终止的程序，但是如何做取决于你所使用的操作系统。在许多系统（但不是所有系统）上，你可以通过键入Ctrl-C来终止程序，就是保持Ctrl键按下的同时按下C键。

在编写具有窗口化界面的应用程序时，总是需要用下面的语句终止程序：

![](../Images/image09715.gif)

如果该程序没有使用窗口化界面，就像2.1节到2.4节的程序那样，那么就无须调用System.exit（0）了。

常见问题：为什么有些程序需要System.exit，而有些则不需要？

使用窗口化界面的应用程序，例如程序清单2.10中的程序，必须以下面的方法调用结尾：

![](../Images/image09716.gif)

使用简单文本输入和输出的程序，就像本章之前小节中的程序，并不需要这个调用。为什么会有这种差别呢？

如果一个程序使用的是简单的文本输入和输出，那么Java可以很容易地知道它何时应该终止，即所有语句都执行完之后就应该终止。对于具有窗口化界面的应用程序而言，情况就不那么简单了。Java无法很容易地知道窗口化的程序何时应该终止。许多窗口化程序只有在用户点击了某个按钮或者执行了某个其他的动作之后，才会终止。这些细节由程序员而不是Java语言来决定。本节中的简单程序碰巧会在其所有语句执行之后终止，但是对于更复杂的窗口化程序而言，何时终止并不容易发现，因此，你必须通过调用System.exit来告诉Java程序何时终止。

回顾：用于窗口化输入/输出的JOptionPane

可以使用showInputDialog和showMessageDialog方法来为你的Java程序产生输入和输出窗口，这些窗口称为对话框。当使用这些方法时，要在包含程序的文件开头处包含下面的语句：

![](../Images/image09717.gif)

使用这些方法的输入和输出语句的语法如下所示。

输入的语法

![](../Images/image09718.gif)

String_Expression会显示在对话窗口中，该窗口有一个用户可以键入输入信息的文本域，以及一个标记为OK的按钮。当用户键入一个字符串并点击窗口上的OK按钮时，该方法会返回该字符串。这个字符串会存储在String_Variable中。作为另一种操作方式，用户也可以通过按下回车键来代替点击OK按钮。注意，当以这种方式完成输入时，读取的总是字符串。如果想要让用户键入整数，那么程序就必须将输入字符串转换为等价的数字。

示例

![](../Images/image09719.gif)

输出的语法

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09720.jpeg)

String_Expression会显示在对话窗口中，该窗口有一个标记为OK的按钮。当用户用鼠标点击OK按钮或者按下回车键时，该窗口会消失。

示例

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09721.jpeg)

自测问题

35.在下面两行代码中，有一个命名类的标识符、一个命名方法的标识符和一个作为引元的项。其中，类名是什么？方法名是什么？引元是什么？

![](../Images/image09722.gif)

36.编写一条Java语句，它能够在屏幕上的对话窗口中显示下面的消息：

![](../Images/image09723.gif)

37.编写一条Java语句，当执行它时，会终止程序。

38.如果从程序清单2.10的程序中删除System.exit（0），会发生什么？这个程序可以编译吗？它运行时会有问题吗？

39.编写一个完整的Java程序，它会产生一个包含了消息HelloWorld！的对话窗口。你的程序不需要做任何其他事情。

40.编写一个完整的Java程序，执行下面的行为。该程序会显示一个输入对话窗口，让用户输入一个整数。当用户输入一个整数并点击了OK按钮时，该窗口会消失，并且会出现一个输出对话框。这个窗口会告诉用户输入的是什么数字。当用户点击该窗口上的OK按钮时，该程序终止。（嗨，这只是第2章，以后的程序会变得足够复杂的。）