   

### 5.2.9　封装

在第1章中，我们提到封装与隐藏软件部件的工作细节相关。既然现在已经具备了有关Java和信息隐藏的更多知识，就可以对其基本定义进行扩展，称封装就是将类定义中所有对于理解如何使用该类对象的非必需的细节隐藏起来的过程。让我们来看一个例子。

假设我们想驾驶汽车，对于这项任务，怎样才是描述汽车的最有用的方式呢？很明显，肯定不是列出气缸数并解释它们的工作流程，包括吸入空气和汽油、对油气混合物点火以及排除废气。这些细节对我们学习如何驾驶汽车并没有任何帮助。

对于希望学习如何驾驶汽车，最有用的描述应该包含下面这些信息：

·如果用脚踩加速踏板，那么汽车就会加速运动。

·如果用脚踩刹车踏板，那么汽车就会减速直至最终停住。

·如果左右转动方向盘，那么汽车就会朝相同方向转动。

尽管我们还可以描述其他细节，但是这些应该就是主要部分了，并且足以演示封装的概念了。

封装原则就是说，在向其他希望学习驾驶的人描述汽车时，我们应该提供像前面这样的列表。在编程的语境下，封装表示相同的概念。在使用软件的部件时，程序员无须其定义中的所有细节。特别是，如果这个软件部件有10页长，那么交给使用该软件的其他程序员的文档描述应该比10页简短得多。当然，前提是你编写软件的方式有助于书写出这种简短的描述。

另一个有用的类比是汽车有某些东西是可视的，例如踏板和方向盘，而另一些东西则隐藏在引擎盖下面。因此，汽车就是封装好的：只有驾驶汽车时所需的控制部件是可视的，其他细节都隐藏了起来。

类似地，程序部件也应该被封装，使得只有必要的控制部件是可视的，而其细节全都隐藏了。因此，使用该软件的程序员就无须关心其内部细节了。封装如此重要是因为它简化了用封装的软件编写其他软件的程序员的工作。

我们在本章前面有关信息隐藏的主题中已经讨论过一些用于封装的技术了。封装是一种信息隐藏的形式。为了让封装有实际作用，类的定义必须按照程序员可以在不查看被隐藏的细节的情况下就可以使用该类的方式给出。如果执行得恰当，封装就可以很整齐地将类的定义分成两个部分——接口和实现。类的接口[^1]可以告知程序员在其程序中使用该类时所需知道的一切。类的接口包含了该类中所有公有方法的方法头和所有的公有具名常量，以及告诉程序员如何使用这些公有方法和常量的注释。

类的实现包含了类定义中的所有私有元素，其中首要的是类中的私有实例变量，另外还包含公有方法和私有方法的定义。注意，类定义的类接口和实现在Java代码中不是分离的，而是混在一起的。例如，程序清单5.13中Purchase类的类接口就是突出显示的部分。尽管在运行使用某个类的程序时，需要该类的实现，但是我们在编写该程序时无须知道有关该类实现的任何信息。

当使用封装原则定义类时，我们必须在概念上很整齐地将类的接口和实现分离开，使得接口成为类的简化而安全的描述。一种思考这种分离的方式是想象一下在实现和接口之间存在一堵墙，它们之间通过规范的机制穿墙通信。图5.3以图形的方式展示了这堵墙。当以这种方式使用封装来定义类时，我们就称该类是良好封装的。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10241.jpeg)

图5.3　良好封装的类定义

下面是一些定义良好封装的类时最重要的指导原则：

·在类定义的前面放置一条描述程序员应该如何思考类的数据和方法的注释。例如，如果该类描述了钱的金额，那么程序员应该考虑的是元和分，而不是考虑该类是如何表示钱的。在这种情况下，这条注释应该编写为有助于程序员按照这种方式来思考的样子。

·将类中所有实例变量都声明为私有。

·提供公有的访问器方法，用于获取对象中的数据。还要为程序操作类中数据的所有其他基本需求提供公有方法。这些方法都可以包含对应的公有修改器方法。

·在每个公有方法头前面放置一条注释，完整描述如何使用该方法。

·让所有辅助方法都私有。

·在类的定义内部编写注释，描述实现的细节。

类定义中描述如何使用该类和每个公有方法的注释是类接口的一部分。正如我们所描述的，这些注释通常应该放在类定义和每个方法定义的前面。其他注释用于解释实现部分。我们应该遵循的良好规则是对类接口使用/***/风格的注释，而对类实现使用//风格的注释。

当使用封装来定义类时，我们应该能够返回去修改类定义中的实现细节，而无须在使用该类的任何程序中做修改。这是一种不错的可以用来测试类定义是否封装良好的方式。我们经常会有充足的理由去修改类定义中的实现细节。例如，我们可能设计出了一种更高效的实现某个方法的方式，可以让方法调用运行得更快。我们甚至可能会决定修改某些实现的细节，而不修改方法调用的方式和它们基本的功能。例如，如果有一个表示银行账户对象的类，那么我们可能会修改对透支计算罚金的规则。

常见问题：类接口与应用程序编程接口相关吗？

我们在第1章介绍Java API时碰到过术语API，即应用程序编程接口。类的API本质上与类的接口是一回事。在阅读类库的文档时，你将会经常看到术语API。

常见问题：什么是ADT？

术语ADT是抽象数据类型的缩写。它是用来描述一组数据以及这组数据上的操作的规格说明。这些规格说明描述了这些操作要做什么，但是并没有描述如何存储数据和如何实现这些操作。因此，ADT使用的是良好的信息隐藏技术。

回顾：封装

封装是描述现代编程技术时经常会听到的一种术语。封装是指隐藏（封装）有关软件部件工作方式的所有细节，只描述让程序员能够使用该部件所需的信息。封装表示数据和动作被组合成了单个项，在我们的例子中，就是类的对象，该项隐藏了实现的细节。因此，术语信息隐藏、ADT和封装描述的都是相同的基本思想。以非常操作性的术语来描述，这种思想就是要将使用类的程序员从必须了解类是如何实现的细节中解脱出来。

[^1]:  单词接口在Java语言中还有一层技术含义，正如你将会在第8章所看到的那样。我们用这个单词来描述类接口时，其含义有些不同，尽管在本质上接口这个词的这两种用法是相同的。