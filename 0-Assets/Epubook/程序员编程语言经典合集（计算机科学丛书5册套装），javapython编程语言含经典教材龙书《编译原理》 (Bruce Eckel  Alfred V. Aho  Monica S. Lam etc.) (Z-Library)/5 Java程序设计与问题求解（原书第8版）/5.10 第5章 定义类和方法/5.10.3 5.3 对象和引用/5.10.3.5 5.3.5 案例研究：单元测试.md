   

### 5.3.5　案例研究：单元测试

到目前为止，我们对所有的程序都进行了测试，测试方式是运行程序、键入某些输入并凭眼睛观察结果来判断输出是否符合我们的预期。这对于小型程序而言尚可，但是对于大型程序而言通常会显得不够充分。在大型程序中，通常交互输入的组合情况非常多，以至于靠人工去校验所有输入的结果是否正确会花费太多的时间。另外，代码修改也可能会导致意外的副作用。例如，修正某个错误时可能会引入另一个错误。解决这个问题的一种方式就是编写单元测试。单元测试是程序员在测试单个代码单元的正确性时所使用的一种方法学。单元通常是指方法，但是也可以是类或其他的代码组。

单元测试的集合就是测试套件。每个测试通常都会自动执行，以免去人工输入的需要。自动化非常重要，因为让测试频繁而快速地执行是我们所希望的，这样就可以让测试重复地执行，可能每天一次，或者每次修改代码之后执行，以确保所有代码仍旧可以工作。重复地运行测试的过程称为回归测试。

让我们以对程序清单5.19中Species类进行测试的简单案例入手。第一项测试是要校验setSpecies方法是否正确地设置了名字、初始的种群数量和增长率。我们可以通过创建Species类型的对象，调用setSpecies并校验是否所有的值都匹配来完成这项测试：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10271.jpeg)

在这个简单的例子中，我们设计了测试用例的输入，调用了代码，并检查结果是否与预期匹配。如果存在错误，例如在setSpecies方法中忘记将增长率复制到实例变量中，那么该测试用例就会发现这个问题。

测试用例的设计通常比这个例子要复杂。考虑测试predictPopulation方法的情况。我们还是必须先确定恰当的输入，然后查看被测试的单元是否会产生预期的结果。有一种我们可能会尝试的测试称为负面测试。这是一种确定系统在碰到意外输入时不会崩溃的测试。例如，如果传递给predictPopulation的年数为负，那么我们可能会期望该方法返回初始的种群数量。另外，我们还可能用未来1到5年作为输入来测试该方法。程序清单5.20给出了使用testSpecies对象进行这种测试的案例。

一种常见的实践是使用assert语句来编写测试。例如，我们可以不使用if-else语句来编写下面的测试：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10272.jpeg)

不要天真地以为所有测试都通过了就可以确保程序正确地工作，因为有可能存在未测试到的输入值组合会导致程序失败的情况，还有可能将可工作的单元集成起来后存在缺陷的情况。但是，成功的测试运行可以让我们对基本的功能能够工作这一点持有自信。

理想情况下，测试案例应该保持与类的实现分离。在我们的简单示例中，我们创建了一个具有main方法的单独的类来测试Species类。对于更大的项目，我们可以考虑使用像JUnit这样的测试框架，这种框架旨在帮助我们组织和运行测试套件。

程序清单5.20　对Species类的样例测试

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10273.jpeg)