   

### 5.3.2　定义类的equals方法

当用==操作符比较两个对象时，实际上是在检查它们是否在内存中相同的地址上，而不是在检查我们在直觉上所谓的相等性。要想测试直觉概念上的相等性，应该定义名为equals的方法。在程序清单5.17中，我们最后一次修订了物种类的定义，在其中包含了一个equals方法。

使用任何类的equals方法的方式都与使用String的equals方法作用于String类型对象的方式完全一样。程序清单5.18中的程序演示了在我们修订的Species类中定义的equals方法的使用方式。

当两个Species对象具有相同的名字（此处忽略大小写的不同）、相同的种群数量和相同的增长率时，在Species类中的equals方法的定义才会认为这两个对象是相等的。为了比较名字，我们使用了String类的equalsIgnoreCase方法，它会比较两个字符串，在比较时将大写字母当作对应的小写字母来处理。正如我们在第2章中指出的，这个方法是作为Java语言的一部分而自动提供的。我们使用==操作符来计算种群数量和增长率，因为它们都是基本类型。

程序清单5.17　定义equals方法

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10255.jpeg)

注意，程序清单5.17中的equals方法总是会返回true或false值，因此该方法的返回值类型是boolean。return语句看起来有点奇怪，但是它仅仅是一个布尔表达式，与可以用于if-else语句的布尔表达式种类相同。请注意，程序清单5.17中equals的定义可以表示成下面的伪代码，这样有助于你理解这个方法：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10256.jpeg)

这样的修改使得下面这条出自程序清单5.18的语句：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10257.jpeg)

等价于

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10258.jpeg)

我们将在5.3.4节中更多地讨论返回boolean类型值的方法。

对于equals而言，并不存在唯一的普适任何情况的经典定义。我们所编写的equals的定义取决于如何使用其所属的类。程序清单5.17中的定义声明两个Species类的对象只有在它们表示相同的物种名、相同的种群数量和相同的增长率时才是相等的。在其他语境中，你也许希望将相等性定义为表示两个对象具有相同的物种名，但是有可能具有不同的种群数量或不同的增长率。这种情况对应于如果两个对象是对同一个物种在不同时间所反映出来的数据的记录，那么就认为它们是相等的。

程序清单5.18　演示equals方法

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10259.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10260.jpeg)

你应该总是使用标识符equals作为你创建的用于测试两个对象是否相等的所有方法的名字。不要使用其他的标识符，例如same等，甚至不要使用不带s的equal。某些作为Java组成部分的软件将依赖于你使用的精确名equals来测试对象的相等性。这种软件会调用名为equals的方法，因此你的方法最好是这个名字。

如果你没有为你的类定义equals方法，那么Java就会自动创建一个缺省的equals定义，但是它的行为不可能与你期望的相同。因此，最好还是定义你自己的equals方法。