   

### 6.3.1　案例研究：格式化输出

如果有一个double类型的变量，它存储了一笔钱的金额，你的程序应该以一种友好的格式显示这笔金额。但是，你可能会得到下面这样的输出：

![](../Images/image10397.gif)

但是，我们希望得到的输出是下面这样的：

![](../Images/image10398.gif)

在这个案例研究中，我们将定义一个名为DollarFormat的类，它包含两个静态方法write和writeln，它们可以用来产生这种友好的格式化输出[^1]。例如，如果金额存储在类型为double、名称为amount的变量中，那么就可以编写下面的语句来获得这种输出：

![](../Images/image10399.gif)

注意，write和writeln应该自动添加美元符号，并且总是应该只显示小数点后2位数字。因此，这些方法显示的应该是$2.10，而不是$2.1。

当金额在小数点后有超过2位的数字时，我们必须决定应该如何处理额外的数字。假设我们决定对这种数字进行四舍五入，那么如果金额是9.128，得到的输出将会是$9.13。

write和writeln之间的差异与print和println之间的差异相同。在写出输出内容后，write不会前进到下一行，但是writeln会这样做。因此，writeln方法可以直接调用write，然后使用println前进到下一行。

既然我们知道想让这些方法做什么，那么应该如何实现呢？为了显示像9.87这样的金额，我们没什么选择的余地，只能将其断开为9和87，然后分别显示它们。下面的伪代码给出了write方法必须执行的操作的轮廓。

将double金额显示成元和分的算法

（变量amount包含的是要显示的金额。）

1.dollars=amount中整元的数额。

2.cents=amount中分的数额。当小数点后超过2位时，就四舍五入。

3.显示美元符号、dollars和小数点。

4.将cents显示为两位整数。

我们现在需要将这段伪代码转换为Java代码。让我们假设变量amount已经包含了一个double值。为了获得作为int值的整元的数额和分的数额，我们需要以某种形式摆脱小数点带来的困扰。一种方式是将金额全部转换为分。例如，将10.95美元乘以100，就得到了全部转换为分的1095.0。如果转换后分的后面还有数字，例如将10.9567美元转换为1095.67分，那么我们可以使用round方法：Math.round（1095.67）会返回long类型的值1096。

注意，我们想要将这个四舍五入的结果存储到一个int变量中，该变量用于持有全部表示成分的总金额。但是，Math.round返回的是long类型的值，你无法将long类型的值存储到int类型的变量中，尽管它表示的可能是很小的整数。因此，我们需要执行类型强制转换，像下面这样将这个long值转换为int值：

![](../Images/image10400.gif)

这条语句会返回int值1096，因此，我们的代码将以类似下面的语句开头：

![](../Images/image10401.gif)

现在，我们需要将allCents转换为元的金额和分的金额。例如，因为1096分是$10.96，所以我们需要将1096转换为整数10和96。因为1元等于100分，所以我们可以使用整数除法来获得元的数额：

![](../Images/image10402.gif)

整除之后剩下的余额就是分的数额，因此我们可以使用%操作符来获取它：

![](../Images/image10403.gif)

这样，我们就将伪代码的前两个步骤转译成了下面的Java代码：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10404.jpeg)

伪代码的第3步可以直接用Java语句来表示：

![](../Images/image10405.gif)

剩下的就是将最后一条伪代码指令转译为Java代码。

将cents显示为两位整数。

看起来这很容易实现，假设我们尝试使用下面的语句：

![](../Images/image10406.gif)

用等于10.9567的amount来测试我们的代码会产生下面的输出：

![](../Images/image10407.gif)

看起来还不错。（顺便说一句，简单的初始化amount的赋值语句提供了一种快速测试初始代码的途径。）但是，当我们用更多的示例来测试时，就会碰到一个问题。例如，如果amount是7.05，那么我们就会得到：

![](../Images/image10408.gif)

而不是

![](../Images/image10409.gif)

这项快速测试使我们意识到当分的数额小于10时，需要在其前面添加一个0。下面的语句修正了这个问题：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10410.jpeg)

程序清单6.12展示了我们的类。既然我们有了该类的完整定义，那么就是时候执行严格的测试了。程序清单6.13展示了测试write方法的程序。这种类型的程序通常称为驱动程序，或者简称为驱动，因为它们除了操练对应的方法，或者“驱动”对应的方法之外，并没有做其他任何事情。任何方法都可以在类似这样的程序中进行测试。

程序清单6.12　DollarFormatFirstTry类

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10411.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10412.jpeg)

直到我们用负数来测试之前，测试都运行得很好。毕竟，负数金额也是可行的，我们称其为债务。但是金额-1.20产生的输出是$-1.0-20，我们处理负数金额的方式存在错误。

检查amount为负值时的计算，就会发现，dollars和cents都包含负数。dollars中的负值是正确的，在测试用例中显示了$-1。但是，对于分，我们需要显示20，而不是-20。有许多方法可以修复这个错误，但是在这里使用了一种简洁的方法。因为我们的代码对非负数都可以正确地运行，所以我们会将所有负数转换为正数，然后显示一个减号，后面跟着转换后的正数。

程序清单6.13　测试DollarFormatFirstTry的驱动类

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10413.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10414.jpeg)

程序清单6.14展示了类的修正版本。注意，新方法writePositive几乎与原来的方法write完全相同，唯一的差异是writePositive没有显示美元符号，而write方法的新版本显示了美元符号。

程序清单6.14　修正后的DollarFormat类

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10415.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10416.jpeg)

在测试DollarFormat类时，使用的程序类似于用来测试DollarFormatFirstTry的程序，这种做法很成功。这个驱动程序在DollarFormatDriver.java文件中，该文件包含在本书配套的可以在网上下载的源代码中。

编程窍门：再测试

每次修改类或方法的定义时，都应该对其进行测试。

[^1]:  除了printf方法，Java还有一些其他的类，允许我们按照我们希望的任意格式来输出数字。但是，使用这些类可能会变得非常复杂。如果你想要了解这些格式化类的更多内容，可以查看附录D，其中有一段对DecimalFormat类的简短讨论。