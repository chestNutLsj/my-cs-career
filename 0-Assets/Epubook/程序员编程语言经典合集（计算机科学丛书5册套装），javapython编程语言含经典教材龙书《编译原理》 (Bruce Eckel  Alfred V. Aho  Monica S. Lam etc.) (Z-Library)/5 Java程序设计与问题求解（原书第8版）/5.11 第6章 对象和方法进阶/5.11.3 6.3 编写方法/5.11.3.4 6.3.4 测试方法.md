   

### 6.3.4　测试方法

当测试方法时，可以使用像程序清单6.13中的驱动程序。这些驱动程序就是为了让你使用的，所以它们非常简单。它们无须任何奇思妙想的输出，或者其他任何精心设计的东西。它们所做的就是向方法提供引元，然后调用该方法。

为类编写的每个方法都应该经过测试。而且，在测试它时，程序中仅有该方法是尚未经过完全测试的方法。在这种方式中，如果发现了问题，那么你就可以知道哪个方法包含错误。如果测试同一个程序中的多个方法，那么你就很可能会掉进陷阱，以为错误位于某个方法中，而实际上该错误位于另一个方法中。

编程窍门：单独测试各个方法

在测试每个方法时，都应该在这样的程序中测试：该方法是程序中唯一未测试过的方法。

有一种单独测试每个方法的方式称为自底向上测试。如果方法A调用了方法B，那么自底向上测试就会要求在测试方法A之前，先要测试方法B。自底向上测试是一种良好且安全的技术，但是它可能会变得相当冗长乏味。有些测试方式可以更快且更省力地找到缺陷，并且，有时我们希望可以在完成某个方法用到的所有其他方法的测试之前，就先测试这个方法。例如，你可能希望在编写所有方法之前，就先测试你设计的对问题的泛化解决方法。但是，你在测试每个方法时，仍旧应该在该方法是仅有的尚未测试的方法的程序中进行测试。这会产生一个问题。如果方法A调用了方法B，方法B尚未被测试，那么我们如何在方法A是仅有的尚未测试过的方法的程序中对其进行测试呢？答案就是使用方法B的桩。

桩（stub）是方法的简化版本，对于最终的类定义来说，它还不够完善，但是却足以应付测试，并且足够简单，使你能够确保或者尽可能地确保它是正确的。例如，假设我们在测试程序清单6.14中的DollarFormat类，并且希望在测试write方法之前先测试writeln方法。我们可以针对wrtie方法使用桩，就像下面这样：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10424.jpeg)

这肯定不是write方法的正确定义，因为无论它的引元是什么，都会显示$99.12。但是，它足以用来测试writeln方法。如果使用write方法的这个桩来测试writeln方法，而writeln会以正确的方式来显示$99.12，那么writeln几乎就可以肯定是正确的。注意，通过使用write方法的这个桩，在完整地测试write或writePositive方法之前，就可以测试writeln方法。

自测问题

27.给定程序清单6.14中的DollarFormat类，调用DollarFormat.writeln（7.0）会显示什么？

28.考虑程序清单6.14中的writePositive方法中的allCents变量。对于金额$12.95，int变量allCents将会被设置为1295。使用int变量有些局限性，因为int类型的最大值是2 147 483 647，这意味着该方法能够处理的最大金额为$21，474，836.47，也就是2100多万美元。这确实是一个很大的金额，但是我们经常需要考虑更大的金额，例如国家预算或者大公司的CEO的年薪。如何很方便地修改DollarFormat类中的方法定义，使得它们能够处理更大的金额？

29.以下面代码开头的程序存在什么问题？（Species类是在第5章的程序清单5.19中定义的。）

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10425.jpeg)

30.设计一个类，用来显示double类型的值，这些值表示的未必是钱的金额。给这个类起名为OutputFormat。它应该有两个静态方法：write和writeln，每个都会接受2个引元。第一个引元给出了要输出到屏幕上的double值，而第二个引元是表示显示小数点后多少位数字的int值。这两个方法应该将多余的位数都四舍五入掉。这些方法类似于DollarFormat类中的write和writeln。尽管你可以使用DollarFormat作为模型，但是这两个类中的方法有些区别。正如你所期望的，任何在write执行后产生的输出都将出现在同一行中，而在writeln执行后产生的输出将出现在下一行中，除此之外，write和writeln执行相同的的操作。

例如，下面的语句：

![](../Images/image10426.gif)

应该产生下面的输入：

![](../Images/image10427.gif)

不要忘记用小数点后面有0的数字（例如1.023和1.0023）来测试你的方法。（提示：你会发现静态方法Math.pow（见表6.1）用于移动小数点的表达式中时会显得很有用。）这是个相当有难度的练习，因此给自己多些时间来完成它。如果你无法完成这个类的编写，那么要确保你至少能够理解在本章最后给出的答案。这是一个很有用的类。

31.在你给出的上一个自测问题的OutputFormat类的定义中，如果使用名字print和println而不是write和writeln，是否合法？是否会和System.out.println产生名字冲突？