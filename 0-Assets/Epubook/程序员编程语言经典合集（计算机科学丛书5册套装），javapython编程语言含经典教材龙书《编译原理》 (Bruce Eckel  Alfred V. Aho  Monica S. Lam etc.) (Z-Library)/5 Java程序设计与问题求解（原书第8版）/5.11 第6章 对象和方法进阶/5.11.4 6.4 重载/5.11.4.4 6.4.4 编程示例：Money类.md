   

### 6.4.4　编程示例：Money类

程序清单6.16包含了一个名为Money的类，它的对象表示美元金额，例如$9.99、$500.00、$0.50等。你可能倾向于将钱的金额看作double类型的值，但是对于使用Money类的程序员，或者对于使用Money的任何软件产品的任何最终用户而言，这些数据值不能看作是double或int类型，也不能看作是任何Java的预定义类型[^1]，它们的类型为Money。对于“路人”来说，$9.99并不是一个double类型的值，对你来说也应该如此。有时，用double类型的值来表示金额可能可以钻空子，但是这么做会有潜在的问题。实际上，double类型的值是近似值，特别是对于财务程序而言，近似值通常不够好。如果银行的账户余额少了几块钱，甚至少了几分钱，顾客都会相当不满，并且很可能会实施法律行动。

当然，为了实现Money类，我们必须选择某种数据表示形式。我们希望能够表示金额的确切数量，因此我们将使用整数类型。但是，int类型不能表示很大的数字，所以我们将使用long类型。像$3500.36这样的金额可以表示成两个整数，在本例中，可以表示成3500和36，然后将它们存储在long类型的实例变量中。负的金额肯定是有意义的，最终专业的Money类可以表示负的金额，但是因为我们只需要一个针对学习目的的非常简单的示例，所以将程序限制为只表示非负金额。

程序清单6.16　Money类

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10446.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10447.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10448.jpeg)

注意名为set的重载方法。这四个名为set的方法使得程序员可以按照任何便捷的方式来设置金额。程序员可以使用单个整数来表示没有分的金额，用单个double类型的值来表示金额，用另一个Money类型的对象来表示金额，或者用像“$9.98”或“9.98”这样的字符串来表示金额。程序员无须也不应该关心Money类内部用到了哪些实例变量，程序员应该只考虑金额。

让我们来看一看这些set方法定义中的一些细节。具有一个long类型参数的set方法很直观，它可以设置没有分的整数金额。具有一个double类型参数的set方法的工作方式是首先将该double值转换为以分为单位表示的金额值，它是通过下面的语句来实现的：

![](../Images/image10449.gif)

Math.round方法会消除分以下的所有小数部分，该方法会在其引元为double类型时，返回一个long类型的值，就像其在这里所做的。然后，使用整数除法操作符/和%将分转换为元和分。

参数类型为Money的set方法也很直观，但是需要注意其中的一个要点。moneyObject参数的实例变量在Money类的定义内部可以通过名字访问。在本例中，它们是moneyObject.dollars和moneyObject.cents。在任何类的定义中，都可以直接访问该类的任何对象的实例变量。

参数类型为String的set方法会将像“$12.75”或“12.75”这样的字符串转换为两个整数，例如12和75。首先，它会像下面这样检查字符串中的第一个字符是否是美元符号：

![](../Images/image10450.gif)

字符串amountString中的第一个字符是由对String的charAt方法的调用返回的。如果该字符是美元符号，那么该字符串（原本具有的索引位置从0到最后一个索引）就会被索引从1到该字符串末尾的子字符串所替换，String的substring方法会替我们实现此目的。你可以复习一下第2章表2.3中给出的有关substring方法的描述。

在$符号和金额之间可能存在一个或多个空格，这些空格可以通过调用String的trim方法来裁减掉，就像下面这样：

![](../Images/image10451.gif)

然后，通过定位小数点并在小数点处断开，将该字符串分解为两个子字符串，一个表示元，一个表示分。小数点的位置可以像下面这样存储在变量pointLocation中：

![](../Images/image10452.gif)

表示元和分的子字符串将按照下面的方式获得：

![](../Images/image10453.gif)

最后，表示元和分的子字符串通过调用本章之前介绍过的包装器类Long中的静态方法parseLong而转换成了long类型的值：

![](../Images/image10454.gif)

用times方法来将金额乘以一个整数，而用add方法来将两个Money加起来。例如，如果m1和m2都是表示金额为$2.00的Money类型的对象，那么m1.times（3）会返回一个表示$6.00的Money类的对象，而m1.add（m2）将返回一个表示$4.00的Money类的对象。

为了理解times和add方法的定义，记住，1美元等于100美分。因此，如果product.

cents的值大于100，那么下面的语句将会把变量carryDollars设置为等于这么多美分中整元的数量：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10455.jpeg)

移除整元之后剩下的美分的数量可以由下面的计算得到：

![](../Images/image10456.gif)

在程序清单6.17中给出了Money类的演示程序。

程序清单6.17　使用Money类

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10457.jpeg)

自测问题

38.重新编写程序清单6.16中的add方法，在这次实现中不要使用this参数。

39.在程序清单6.16中，有一个String参数的set方法不允许在该字符串中存在额外的前导和后缀空格。重新编写它，让它忽略前导和后缀空白字符。例如，它应该允许使用“$5.43”这样的引元。

[^1]:  在程序清单6.14中，我们定义了名为DollarFormat的类，它关心的是如何显示以double类型的值给出的金额。在这个编程示例中，我们不会使用double值来表示钱的金额，因此我们不会使用DollarFormat类。