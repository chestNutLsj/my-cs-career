   

### 6.1.1　定义构造器

构造器是一种特殊的方法，会在使用new操作符创建新对象时调用。直到现在，都是Java在为我们提供构造器。例如，对于上一章程序清单5.19给出的Species类，我们可以通过编写下面的语句来创建一个新的Species对象：

![](../Images/image10323.gif)

这条语句的第一部分［Species earthSpecies］声明变量earthSpecies是一个Species类的对象的名字。第二部分［new Species（）］，创建并初始化了一个新对象，然后，将它的地址赋值给了earthSpecies。这里的Species（）就是对Java为该类提供的构造器的调用。圆括号为空是因为这个特定的构造器不接受任何引元。

对于到目前为止你所看到过的类，构造器都是在创建对象，并将它们的实例变量的值赋为缺省值。但是，这些值可能并非是你想要的。你可能希望将某些或者全部实例变量在创建对象时都初始化为你指定的值。通过编写自己的构造器就可以实现此目的。

构造器可以执行在其定义中编写的所有动作，但是构造器的作用应该是执行初始化动作，例如初始化实例变量。构造器本质上与设置方法的目的相同。但是与设置方法不同的是，构造器在创建对象的同时对其初始化。与设置方法相同的是，构造器可以有参数。

让我们来考虑一个简单的表示宠物的类。假设我们用名字、年龄和体重来描述宠物。我们赋予宠物对象的基本行为就是对这三个属性的设置和获取。现在，想象一下，我们绘制了一张如图6.1所示的名为Pet的类的类图。注意，图中有四个用来设置不同的实例变量的方法，其中一个将设置所有三个实例变量name、age和weight，另外三个方法都分别只设置一个实例变量。这张类图如典型情况一样，并没有包含构造器。

构造器有一个属性初看起来可能有些奇怪，那就是每个构造器的名字都和它所属的类相同。因此，如果类的名字是Species，那么它的构造器的名字也是Species。如果类的名字是Pet，那么构造器的名字也就是Pet。

构造器经常具有多个定义。每个都具有不同数量或类型的参数，它们有时与类的设置方法类似。例如，程序清单6.1中包含了Pet类的定义，其中包含若干个构造器。注意，这些构造器的头没有关键词void。当定义构造器时，无须指定任何返回类型，甚至不用指定void。这些构造器看起来与设置方法非常像，但是设置方法都是void方法。实际上，针对这个例子，我们将每个构造器都与和它相像的设置方法凑在了一起。但是，与有些设置方法不同，构造器会对所有的实例变量赋值，尽管它们可能并没有与每个实例变量都对应的参数。如果你不想初始化某个特定的实例变量，Java就会通过对其赋以缺省值来实现此目的。但是，正常的编程实践应该是在定义构造器时显式地给所有实例变量赋值。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10324.jpeg)

图6.1　Pet类的类图

程序清单6.1　Pet类：构造器和设置方法的示例

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10325.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10326.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10327.jpeg)

牢记：构造器和设置方法的用法有关联但是不同

只有在创建对象时才会调用构造器。要修改已有对象的状态，需要调用一个或多个设置方法。

程序清单6.1中包含一个名为Pet的构造器，它没有任何参数。这种构造器称为缺省构造器。典型情况下，无论何时，只要你至少定义了一个构造器，就应该再包含一个没有任何参数的构造器。如果查看上一章中的Species类的定义，你就会发现根本没有任何构造器的定义。无论何时，只要类定义中没有构造器定义，Java就会自动地定义一个缺省构造器，即没有任何参数的构造器。这种自动定义的构造器会创建该类的对象，并将实例变量都初始化为缺省值。但是，如果在类中至少定义了一个构造器，那么就不会有任何自动创建的构造器了。因此，对于程序清单6.1中的Pet类，因为定义了构造器，所以我们很仔细地添加了一个没有任何参数的构造器，即缺省构造器。

当使用new操作符创建新对象时，必须总是包含对某个构造器的调用。与其他任何方法调用一样，我们要在构造器名字后面的圆括号中列出所有的引元，记住，构造器名与类名相同。例如，假设你想要使用new创建一个Pet类的新对象，那么就可以像下面这样实现此目的：

![](../Images/image10328.gif)

Pet（“Wanda”，2，0.25）这部分是对Pet中的构造器的调用，该构造器接受三个引元：一个String类型、一个int类型以及一个double类型。这条语句创建了一个新对象，表示一只名字为Wanda、年龄为2岁、体重0.5磅[^1]的宠物。

你可以认为构造器调用返回的是对Pet类的某个对象的引用，即该对象的内存地址。前面的例子将这个引用赋值给了变量fish。图6.2展示了其工作原理。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10329.jpeg)

图6.2　返回引用的构造器

让我们再来看另一个例子。下面的语句：

![](../Images/image10330.gif)

会通过调用缺省构造器（也就是不带任何参数的构造器）来创建一个Pet类的新对象。如果查看程序清单6.1中的Pet类的定义，就会发现缺省构造器赋予这个对象的名字为No name yet，并将实例变量age和weight设置为0。（新生的宠物体重当然不为0，0这个值只是个在实际体重尚未确定时的占位符。）

你不能用已有对象来调用构造器，因此，下面这个在Pet类的myPet对象上的调用是非法的：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10331.jpeg)

一旦对象被创建，你就需要某种其他的方式来修改其实例变量的值。这种方式需要调用一个或多个设置方法。因此，给定程序清单6.1中定义的类，与之前非法的对构造器Pet的调用不同，我们将像下面这样调用setPet：

![](../Images/image10332.gif)

程序清单6.2给出了演示构造器和若干个设置方法的用法的样例程序。

编程窍门：群组构造器的定义

在程序清单6.1中，我们在每个构造器定义的后面都编写了一个类似的set方法。这么做是为了强调这两种方法之间的相似性和差异。但是，程序员通常会将构造器的定义群组在一起，并且经常会将它们放置在类中所有其他方法之前。

程序清单6.2　使用构造器和设置方法

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10333.jpeg)

回顾：构造器

构造器是一种通过使用new操作符创建类的对象时调用的方法。构造器为新创建的对象提供了实例变量的初始值。

构造器必须与它们所属的类具有相同的名字。构造器的定义与其他方法一样，只是它们的方法头中没有返回类型，甚至没有void。

示例

查看程序清单6.1中的构造器定义的例子。下面是调用这些构造器的示例：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10334.jpeg)

回顾：缺省构造器

没有任何参数的构造器称为缺省构造器。你定义的大多数类都应该包含一个缺省构造器。

牢记：Java可以为你定义一个构造器

如果你没有为一个类定义任何构造器，那么Java就会为你定义一个。这个自动提供的构造器将会是一个缺省构造器，即，它没有任何参数，并且会对实例变量赋予缺省值。但是，一旦你为一个类定义了构造器，那么Java就不会再为你定义任何构造器了。在这种情况下，如果你没有显式地定义缺省构造器，你的类就不会再有缺省构造器了。

疑难杂症：省略缺省构造器

假设我们在程序清单6.1的Pet类中省略了缺省构造器的定义，那么下面的语句：

![](../Images/image10335.gif)

将是非法的，并且会产生一条错误消息。因为如果没有定义任何缺省的构造器，Java会自动提供一个缺省构造器，所以你可能会认为这条语句应该是合法的。但是因为这个类定义包含了至少一个构造器定义，所以Java不会再提供任何构造器。

类经常会被复用，迟早你会希望使用无任何引元的构造器来创建新对象。你应该仔细考虑是否要从你编写的类中省略掉缺省构造器的定义。

常见问题：我应该在类图中画出构造器吗？

类图不必包含类中所有的方法。因为类图是一种设计工具，它只需要能够满足手头的设计任务即可。正常情况下，构造器不会在类图中列出，因为它们总是需要的，并且总是服务于相同的基础目的。

[^1]:  1磅≈0.4545千克。——编辑注