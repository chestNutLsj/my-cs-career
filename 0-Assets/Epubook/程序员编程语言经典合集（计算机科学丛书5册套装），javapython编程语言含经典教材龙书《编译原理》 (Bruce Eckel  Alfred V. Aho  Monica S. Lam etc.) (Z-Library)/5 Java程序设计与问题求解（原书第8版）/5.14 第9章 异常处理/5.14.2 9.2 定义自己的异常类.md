   

## 9.2　定义自己的异常类

这次我破次例。

——我的母亲

我们可以定义自己的异常类，但是它们必须是已经定义好的某个异常类的派生类。异常类可以是任何预定义异常类或我们已经成功定义过的任何异常类的派生类。我们举的例子就是Exception类的派生类。

在定义异常类时，与其他从基类继承而来的方法相比，构造器是最重要的方法，并且经常是仅有的方法。例如，程序清单9.5包含一个名为DivideByZeroException的类，其仅有的方法就是缺省构造器和具有一个String参数的构造器。对于我们的目的而言，这就是所有我们需要定义的。但是，这个类会继承其基类Exception的所有方法。特别是DivideByZeroException继承了getMessage方法，它会返回一条字符串消息。在缺省构造器的定义中，这条字符串消息是通过下面的语句设置的：

![](../Images/image10972.gif)

这条语句会调用基类Exception的构造器。正如我们已经注意到的，当我们将一个字符串传递给Exception类的构造器时，就会设置一个String实例变量的值，我们随后可以通过调用getMessage方法来找回这个值，这个方法是Exception类的一个普通的访问器方法，被DivideByZeroException所继承。例如，程序清单9.6展示了一个使用这个异常类的样例程序，其中的异常是通过缺省构造器创建的，然后被抛出，如下所示：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10973.jpeg)

程序清单9.5　程序员定义的异常类

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10974.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10975.jpeg)

程序清单9.6　使用程序员定义的异常类

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10976.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10977.jpeg)

这个异常会被catch块捕获，其中包含下面的语句：

![](../Images/image10978.gif)

这条语句会在屏幕上显示下面的输出，就像程序清单9.6的样例屏幕输出所示：

![](../Images/image10979.gif)

程序清单9.5中的DivideByZeroException类还定义了第二个构造器。这个构造器具有一个String类型的参数，使得我们在抛出异常时可以选择任何我们想要的消息。如果将程序清单9.6中的throw语句替换为下面的语句：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10980.jpeg)

下面的语句：

![](../Images/image10981.gif)

将会在屏幕上产生下面的输出：

![](../Images/image10982.gif)

注意，程序清单9.6中的try块包含程序的正常部分。如果诸事顺利，那么它就是唯一得以执行的代码，输出将会如样例屏幕输出1所示。在异常情况下，当用户输入0作为分母时，就会抛出异常，然后被catch块捕获。catch块会显示异常消息，然后调用give-SecondChance方法。giveSecondChance方法给了用户第二次机会去输入正确的值，然后执行计算。如果用户进行了第二次尝试，仍旧是除以0，那么该方法就会在不抛出任何异常的情况下终止。giveSecondChance方法的存在只是为了处理异常情况。因此，我们将处理除以0这种异常情况的代码分离出来写成一个单独的方法，这样它就不会和正常情况的代码混在一起了。

编程窍门：在自己的异常类中保留getMessage

对于所有已定义的异常类，getMessage方法将返回作为引元传递给构造器的字符串。（如果没有传递给构造器任何引元，即，如果调用的是缺省构造器，那么getMessage会返回一个缺省字符串。）例如，如果异常是以下面的方式抛出的：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10983.jpeg)

那么，该异常的String实例变量的值就会被设置为"This is a big exception！"。如果该异常对象名为e，那么方法调用e.getMessage（）会返回"This is a big exception！"。

我们应该在任何自己定义的异常类中保留getMessage方法的这种行为。例如，假设我们定义了一个名为MySpecialException的异常类，并像下面这样抛出异常：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10984.jpeg)

如果e是被抛出的异常的名字，那么e.getMessage（）应该返回"Wow，what an exception！"。为了确保我们定义的异常类的行为符合这种形式，我们需要确保在该异常类中包含一个具有一个字符串参数的构造器，并且其定义将以对super的调用开头，如下面的构造器所示：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10985.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10986.jpeg)

对super的调用就是对基类构造器的调用。如果基类构造器可以正确地处理这条消息，那么按照这种方式定义的异常类也可以正确地处理。

还应该在每个异常类中都包含一个缺省构造器，该缺省构造器应该对getMessage获取的缺省值进行设置。该构造器的定义应该以对super的调用开头，如下面的构造器所示：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10987.jpeg)

如果getMessage在基类中的工作方式如我们所叙述的那样，那么这个缺省构造器也可以在当前正在定义的新异常类中正确地工作。

牢记：异常对象的特性

有关异常对象的两件最重要的事情是：

·对象的类型，即异常类的名字。接下来的小节马上就要解释这点为什么很重要。

·对象在String类型实例变量中携带的消息。这个字符串可以通过调用访问器方法getMessage来找回。该字符串允许我们的代码将一条消息随异常对象一起发送，使得catch块可以找回该消息。

编程窍门：何时定义异常类

有这么一条通用规则，如果我们要在代码中插入一条throw语句，那么可能最佳的方式是定义自己的异常类。在这种方式中，当代码捕获异常时，catch块可以告知我们的异常与预定义类抛出的异常之间的差异。例如，在程序清单9.6中就用到了在程序清单9.5中定义的异常类DivideByZeroException。

尽管并非是个好主意，但是你仍旧可能会产生像下面这样在程序清单9.6中用预定义类Exception来抛出异常的想法：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10988.jpeg)

然后你想在catch块中捕获该异常：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10989.jpeg)

尽管这种方式在程序清单9.6的程序中可以工作，但是它并非最佳方式，因为上面这个catch块会捕获所有异常，例如IOException对象。但是，IOException对象也许需要执行的动作与调用giveSecondChance执行的动作不同。因此，与使用Exception类来处理除以0的情况不同，更好的方式是使用更加专业的程序员定义的DivideByZero-Exception类，就像我们在程序清单9.6中所做的。

回顾：程序员定义的异常类

我们可以定义自己的异常类，但是每个这样的类都必须从现有的异常类中派生，要么是预定义类，要么是我们自己定义的某个类。

准则

·如果我们没有正当的理由使用其他类作为基类，那么使用Exception作为基类。

·我们应该至少定义两个构造器，包括缺省构造器和有单个String参数的构造器。

·在每个构造器定义中，我们应该以使用super对基类构造器的调用开头。例如，对super的调用应该有一个字符串引元，表示这是什么种类的异常。例如，

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10990.jpeg)

如果构造器有一个String参数，那么该参数应该是对super调用中的引元。例如，

![](../Images/image10991.gif)

在这种方式中，该字符串可以在随后通过使用getMessage方法找回。

·我们的异常类继承了getMessage方法，我们不应该去覆盖它。

·正常情况下，我们无须定义任何其他的方法，但是定义其他方法也是合法的。

示例

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10992.jpeg)

super是对基类Exception的构造器的调用。

自测问题

15.定义名为CoreBreachException的异常类。这个类应该有一个缺省构造器。如果使用这个无引元的构造器抛出异常，那么getMessage就应该返回"Core Breach！Evacuate Ship！"。该类还应该定义一个具有单个String类型参数的构造器。如果使用这个构造器抛出异常，那么getMessage就应该返回用作引元传递给构造器的值。

16.重复上一个自测问题，但是将类命名为MessageTooLongException。如果使用缺省构造器抛出异常，getMessage应该返回"Message Too Long！"。

17.假设异常类ExerciseException的定义如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10993.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10994.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10994.jpeg)

下面这段不太可能在现实中出现的代码会产生什么样的输出？

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10995.jpeg)

18.假设异常类CrazyException的定义如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10996.jpeg)

下面这段不太可能在现实中出现的代码会产生什么样的输出？

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10997.jpeg)

19.假设异常类DoubleException的定义如下：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10998.jpeg)

下面这段不太可能在现实中出现的代码会产生什么样的输出？

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10999.jpeg)

20.假设在上一个自测问题的catch块中，我们将DoubleException修改为Exception，

这种修改对输出会产生怎样的影响？

21.假设在自测问题19中，我们将number的值从42修改为-99，这种修改对输出会产生怎样的影响？

22.尽管异常类在正常情况下只会携带一条字符串消息，但是我们可以定义携带任何类型消息的异常类。我们可以在异常类中添加实例变量和方法。例如，下面类型的对象除了携带一条字符串消息外，还可以携带一条int“消息”：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11000.jpeg)

下面这段不太可能在现实中出现的代码会产生什么样的输出？

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image11001.jpeg)

23.你是否可以从预定义的IOException类中派生异常类？或者是否必须从Exception类中派生异常类？