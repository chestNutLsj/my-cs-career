   

### 7.1.4　进一步了解数组索引

如你所知，任何Java数组的第一个元素的索引都是0，而长度为n的数组的最后一个有效索引是n-1。特别地，数组temperature的最后一个有效索引是temperature.length–1。

在用数字编程时，一种容易犯的错误是使用索引表达式计算出来的值是无效的数组索引。例如，考虑下面的数组声明：

![](../Images/image10553.gif)

数组entry的每个索引值必须是5个整数0、1、2、3、4中的某一个。例如，如果程序中包含索引变量entry[n+2]，那么索引n+2的值必须是这5个整数之一。如果索引表达式计算出来的整数值是在0到数组长度减1范围之外，那么就称该索引越界或者无效。如果代码中使用了越界的索引表达式，代码本身会在不产生任何错误消息的情况下通过编译，但是在运行程序时会得到一条错误消息。

牢记：数组索引必须在有效的边界范围内

Java数组中第一个元素的索引总是0，最后一个索引值并不是数组的长度，而是数组长度减1。要确保你使用的索引都在这个范围内。

数组索引越界的一种常见情况是处理数组的循环多迭代了一次。例如，我们考虑填充数组的循环。假设我们想要从键盘读入一个非负数序列，并且用负数作为表示数据输入结束的哨兵值。我们可能会使用下面的代码：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10554.jpeg)

如果用户输入的数字多于数组的容量，那么这段代码就会产生越界的数组索引。

下面是之前的while循环的一个更好版本：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10555.jpeg)

这个while循环会在数组填充满之后终止，因为我们确保了索引i小于list.length。

疑难杂症：安全的程序设计——数组索引越界

数组索引小于0或者大于等于数组的尺寸都会在程序执行期间导致产生错误消息。这种类型的错误通常可以通过仔细检查以确保数组索引在有效范围内而得以避免。通常，用户输入会起到重要作用。考虑下面的代码，它会计算用户输入了多少个0、1、2和3。数组索引对应着用户输入的数字。数组的内容包含了这些数字输入的次数。例如，count[0]包含输入0的次数，count[1]包含输入1的次数，以此类推。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10556.jpeg)

用户输入的数字在0到3之间时，这个程序运行得很好。但是，如果用户输入的是像4这样的数字，那么在试图访问count[4]时，这个程序就会崩溃，因为它超出了数组的尺寸。输入校验可以通过确保只能输入0到3之间的数字来解决这个问题。

假设我们想要对存储在数组中的数据从1开始编号，例如，公司中的员工就是从1开始编号的。但是Java数组的索引总是从0开始。有一种处理这种情况的方式是让代码去协调数组索引和现有的编号模式。例如，可以在工资计算程序中使用下面这样的代码：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10557.jpeg)

有了这段代码，雇员的编码就是从1到100，但是他们的工时数存储在元素hours[0]到hours[99]中。

但是，像这样的情况可能会使你感到困惑，容易在程序中导致错误。总的来说，这段代码在两种编号模式匹配的情况下会显得更易于理解。通过重新编写前面的代码，将数组的尺寸增加1，并忽略索引0处的元素，就可以实现此目的，就像下面这样：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10558.jpeg)

有了这段修改后的代码，雇员的编码仍旧是从1到100，但是他们的工时数存储在从hours[1]到hours[100]的元素中。我们没有使用hours[0]，所以该数组的尺寸是101而不是100，hours[100]是有效的。

注意，index的最后一个有效的值是hours.length–1，就像在这段代码的第一个版本中所看到的。但是，这里的hours.length比之前的值大1。将for循环中下面的语句

![](../Images/image10559.gif)

替换为

![](../Images/image10560.gif)

对大多数人来说，会显得更清楚。但是，如果其他程序员阅读你的代码，他们可能会希望在索引0处存储着值。所以，底线在于所有在同一个项目中协作的程序员应该使用相同的编程实践，否则就会产生困惑或错误。

编程窍门：不要担心浪费数组中的元素

在之前的示例中，我们将不使用hours[0]。是的，我们“浪费”了一个数组元素，但是也使得代码更易于编写和理解了。因此，我们犯的错误会更少。但是，其他和你一起工作的程序员应该了解你的编程实践。在Java中，我们浪费的内存量算不了什么。尽管我们创建了一个大对象数组，但是Java在数组中存储的只是对象的地址。在其他编程语言中，可能使用的是不同的方式。例如，C++在数组中存储的是对象本身，而不是其地址。浪费C++数组中的位置可能会比在Java程序中浪费位置更重要。

编程窍门：要习惯索引值为0

数组中第一个元素的索引为0，Java程序员了解这一点。除非出于应用程序的需求使得你有很好的理由忽略这个索引，否则就不要忽略它。前面的示例展示了一种对齐两种编号系统的调整方式，它可以减少混淆，降低出错的可能。但是，将代码调整为避免使用0索引不应该是一种常规性的做法。