   

### 7.2.1　案例研究：销售报表

在这个案例研究中，我们将编写一个程序来生成公司中某个销售团队的销售报表。这家公司希望能够很容易地就看出哪个销售员或者哪几个销售员的销售额最高，以及每位销售员与平均销售额的比较结果。

因为需要记录每位销售员的名字和销售数据，所以可以设计一个类来表示单个销售员，其中存储这两项数据。类可以执行输入和输出，并且还具有合理的访问器和修改器方法。这个类的定义很常规，展示在程序清单7.3中。

程序清单7.3　销售员类

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10569.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10570.jpeg)

程序需要用数组来跟踪所有销售员的数据，还需要记录最高的销售额和平均销售额。因此，我们需要设计另一个类。我们可以在这个新的类中添加下面的实例变量，用来记录想要的数据：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10571.jpeg)

我们需要知道销售员的数量，这个数量等于team.length，但是用专门命名的单独变量来表示销售员的数量是一个不错的主意。因此，我们让这个类中包含下面的实例变量：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10572.jpeg)

程序要完成的工作可以分解为下列主要的子任务：

1）准备好。

2）获取数据。

3）计算某些统计数据（更新实例变量）。

4）显示结果。

我们应该对这个新类及其方法命名。为了组织思路，我们可以绘制图7.3所示的类图。这样，我们就知道这个类应该看起来像下面这样：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10573.jpeg)

剩下的就是要编写三个方法getData、computeStats和displayResults，然后测试和调试程序。我们将按顺序来处理这三个方法。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10574.jpeg)

图7.3　SalesReporter类的类图

输入方法getData相对直观，尤其是我们有一个输入方法，专门用来输入Sales-Associate类的对象。在读入销售员的数量后，可以编写如下的基本输入循环：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10575.jpeg)

尽管数组索引始于0，而销售员的编号始于1，但我们还是用team[i]来表示销售员i。也就是说，我们决定忽略team[0]。因此，我们需要在数组中额外分配一个位置，就像下面这样：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10576.jpeg)

因为在getData中读入了numberOfAssociates，所以我们将这条语句也置于该方法中。

但是仍旧存在一个问题。当我们测试前面的循环时，会得到一条错误消息，描述了一些有关“空指针”的信息。这个问题是因为数组team的基类型是类类型而导致的。要想发现这个问题，请考虑另一种情况。假设我们有下面的代码：

![](../Images/image10577.gif)

这段代码会产生相同的有关“空指针”的错误消息。问题在于变量s只是一个名字，它还未引用任何SalesAssociate的对象。前面这段代码漏掉了常用的new，它应该修改为：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10578.jpeg)

索引变量team[i]也是类类型的变量，因此它也只是一个名字。你需要在执行下面的语句之前先将某个SalesAssociate对象赋值给team[i]：

![](../Images/image10579.gif)

因此，我们需要在循环中插入下面的语句：

![](../Images/image10580.gif)

包含上述插入语句的getData方法的完整定义展示在程序清单7.4中。

程序清单7.4　销售报表程序

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10581.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10582.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10583.jpeg)

接下来，我们将注意力放到computeStats方法上，得到下面的代码：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10584.jpeg)

这个循环基本上没问题，但是变量sum和highest必须在循环开始之前初始化。我们可以将sum初始化为0，但是用什么值来初始化highest呢？可能是一个负数，因为销售总额不可能是负数。销售总额有可能是负数吗？如果将顾客退货当作负销售额，那么销售总额就确实可能会是负数。但是，我们知道公司至少会有一位销售员，因此可以将sum和highest都初始化为第一位销售员的数据。这就需要将第一位销售员的情况拿到循环外面，并放到循环之前处理，就像下面这样：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10585.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10586.jpeg)

上面的循环可以工作，但是要注意重复的计算。有三个完全相同的对team[1].getSales（）的方法调用。为了避免这种重复，我们可以将调用的结果存储在某个变量中，就像下面这样：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10587.jpeg)

computeStats方法的完整定义在程序清单7.4中。

最后一个方法displayResults的设计只用到了你刚刚看到的技术，因此我们就不再详细讨论其细节了。它的定义也展示在程序清单7.4中。

疑难杂症：创建对象数组并不会创建对象的实例

当我们创建对象数组时，Java并不会创建任何对象实例！例如，考虑下面的代码：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10588.jpeg)

该行代码创建了能够持有10个引用的数组。换句话说，其中包含的是10个可以存储SalesAssociate对象的存储单元的地址。但是，Java只创建了该数组，它没有创建任何SalesAssociate对象。Java使用特殊的值null来标记空引用。在我们试图访问该数组时，必须引用某个对象。下面的代码就将索引0和1处的数组项设置成了对新对象的引用，但是从索引2到9的项仍旧为空：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image10589.jpeg)

我们现在可以访问team[0].getName（）或team[1].getSalary（）了。

自测问题

7.编写一些Java代码，声明一个名为entry的数组，其长度为3，基类型为SalesAsso-ciate（程序清单7.3），并填充三条相同的记录。这些记录使用的名字为“Jane Doe”，销售额为$5000。请使用for循环。

8.重写程序SalesReporter（程序清单7.4）中的displayResults方法，让它使用Dollar-Format类（第6章的程序清单6.14）中的方法以美元和美分的正确格式显示销售额的美元数量。