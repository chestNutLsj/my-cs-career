   

## 3.3　switch语句

跟他商量一个妥当的方策，不要盲冲瞎撞，去试探前途的危险。

——威廉·莎士比亚，《科里奥兰纳斯》（1609）

当多重分支if-else语句有许多种可能的结果时，就会变得难以阅读。如果是基于某个整数或字符表达式的值进行选择，那么switch语句就会使代码更易于阅读。

switch语句以关键词switch开头，后面跟着圆括号括起来的控制表达式：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09882.jpeg)

其语句体总是由一对花括号括起来。程序清单3.5展示了一个switch语句的样例，其控制表达式是变量numberOfBabies。在花括号内部是一个情况列表，每种情况的构成都包括关键词case、后面跟着的被称为情况标号的常量以及冒号和一组语句，这组语句就是相对应的情况下需要执行的动作：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09883.jpeg)

当switch语句执行时，会计算控制表达式的值，即本例中的numberOfBabies的值。然后，搜索待选列表，直至找到与控制表达式的值匹配的情况标号，然后执行该标号所关联的动作。情况标号不能重复，因为这样会产生具有歧义的场景。

注意，程序清单3.5中的每种情况的动作都以一条break语句结束，该语句由关键词break和后面跟着的分号构成。当执行到某条break语句时，switch语句的执行就会结束。如果在针对某种特定情况的语句中没有发现任何break语句，那么程序就会继续执行到下一种情况，直至遇到一条break语句，或者到达该switch语句的末尾。

有时，我们希望某种情况没有break语句。我们无法让一种情况具有多个标号，但是我们可以逐一列出多种情况，使得它们全都产生相同的动作。例如，在程序清单3.5中，情况4和情况5会产生相同的动作，因为情况4没有任何break语句，事实上，情况4根本就没有任何动作语句。

如果没有任何情况匹配控制表达式的值，就会执行缺省情况，即以关键词default和分号构成的情况。但是，缺省情况是可选的。如果删除缺省情况，并且没有找到任何匹配的情况，那么就不会发生任何动作。如果你认为你设计的各种情况覆盖了不包括缺省情况在内的所有可能性，那么你可以插入一条错误消息作为缺省情况。你永远都不会知道曾几何时你是否漏掉了某种隐藏的情况。

程序清单3.5　一条switch语句

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09884.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09885.jpeg)

下面是另一个switch语句的例子，这个例子用char变量作为控制表达式：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09886.jpeg)

在本例中，A等和C等的鸡蛋可以用大写或小写字母来标识。eggGrade的其他值由缺省情况处理。

注意，情况标号并不需要连续，甚至不需要排序。就像在上面的例子中，有'A'和'C'，但是没有'B'。类似地，在带有整数情况标号的switch语句中，可以有整数1和3，但是没有2。情况标号必须是离散的值，每个标号不能表示取值范围。例如，如果我们希望范围从1到4的取值都执行相同的动作，那么就需要为每个值都编写一个case。对于范围很大的情况，if-else语句会比switch语句更加实用。

switch语句中的控制表达式可以比单个变量更复杂。例如，其中可以包含算术操作符。在Java开发工具包（JDK）7之前的版本中，控制表达式的值必须是一个整数类型的值，例如int类型或char类型。从JDK7开始，允许使用String类型的控制表达式。下面的例子在JDK7或更高版本上都可以运行，但是在更早的版本中会产生编译错误。注意，我们调用了会返回变量answer的小写形式的方法，将其作为了控制表达式。

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09887.jpeg)

回顾：switch语句

语法

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09888.jpeg)

示例

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09889.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09890.jpeg)

疑难杂症：删除break语句

如果你在测试包含switch语句的程序，并且在你期望它只执行一种情况时，却执行了两种情况，那么你可能是忘了在需要包含break语句的地方放置它。

疑难杂症：删除缺省情况

如果switch语句的情况是要对某个变量赋值，那么删除缺省情况可能会导致语法错误。编译器可能会认为在执行该switch语句后，该变量仍旧包含未定义的值。为了避免这种错误，要么提供一个缺省情况，要么在switch语句执行之前对该变量初始化。

自测问题

15.下面的代码会产生什么样的输出？

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09891.jpeg)

16.假设你对上一个自测问题的代码进行了修改，使得第一行如下：

![](../Images/image09892.gif)

那么，这段代码会产生什么样的输出呢？

17.下面的代码会产生什么样的输出？

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09893.jpeg)

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09894.jpeg)

18.下面的代码会产生什么样的输出？

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09895.jpeg)

19.假设你将上一个自测问题的第一行修改成了下面的样子：

![](../Images/image09896.gif)

那么，这段代码会产生什么样的输出呢？

20.假设你将自测问题18的第一行修改成了下面的样子：

![](../Images/image09897.gif)

那么，这段代码会产生什么样的输出呢？

枚举

设想有一位评论家，将电影评为优秀、一般和较差。如果你编写了一个Java程序来组织这些评论，那么你可能会将这些等级表示成3、2、1，或者字符E、A和B。如果你定义了一个变量，其数据类型要么是int，要么是char，用来存储等级，那么最终你可能会得到一个这三种有效等级之外的值。要想将这个变量的内容限定为某些值，那么可以将其声明为枚举数据类型，或称为枚举。枚举列举了一个变量所有可能的取值。

例如，下面的语句将MovieRating定义成了一个枚举：

![](../Images/image09898.gif)

注意，在枚举定义的后面没有跟着任何分号。但是，如果包含分号，也不会导致语法错误，分号会直接被忽略。还要注意，取值E、A和B没有用单引号括起来，因为它们不是char类型的值。

枚举的作用与类类型相同，因此，我们可以用它来像下面这样声明变量rating：

![](../Images/image09899.gif)

在MovieRating的定义中，在花括号中列出的项都是可以赋值给rating的对象。例如，我们可以编写：

![](../Images/image09900.gif)

将A赋值给rating。注意，我们必须在取值A的前面放上枚举名和一个圆点。将E、A和B之外的值赋给rating将会产生语法错误。

一旦我们将一个值赋给了数据类型为枚举的变量，那么就可以在switch语句中使用它来选择具体的动作。例如，下面的语句将基于rating的值显示一条消息：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09901.jpeg)

因为switch语句中的表达式的数据类型是枚举，所以会自动认为情况标号属于该枚举，前面无须再写出枚举名。事实上，如果写成case MovieRating.E反而是一种语法错误。但是，如果需要在除switch语句之外的地方引用一个枚举值，那么就必须在其前面写上枚举名。尽管我们编写了一个缺省情况，但是此处并非必需，因为我们知道rating无法持有枚举之外的值。

枚举值很像具名常量。正因为此，我们使用与命名常量相同的惯例来命名枚举值，即所有字母都大写。这些名字并非只能是单个字母。例如，我们可以将上面的枚举定义为：

![](0-Assets/Epubook/程序员编程语言经典合集（计算机科学丛书5册套装），javapython编程语言含经典教材龙书《编译原理》%20(Bruce%20Eckel%20%20Alfred%20V.%20Aho%20%20Monica%20S.%20Lam%20etc.)%20(Z-Library)/images/image09902.jpeg)

然后像下面这样编写赋值语句：

![](../Images/image09903.gif)

或者编写像下面这样的情况语句：

![](../Images/image09904.gif)

枚举实际上就是类。在典型情况下，你会在另一个类内部但位于所有方法定义之外定义枚举。我们将在第6章更详细地讨论作为类的枚举。