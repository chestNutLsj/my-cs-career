### 13.6.6　替换操作

正则表达式特别便于替换文本，它提供了许多方法：replaceFirst（String replacement）以参数字符串replacement替换掉第一个匹配成功的部分。replaceAll（String replacement）以参数字符串replacement替换所有匹配成功的部分。appendReplacement（StringBuffer sbuf，String replacement）执行渐进式的替换，而不是像replaceFirst()和replaceAll()那样只替换第一个匹配或全部匹配。这是一个非常重要的方法。它允许你调用其他方法来生成或处理replacement（replaceFirst()和replaceAll()则只能使用一个固定的字符串），使你能够以编程的方式将目标分割成组，从而具备更强大的替换功能。appendTail（StringBuffer sbuf），在执行了一次或多次appendReplacement()之后，调用此方法可以将输入字符串余下的部分复制到sbuf中。

下面的程序演示了如何使用这些替换方法。开头部分注释掉的文本，就是正则表达式要处理的输入字符串。

![339-2](../Images/image03105.jpeg)

![340-1](../Images/image03106.jpeg)

此处使用TextFile类打开并读入文件，该类在net.mindview.util工具包中（在第18章中对其代码有详细介绍）。static read()方法读入整个文件，将其内容作为String对象返回。mInput用以匹配在/*！和！*/之间的所有文字（注意分组的括号）。接下来，将存在两个或两个以上空格的地方，缩减为一个空格，并且删除每行开头部分的所有空格（为了使每一行都达到这个效果，而不仅仅只是删除文本开头部分的空格，这里特意打开了多行状态）。这两个替换操作所使用的replaceAll()是String对象自带的方法，在这里，使用此方法更方便。注意，因为这两个替换操作都只使用了一次replaceAll()，所以，与其编译为Pattern，不如直接使用String的replaceAll()方法，而且开销也更小些。

replaceFirst()只对找到的第一个匹配进行替换。此外，replaceFirst()和repalceAll()方法用来替换的只是普通的字符串，所以，如果想对这些替换字符串执行某些特殊处理，这两个方法是无法胜任的。如果你想要那么做，就应该使用appendReplacement()方法。该方法允许你在执行替换的过程中，操作用来替换的字符串。在这个例子中，先构造了sbuf用来保存最终结果，然后用group()选择一个组，并对其进行处理，将正则表达式找到的元音字母转换成大写字母。一般情况下，你应该遍历执行所有的替换操作，然后再调用appendTail()方法，但是，如果你想模拟replaceFirst()（或替换n次）的行为，那就只需执行一次替换，然后调用appendTail()方法，将剩余未处理的部分存入sbuf即可。

同时，appendRepelacement()方法还允许你通过$g直接找到匹配的某个组，这里的g就是组号。然而，它只能应付一些简单的处理，无法实现类似前面这个例子中的功能。