### 22.8.15　绘图

如果使用好的GUI框架，绘图应该非常简单，Swing库正是如此。对于任何绘图程序，问题在于决定绘图位置的计算通常比对绘图功能的调用要复杂得多，并且这些计算程序常常与绘图程序混在一起，所以看起来程序的接口比实际需要的要更复杂。

为了简化问题，考虑一个在屏幕上表示数据的问题，在这里，数据将由内置的Math.sin()方法提供，它可以产生数学上的正弦函数。为了使事情变得更有趣一些，也为了进一步演示Swing组件使用起来有多么简单，我们在窗体底部放置了一个滑块，用来动态控制所显示的正弦波周期的个数。此外，如果调整了视窗的大小，你会发现正弦波能够自动调整，以适应新的视窗。

尽管在任何JComponent上都可以绘图，而且正因为如此，可以把它们当作画布；但是，要是你只是想有一个可以直接绘图的平面的话，典型的做法是从JPanel继承。唯一需要覆盖的方法就是paintComponent()，在组件必须被重新绘制的时候调用它（通常不必为此担心，因为何时调用由Swing决定）。当此方法被调用时，Swing将传入一个Graphics对象，然后就可以使用这个对象绘图了，或在平面上绘制了。

在下面的例子中，所有与绘制动作相关的代码都在SineDraw类中；SineWave类只是用来配置程序和滑块控制。在SineDraw中，setCycles()方法提供了一个钩子（hook），它允许其他对象（在这个例子中就是滑块控制）控制周期的个数。

![836-2](../Images/image03851.jpeg)

![837-1](../Images/image03852.jpeg)

在计算正弦波上的点的过程中用到了所有的字段和数组；cycles表示所希望的完整的正弦波个数，points是将要绘制的点的总数，sines包含了正弦函数的值，pts包含将要绘制在JPanel上点的y坐标。setCycles()方法先根据所需的点数创建数组，然后为数组里的每个元素计算相应的正弦函数值。它通过调用repaint()方法，迫使调用paintComponent()，这样，余下的计算和重绘动作就会发生。

当覆盖paintComponent()方法的时候，必须先调用该方法的基类版本；然后才可以做想做的事情，通常，这意味着要使用你在java.awt.Graphics的文档（在JDK文档中，可从http://java.sun.com找到）中可以找到的Graphics方法向JPanel上绘制像素点。这里，几乎所有的代码都和计算有关；实际上只有setColor()和drawLine()这两个方法和操纵屏幕有关。在创建自己的用于显示图形数据的程序时，可能会有类似的经历：把大部分时间用在所绘内容的决定上，而真正的绘制过程则非常简单。

在我创建此程序的时候，把大量时间用在显示正弦波上。做完这些之后，我觉得如果要是能够动态改变周期的个数，那么它的效果会更好。当我准备这么做的时候，我在别的语言中的编程经验使我觉得，这并不容易实现，但是结果却表明，这是整个程序中最容易的部分。我先创建了一个JSlider（其构造器参数分别是最左边的值、最右边的值和初始值；它还有其他的构造器），然后把它加入到JApplet中。接下来，我参考了JDK文档，发现它仅有的监听器是addChangeListener，它在滑块的变动足以产生新值的时候被触发。唯一能够处理此事件的方法显然就是stateChanged()，它提供了一个ChangeEvent对象，这样就可以追溯到变动源并找出新值。通过调用sines对象的setCycles()就可采用这个新值，JPanel也将被重绘。

通常，你会发现在Swing程序中遇到的问题，大部分都可以通过下列相似的过程得到解决，而且这个过程一般非常简单，甚至从未使用过组件也是如此。

如果要解决更复杂的问题，可以使用更高级的绘图库，包括第三方提供的JavaBeans组件或者Java 2D API。这些内容超出了本书的范围，不过，要是你的绘图代码确实变得过于复杂了，你就应该查找这些内容的相关资源。

练习21：（5）修改SineWave.java，加入相应的getter和setter方法，使SineDraw成为一个JavaBean。

练习22：（7）使用SwingConsole编写一个应用程序。它有三个滑块，每一个分别表示java.awt.Color类型的红、绿、蓝颜色值，窗体的其他部分是一个JPanel，用来显示由三个滑块所决定的颜色。加入一个不可编辑的文本域，显示当前的RGB值。

练习23：（8）以SineWave.java为参考创建一个程序，它可以在屏幕上显示旋转的正方形，并且有一个滑块可以控制旋转的速度，还有一个滑块可以控制正方形的尺寸。

练习24：（7）还记得“绘图板”这个玩具吗？它有两个调节器，一个用来控制绘图点垂直方向的运动，一个用来控制水平方向的运动。以SineWave.java程序为基础，编写一个具有类似功能的程序。这里调节器可以使用滑块来实现。添加一个可以擦除整个图形的按钮。

练习25：（8）在SineWave.java的基础上编写程序（一个使用SwingConsole类的应用程序），在观察窗口画一条动态正弦波，它可以像示波器那样向后滚动，使用一个线程来控制动画。动画的速度由java.swing.JSlider控件进行控制。

练习26：（5）修改前一个练习，在程序里创建多个显示正弦波的面板。面板的数目可以通过HTML标记或命令行参数进行控制。

练习27：（5）修改练习25，使用java.swing.Timer类来控制动画。注意它与java.util.Timer类的区别。

练习28：（7）创建一个骰子类（只是一个类，没有GUI），然后创建五个骰子并重复地掷骰子。画出一条表示每次掷骰子的点数总和的曲线，然后在你掷骰子的次数越来越多时，动态地展开显示这条曲线。