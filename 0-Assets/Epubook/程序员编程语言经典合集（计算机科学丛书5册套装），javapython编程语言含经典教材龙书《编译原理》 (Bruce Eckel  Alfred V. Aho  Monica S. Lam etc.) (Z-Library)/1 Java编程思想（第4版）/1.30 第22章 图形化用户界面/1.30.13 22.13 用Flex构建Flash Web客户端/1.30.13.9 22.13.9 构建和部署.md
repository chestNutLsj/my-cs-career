### 22.13.9　构建和部署

在使用前面的示例时，你在命令行中可以不提供-flexlib标签，但是为了编译这个程序，必须使用-flexlib标签指定flex-config.xml文件的位置。对我的安装来说，下面的命令是可以工作的，但是你必须将其修改为适应你自己的配置（命令是单行的，即中间被包装的那一行）：

![877-1](../Images/image03908.jpeg)

这条命令将把应用程序构建为一个可以用浏览器查看的SWF文件，但是本书的代码发布文件中没有包含任何MP3文件或JPG文件，因此当你运行这个应用程序时，除了框架之外不会看到任何东西。

另外，你必须配置服务器使得Flex应用程序可以成功地与Java文件对话。Flex试用包中包含一个JRun服务器，一旦你安装了Flex，就可以通过计算机菜单或者命令行来启动它：

![877-2](../Images/image03909.jpeg)

你可以通过在Web浏览器中打开http://localhost：8700/samples，并查看各种示例来验证这个服务器是否成功启动了（这还是一种熟悉Flex能力的好方式）。

与在命令行编译应用程序不同，你可以通过服务器编译它。要实现这一点，需要将歌曲源文件、CSS样式表等放到jrun4/servers/default/flex目录下，并通过打开http://localhost：8700/flex/songs.mxml来在浏览器中访问它们。

要想成功运行这个Web应用，你必须同时配置Java端和Flex端。

Java：编译后的Song.java和SongService.java文件必须置于WEB-INF/classes目录中，这正是按照J2EE规范放置WAR类的地方。或者，你可以将这些文件建档，然后将产生的JAR文件放到WEB-INF/lib目录下。这些类必须位于匹配其Java包结构的目录中，如果使用JRun，那么它们就应该位于jrun4/servers/default/flex/WEB-INF/classes/gui/flex/Song.class和jrun4/servers/default/flex/WEB-INF/classes/gui/flex/SongService.class。你还需要使图片和MP3支持文件在Web应用中可用（对于JRun来说，jrun4/servers/default/flex是Web应用的根）。

Flex：为了安全性，除非你通过修改flex-config.xml文件来赋予权限，否则Flex将不能访问Java对象。对于JRun，这个文件位于jrun4/servers/default/flex/WEB-INF/flex/flex-config.xml。转到这个文件的<remote-object>项，查看其中的<whitelist>一节，你会看到下面的提示：

![877-3](../Images/image03910.jpeg)

为了允许访问而去掉<source>项的注释，将使得<source>*</source>可以被读取。这个项和其他项的含义在Flex配置文档中都有所描述。

练习38：（3）构建上面所示的“数据绑定语法的简单示例”。

练习39：（4）本书提供的下载代码不包含SongService.java中所示的MP3和JPG文件。找一些MP3和JPG文件，修改SongService.java，使其包含这些文件的名字，下载Flex使用版并构建这个应用程序。