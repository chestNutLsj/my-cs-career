### 22.14.7　SWT中的并发

尽管AWT/Swing是单线程的，但是如果产生非确定性的程序，那么仍旧有可能违反这种单线程性。基本上，你不会想要用多线程来编写显示功能，因为如果这样的话，它们就会以令人惊讶的方式互相改写了。

SWT根本不允许这样——如果你试图用多个线程来编写显示功能，那么它就会抛出异常。这可以防止程序员新手因不注意而犯此类错误，从而在程序中引入难以发现的缺陷。

下面是Swing版本的ColorBoxes.java程序转移为SWT的版本：

![886-2](../Images/image03924.jpeg)

![887-1](../Images/image03925.jpeg)

与前一个示例一样，绘制是通过创建带有paintControl()方法的PaintListener来控制的，这个方法将在SWT线程准备绘制你的组件时被调用。PaintListener是在CBox的构造器中注册的。

CBox的这个版本明显不同的地方在于run()方法，它不能只是直接调用redraw()，而是必须将redraw()提交给Display对象上的asyncExec()方法，这个方法大体上与SwingUtilities.invokeLater()相同。如果将其替换为对redraw()的直接调用，就会看到程序将停在那里。

在运行这个程序时，你会看到少量的可视化瑕疵，即水平线穿越箱体。这是因为SWT默认情况下不是双缓存的，但Swing是。试着并排运行Swing版本和SWT版本，你就会看得更清楚。你可以编写双缓存的SWT代码，在www.eclipse.org网站可以找到示例。

练习42：（4）修改swt/ColorBoxes.java，使其以闪烁点（“星星”）穿越画布开始，然后随机地改变这些“星星”的颜色。