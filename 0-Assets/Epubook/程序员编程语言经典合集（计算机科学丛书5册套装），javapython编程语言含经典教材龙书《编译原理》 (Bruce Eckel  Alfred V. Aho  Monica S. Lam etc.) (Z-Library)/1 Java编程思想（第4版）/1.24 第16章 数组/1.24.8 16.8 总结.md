## 16.8　总结

在本章中，你看到了Java对尺寸固定的低级数组提供了适度的支持。这种数组强调的是性能而不是灵活性，并且与C和C++的数组模型类似。在Java的初始版本中，尺寸固定的低级数组绝对是必需的，不仅是因为Java的设计者选择在Java中要包含基本类型（也是出于性能方面的考虑），而且还因为那个版本中对容器的支持非常少。因此，在Java的早期版本中，选择包含数组总是合理的。

其后的Java版本对容器的支持得到了明显的改进，并且现在的容器在除了性能之外的各个方面都使得数组相形见绌。就像在本书其他多处地方所叙述的那样，对你来说，性能出问题的地方通常是无论如何你都无法想象得到的。

有了额外的自动包装机制和泛型，在容器中持有基本类型就变得易如反掌了，而这也进一步促使你用容器来替换数组。因为泛型可以产生类型安全的容器，因此数组面对这一变化，已经变得毫无优势了。

就像在本章中描述的，而且当你尝试着使用它们时也会看到，泛型对数组是极大的威胁。通常，即使当你可以让泛型与数组以某种方式一起工作时（在下一章你将会看到），在编译期你最终也会得到“不受检查”的警告信息。

曾经在多个场合，当我和Java语言的设计者们讨论某些特定的示例时，我直接告诉他们：我应该使用容器而不是数组（在这些示例中，我使用数组是为了演示某些具体的技术，因此我没有选择的余地）。

所有这些话题都表示：当你使用最近的Java版本编程时，应该“优选容器而不是数组”。只有在已证明性能成为问题（并且切换到数组对性能提高有所帮助）时，你才应该将程序重构为使用数组。

这是一个相当清晰的陈述，但是有些语言根本就没有尺寸固定的低级数组，它们只有尺寸可调的容器，这些容器与C/C++/Java风格的数组相比，明显具有更多的功能。例如，Python[^4]具有一个使用基本数组语法的List类型，但是它具有更多功能——你甚至可以继承它。

![490-1](../Images/image03373.jpeg)

前一章已经介绍过基本的Python语法。在本例中，直接通过用方括号括起来的且由逗号分隔的对象序列，创建了一个列表，所产生的结果就是运行时类型为List的一个对象（print语句的输出如同一行的注释所示）。打印List的结果与使用Java中的Arrays.toString()相同。

创建List的子序列是通过在索引操作的内部放置“：”操作符，从而用“切片”来实现的。List类型具有很多内置的操作。

MyList是一个类定义，在括号内的是其基类。在这个类的内部，def语句将产生方法，而方法的第一个参数自动地与Java中的this等价，只是在Python中它是显式的，并且按惯例其标识符为self（这不是关键字）。请注意构造器是如何自动继承的。

尽管Python中的每项事物确实都是对象（包括整型和浮点类型），但是仍旧有其他出口，使得你可以去优化代码中性能关键的部分，这时需要用C或C++编写一些扩展，或者使用被称为Pyrex的特殊工具，它被设计用来让我们更方便地提高代码的执行速度。通过这种方式，你仍旧可以保持对象的纯粹性，同时又不妨碍对性能的改进。

PHP语言[^5]走得更远，它只有单一的数组类型，即可以充当用int来索引的数组，也可以充当关联数组（Map）。

在Java不断演化了许多年之后，研究这样一个问题会相当有趣：如果Java的设计者们能够从头再来，他们是否还会在Java语言中设计基本类型的低级数组。如果当初抛弃它们，Java也许就会成为真正的纯面向对象语言（不管人们如何宣传，Java仍旧不是纯面向对象语言，而原因正是这些低级的绊脚石）。最初有关效率的论点总是很吸引人，但是随着时间的推移，我们看到了与这种思想背道而驰，向着使用像容器这类高级构件的方向的演化。另外，如果容器能够像某些语言一样内置于语言的内核中，那么编译器就会得到更好的优化良机。

我们肯定还会使用数组，并且你在读代码的时候还会看到它，但是，容器几乎总是更好的选择。

练习25：（3）用Java重写PythonLists.py。

所选习题的答案都可以在名为The Thinking in Java Annotated Solution Guide的电子文档中找到，读者可以从https://www.mindviewllc.com处购买此文档。

---

[^1]: 尽管在这里事情变得有点含糊，可能在此会产生争议，认为Generator应用了命令模式，但是我认为，实际的任务是填充数组，而Generator只实现了该任务的一部分，因此它更像是策略而不是命令。

[^2]: 参考Erich Gamma的《Design Pattern》和www.MindView上的《Thinking in Pattern（With Java）》。其中《DesignPattern》的中文版、英文影印版及双语版均已由机械工业出版社出版——编辑注。

[^3]: 令人惊奇的是，Java 1.0或1.1对String排序未提供任何支持。

[^4]: 查看www.Python.org。

[^5]: 查看www.php.net。