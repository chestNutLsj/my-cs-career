## 12.4　创建自定义异常

不必拘泥于Java中已有的异常类型。Java提供的异常体系不可能预见所有的希望加以报告的错误，所以可以自己定义异常类来表示程序中可能会遇到的特定问题。

要自己定义异常类，必须从已有的异常类继承，最好是选择意思相近的异常类继承（不过这样的异常并不容易找）。建立新的异常类型最简单的方法就是让编译器为你产生默认构造器，所以这几乎不用写多少代码：

![284-2](../Images/image03005.jpeg)

编译器创建了默认构造器，它将自动调用基类的默认构造器。本例中不会得到像SimpleException（String）这样的构造器，这种构造器也不实用。你将看到，对异常来说，最重要的部分就是类名，所以本例中建立的异常类在大多数情况下已经够用了。

本例的结果被打印到了控制台上，本书的输出显示系统正是在控制台上自动地捕获和测试这些结果的。但是，你也许想通过写入System.err而将错误发送给标准错误流。通常这比把错误信息输出到System.out要好，因为System.out也许会被重定向。如果把结果送到System.err，它就不会随System.out一起被重定向，这样更容易被用户注意。

也可以为异常类定义一个接受字符串参数的构造器：

![285-2](../Images/image03006.jpeg)

新增的代码不长：两个构造器定义了MyException类型对象的创建方式。对于第二个构造器，使用super关键字明确调用了其基类构造器，它接受一个字符串作为参数。

在异常处理程序中，调用了在Throwable类声明（Exception即从此类继承）的printStackTrace()方法。就像从输出中看到的，它将打印“从方法调用处直到异常抛出处”的方法调用序列。这里，信息被发送到了System.out，并自动地被捕获和显示在输出中。但是，如果调用默认版本：

![286-1](../Images/image03007.jpeg)

则信息将被输出到标准错误流。

练习1：（2）编写一个类，在其main()方法的try块里抛出一个Exception类的对象。传递一个字符串参数给Exception的构造器。在catch子句里捕获此异常对象，并且打印字符串参数。添加一个finally子句，打印一条信息以证明这里确实得到了执行。

练习2：（1）定义一个对象引用并初始化为null，尝试用此引用调用方法。把这个调用放在try-catch子句里以捕获异常。

练习3：（1）编写能产生并能捕获ArrayIndexOutOfBoundsException异常的代码。

练习4：（2）使用extends关键字建立一个自定义异常类。为这个类写一个接受字符串参数的构造器，把此参数保存在对象内部的字符串引用中。写一个方法显示此字符串。写一个trycatch子句，对这个新异常进行测试。

练习5：（3）使用while循环建立类似“恢复模型”的异常处理行为，它将不断重复，直到异常不再抛出。