### 17.4.1　未获支持的操作

最常见的未获支持的操作，都来源于背后由固定尺寸的数据结构支持的容器。当你用Arrays.asList()将数组转换为List时，就会得到这样的容器。你还可以通过使用Collections类中“不可修改”的方法，选择创建任何会抛出UnsupportedOperationException的容器（包括Map）。下面的示例包括这两种情况：

![506-1](../Images/image03395.jpeg)

![507-1](../Images/image03396.jpeg)

因为Arrays.asList()会生成一个List，它基于一个固定大小的数组，仅支持那些不会改变数组大小的操作，对它而言是有道理的。任何会引起对底层数据结构的尺寸进行修改的方法都会产生一个UnsupportedOperationException异常，以表示对未获支持操作的调用（一个编程错误）。

注意，应该把Arrays.asList()的结果作为构造器的参数传递给任何Collection（或者使用addAll()方法，或Collections.addAll()静态方法），这样可以生成允许使用所有的方法的普通容器——这在main()中的第一个对test()的调用中得到了展示，这样的调用会产生新的尺寸可调的底层数据结构。Collections类中的“不可修改”的方法将容器包装到了一个代理中，只要你执行任何试图修改容器的操作，这个代理都会产生UnsupportedOperationException异常。使用这些方法的目标就是产生“常量”容器对象。“不可修改”的Collections方法的完整列表将在稍后介绍。

test()中的最后一个try语句块将检查作为List的一部分的set()方法。这很有趣，因为你可以看到“未获支持的操作”这一技术的粒度来的是多么方便——所产生的“接口”可以在Arrays.asList()返回的对象和Collections.unmodifiableList()返回的对象之间，在一个方法的粒度上产生变化。Arrays.asList()返回固定尺寸的List，而Collections.unmodifiableList()产生不可修改的列表。正如从输出中所看到的，修改Arrays.asList()返回的List中的元素是可以的，因为这没有违反该List“尺寸固定”这一特性。但是很明显，unmodifiableList()的结果在任何情况下都应该不是可修改的。如果使用的是接口，那么还需要两个附加的接口，一个具有可以工作的set()方法，另外一个没有，因为附加的接口对于Collection的各种不可修改的子类型来说是必需的。

对于将容器作为参数接受的方法，其文档应该指定哪些可选方法必须实现。

练习6：（2）注意，List具有附加的“可选”操作，它们不包含在Collection中。编写一个Unsupported.java版本，测试这些附加的可选操作。