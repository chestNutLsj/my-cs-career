### 21.7.5　使用ScheduledExecutor的温室控制器

在第10章中介绍过可以应用于假想温室的控制系统的示例，它可以控制各种设施的开关，或者是对它们进行调节。这可以被看作是一种并发问题，每个期望的温室事件都是一个在预定时间运行的任务。ScheduledThreadPoolExecutor提供了解决该问题的服务。通过使用schedule()（运行一次任务）或者scheduleAtFixedRate()（每隔规则的时间重复执行任务），你可以将Runnable对象设置为在将来的某个时刻执行。将下面的程序与在第10章中使用的方式相比，就会注意到，当你使用像ScheduledThreadPoolExecutor这样的预定义工具时，要简单许多：

![763-2](../Images/image03759.jpeg)

![764-1](../Images/image03760.jpeg)

![765-1](../Images/image03761.jpeg)

这个版本重新组织了代码，并且添加了新的特性：收集温室内的温度和湿度读数。DataPoint可以持有并显示单个的数据段，而CollectData是被调度的任务，它在每次运行时，都可以产生仿真数据，并将其添加到Greenhouse的List<DataPoint>中。

注意，volatile和synchronized在适当的场合都得到了应用，以防止任务之间的互相干涉。在持有DataPoint的List中的所有方法都是synchronized的，这是因为在List被创建时，使用了java.util.Collections实用工具synchronizedList()。

练习33：（7）修改GreenhouseScheduler.java，使其使用DelayQueue来替代ScheduledExecutor。