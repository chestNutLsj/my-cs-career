## RISC-V 指令系统概述

### RISC-V 架构特点

- 指令集架构简单
	- 指令集——238 页，特权级编程手册——135 页，其中 RV32I 只有 16页
	- 作为对比，Intel 的处理器手册有 5000 多页
	- 新的体系结构设计吸取了经验和最新的研究成果
	- 指令数量少，基本的 RISC-V 指令数目仅有 40 多条，加上其他的模块化扩展指令总共几十条指令。 

- 模块化的指令集设计
	- 不同的部分还能以模块化的方式组织在一起
	- ARM 的架构分为 A、R 和 M 三个系列，分别针对于 Application（应用操作系统）、Real-Time（实时）和 Embedded（嵌入式）三个领域，彼此之间并不兼容
	- RISC-V 嵌入式场景，用户可以选择 RV32IC 组合的指令集，仅使用 Machine Mode（机器模式）；而高性能操作系统场景则可以选择譬如 RV32IMFDC 的指令集，使用 Machine Mode（机器模式）与 User Mode（用户模式）两种模式，两种使用方式的共同部分相互兼容

### RISC-V 模块化设计

- RISC-V 的指令集使用模块化的方式进行组织，每一个模块使用一个英文字母来表示
- RISC-V 最基本也是唯一强制要求实现的指令集部分是由 I 字母表示的基本整数指令子集，使用该整数指令子集，便能够实现完整的软件编译器
- 其他的指令子集部分均为可选的模块，具有代表性的模块包括 M/A/F/D/C：

![[21-RISC-V-instruction-modular.png]]

![[21-RISC-V-extension-isa.png]]
用户可以扩展自己的指令子集，RISC-V 预留了大量的指令编码空间用于用户的自定义扩展，同时，还定义了四条 Custom 指令可供用户直接使用，每条 Custom 指令都有几个比特位的子编码空间预留，因此，用户可以直接使用四条 Custom 指令扩展出几十条自定义的指令。

### 可配置的通用寄存器组
寄存器组主要包括通用寄存器（General Purpose Registers）和控制状态寄存器（Control and Status Registers）

通用寄存器：
- 32 位架构 (RV32I) 32 个 32 位的通用寄存器，64 位架构 (RV64I) 32 个 64 位的通用寄存器
- 嵌入式架构 RV32E 有 16 个 32 位的通用寄存器
- 支持单精度浮点数（F），或者双精度浮点数（D），另 外增加一组独立的通用浮点寄存器组，f0~f31

控制状态寄存器：
- CSR 寄存器用于配置或记录一些运行的状态（后续异常和中断处理中会详细描述）
- CSR 寄存器是**处理器核内部的寄存器**，使用专有的12位地址码空间

### 规整的指令编码
- 所有通用寄存器在指令码的位置是一样的，方便译码阶段的使用
- 所有的指令都是 32 位字长，有 6 种指令格式：寄存器型，立即数型，存储型，分支指令、跳转指令和大立即数：
![[20-Intruction-riscv-instruction-format.png]]
### 特权模式
RISC-V 架构定义了三种工作模式，又称特权模式 （Privileged Mode）：
- Machine Mode：机器模式，简称 M Mode 
- Supervisor Mode：监督模式，简称 S Mode 
- User Mode：用户模式，简称 U Mode 

RISC-V 架构定义 M Mode 为必选模式，另外两种为可选模式。通过不同的模式组合可以实现不同的系统

在异常和中断处理中会详细讨各个特权模式的机制

## RISC-V 指令集与汇编语言概述

汇编指令格式 `op dst, src1, src2` 
- 1 个操作码，3 个操作数 
- op 操作的名字 
- dst 目标寄存器 
- src1 第一个源操作数寄存器 
- src2 第二个源操作数寄存器 
- 通过一些限制来保持硬件简单

 

### 算术、逻辑、移位

### 数据传输指令
专用内存到寄存器之间传输数据的指令，其它指令 都只能操作寄存器 n 简化硬件设计 n 支持字节（8位），半字（16位），字（32位），双字 （64位，64位架构）的数据传输 n 推荐但不强制地址对齐 n 小端机结构


### 比较、跳转

### 伪指令

### 函数调用