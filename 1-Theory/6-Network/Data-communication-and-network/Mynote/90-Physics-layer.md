> 来自参考书《数据通信与网络》佛罗赞 

## 绪论

### 数据通信

- 数据：指以任何格式表示的信息，该格式需经由创建和使用数据的双方均已达成共识 

- 数据通信：是在两台设备之间通过诸如线缆等某种形式的传输介质进行的数据交换
    - 决定效率的四个关键因素
        - 传递性
        - 准确性
        - 及时性
            - 什么是实时传输？
        - 抖动性
    - 组成
        - 报文 message 
        - 发送方 sender 
        - 接收方 receiver 
        - 传输介质 transmission medium 
        - 协议 protocol 

- 数据表示
	- 文本
		- 位模式（位序列）表示
		- 位的数目决定
		- 统一码 Unicode，ASCII 码 
	- 数字
		- 位模式表示，但ASCII码不是用来表示数字的，直接二进制数转换即可
	- 图像image
		- 位模式表示
		- 被划分为像素矩阵，对每个像素分配一个位模式，模式的大小和值取决于该图像
			- 对一幅仅由黑白点（棋盘）构成的图像而言，1位就足以表示一个像素
			- 如果不是纯黑或纯白，可以增加为模式的大小来包含更多的灰度范围，如黑（00），深灰（01），浅灰（10），白（11）
			- 表示彩色：
			1. 每个颜色像素分解为三原色 RGB，测量其浓度并赋予一种位模式；
			2. YCM 作为三原色
		- 像素大小取决于分辨率
	- 音频audio
		- 连续的、非离散的信号。需要转换
	- 视频video
		- 由一个连续实体或由一组图像或动画合成


- 数据流
	- 单工simplex mode
		- 单向通信，一台设备只发送，另一台只接收。仅具有一个方向的发送能力
	- 半双工half-duplex mode
		- 每台主机均能发送和接收，但不能同时进行，当一台设备发送时，另一台只能接收，即通道的通信能力被发送方完全占用
		- 用于不需要双方同时通信的情况，每一方均可利用整个通道的能力
	- 全双工full-duplex mode
		- 双方主机都能同时发送和接收。两个方向的信号共享该链路的通信能力。共享可以有两种方式：
			- 链路包含两条物理上独立的传输通路，其中一条用于发送，另一条接收
			- 通道的通信能力在以不同方向传输的信号间进行划分
		- 要求双方同时通信时，采用全双工，然而通道的通信能力必须在两个方向之间进行划分


### 网络

- 网络network
    - 是用通信链路连接起来的设备（又称节点）的集合
    - 链路：将数据由一台设备传输到另一台设备的通信通路
    - 设备（节点）：任何能够发送或接收数据的设备，如计算机、打印机
    - 分布式处理distributed processing
        - 将任务划分给多台计算机，而不是让一台大型机负责所有的处理

#### 网络准则

- 性能performance
	- 衡量
		- 传输时间：指报文从一台设备传输到另一台设备所需的时间
		- 响应时间：指请求和响应之间所花费的时间
	- 度量
		- 吞吐量throughput
		- 延迟delay
- 可靠性reliability——衡量标准：
	- 故障出现的频率
	- 一条链路从故障恢复所花费的时间
	- 在灾难中的健壮性
- 安全性security——衡量标准：
	- 保护数据免受未授权的访问
	- 保护数据在传输过程中免受攻击
	- 数据丢失与损伤的恢复策略和方法

#### 物理结构

- 连接类型
	- 点到点（point to-point）：提供两台设备之间专用的链路。链路全部能力均为两台设备之间的传输所共用
	- 多点连接multipoint connection（多站连接multidrop connection）：两台以上设备共享单一链路的情形。通道的能力在空间或时间上共享。
		- 空间上共享连接：同时可以有多台设备使用链路
		- 时间上共享连接：用户必须轮流使用

- 物理拓扑结构(physical topology)：网络在物理上的分布方式，是所有链路及其互相连接的设备（节点）之间关系的几何表示
	- 网状（点到点连接）mesh topology
		- 各台设备之间都有一条专用的点到点链路。专用的，意味着该链路只负责它所连接的两台设备间的通信量
		- n个节点就需要n（n-1）条物理链路，如果允许双工通信，则除2。为了提供这么多数量的链路，网络中的每台设备必须有n-1个IO端口
		- 优点：
			- 专用链路的使用保证了每条链路都能传输自己的数据载荷，消除了当链路被多台设备共享时可能发生的通信量问题
			- 网状拓扑结构是健壮的
			- 良好的机密性和安全性。每一个报文经过专用线路传输时，只有特定的接收方才能看见它
			- 容易进行故障识别和故障隔离
		- 缺点：
			- 安装和重新连接十分困难，因为每台设备都必须与其他所有设备相连
			- 线缆的数量过多，可能超过可利用空间的容纳能力
			- 为连接每个链路所需的IO端口和电缆成本过高
	- 星型（点到点连接）star topology
		- 每台设备拥有一条仅与中央控制器连接的点到点专用链路，中央控制器称为集线器（hub）。此结构不允许设备之间有直接的通信量，集线器扮演交换的角色
		- 优点
			- 易于安装和重新配置，增加、移动和删除链路只涉及一条连接
			- 健壮性
			- 易于进行故障识别和故障隔离
		- 缺点
			- 过于依赖集线器
	- 总线（多点连接）bus topology
		- 由一条较长的线缆作为主干backbone来连接网络上所有的设备
		- 节点由引出线和分接头连接到总线电缆。引出线是在设备和主线缆之间运行的连接，分接头是一个焊入主线缆或穿过线缆的外皮与金属芯接触的连接器
		- 优点：
			- 安装简易，主干线缆以最高效的路径来铺设，通过不同长度的引出线连接到节点
			- 只有主干电缆铺设于整个房间中，每条引出线只需到达主干线上最近的节点
		- 缺点：
			- 信号沿主干传输时，部分能量转化为热能，会随着距离的增加信号越来越微弱。因此总线所能支持的分接头数目以及这些分接头之间的距离有限
			- 难以重新连接和进行错误隔离。它在设计安装时就按最优方式铺设，增加新设备较困难
			- 在分接头会产生信号反射造成质量下降，虽然可以通过限制连接到给定电缆的设备数目和距离来控制这种质量下降的问题
			- 总线电缆上的错误或中断会使所有的传输中止，即使位于故障区域同一侧的设备。故障区域会将源方向的信号反射回去，从而在两个方向上产生噪音
	- 环状（多点连接）ring topology
		- 每台设备只与其两侧的设备有一条专用的点到点的连接。信号以一个方向在环中传输，从一台设备到另一台，直到目的设备。环中每台设备中安装一个中继器，当设备接收到发给另一台设备的信号时，它的中继器会再生并转发这些位
		- 优点：
			- 易于安装和重新配置，要增加或删除设备只需要改变两条连接
			- 简化了故障隔离
		- 不利因素：
			- 在于介质和通信量方面（环最大长度和设备的最大数目）
			- 单向通信量。简单的环中，故障可能使整个网络瘫痪，可以通过引入双环或使用能够旁路故障的开关弥补
	- 混合型
		- 如：一个星型结构为主干并具有多个总线结构的网络

#### 网络模型

- 计算机网络是由许多实体组成，需要标准协调网络之间的通信

- 著名标准：
	- OSI（开放系统互连）模型
	- 因特网模型


- 网络分类：按规模划分
	- 局域网 LAN（local area network），覆盖范围小于两英里
		- 通常是专用的。其设计用来共享个人计算机或工作站之间的资源（硬件如打印机、软件如应用程序、数据等等）
		- 通常给定的LAN仅使用一种类型的传输介质，常见使用总线结构、环状结构、星型结构
		- 传统数据速率在4~16Mbps之间。吉位系统的开发可以使其提升至100
	- 城域网MAN（metropolitan area network），覆盖范围十几英里
		- 为需要高速地连接因特网的用户而设计
	- 广域网WAN（wide area network），可以是世界范围
		- 提供远距离的数据、音频、图像和视频信息传输，跨越的地理区域包括国家、洲、世界。
		- 通常首先指交换广域网，其次是点到点广域网
			- 交换广域网：连接端系统，该系统含有一个路由器（网际互联设备），它连接另一个局域网或广域网。典例：X.25和异步传输模式ATM网络
			- 点到点广域网：通常从电话局或有线电视电缆提供商租用专线连接家用计算机或小型局域网到因特网服务提供商ISP，常用作对因特网的访问


- 网络互连：因特网

- 两个或多个网络彼此连接，成为互联网络internetwork


### 因特网

- 历史
	- 因特网Internet是由成千上万的互相连接的网络组成的集合
	- 1967年，ACM会议上，ARPA（美国国防部DoD高级研究计划局Advanced Research Project Agency）提出了ARPANET概念
	- 1969年，实现了由四个节点（UCLA、|UCSB、SRI、犹他大学）通过IMP（接口报文处理器）连接而成的ARPANET。由称为网络控制协议NCP的软件提供主机间通信
	- 1972年，Vint Cerf和Bob Kahn在网络互连项目上合作。第二年发表论述了端到端的信息分组发送协议实现的论文TCP，后来专家将其拆分成两部分
		- 传输控制协议TCP（Transmisson Control Protocol）：负责高层功能，如分段、重组和差错检测
		- 网际协议IP（Internetworking Protocol）：负责处理数据报路由

- 现状
	- 因特网现在是由私有公司而不是政府运行，大多数想建立因特网连接的终端用户使用因特网服务提供商ISP（Internet Service Provider）提供的服务
	- ISP分类
		- 国际服务提供商
		- 国家服务提供商NSP（National Service Provider）：有专门的公司创建和维护的主干网络。为了提供终端用户之间的连接，主干网络由复杂的交换工作站连接，称为网络访问点NAP（network access point）。以很高的数据速率（600Mbps）运行
		- 区域性因特网服务提供商regional ISP，连接到一个或多个NSP的小型ISP。数据速率较低，第三层
		- 本地因特网服务提供商local ISP，提供到终端用户的直接服务

### 协议与标准

- 协议
	- 实体是能够发送和接收信息的任何事物，计算机网络中的通信发生在不同系统的实体之间。协议是用来管理数据通信的一组规则，规定了通信的内容、通信的方式和通信的时间
	- 核心要素
		- 语法syntax：数据的结构或格式
		- 语义semantics：每一个位片段的含义
		- 时序timing：报文的发送时间和发送速率

- 标准：为制造商、销售商、政府部门和其他服务提供商提供了一系列准则
	- 事实通信标准de facto standard：未经组织团体承认但已经在广泛使用中被接受的标准
	- 法定通信标准de jure standard：由官方认可的团体制定的标准

- 标准化组织（北美）
	- 国际标准化组织ISO
	- 国际电信联盟-电信标准分会ITU-T
	- 美国国家标准协会ANSI
	- 电气和电子工程师协会IEEE
	- 电子工业协会IEA
	- 论坛forums：由于其用户专注于某一具体的技术，能够在电信领域加速这些技术的采纳和使用

- 因特网标准Internet standard：经过完全测试的规范，对使用因特网的人们有用并且被他们所拥护



## 网络模型

- 任务分层
    - 发送方、接收方和载体
    - 层次结构
        - 对发送方和接收方而言，任务的进行必须按照给定的层次顺序完成
        - 服务：在接收方，每一层都使用其直接下层提供的服务

### OSI模型

Open System InterConnection

- 简述
	
	- 一个能包含网络通信各方面的ISO（国际标准化组织）标准的模型
		
	- 开放系统open system，是一组协议，它允许任何两个不同系统进行相互通信，而不管其底层结构如何
		
	- OSI模型目的：使不同系统间的通信变得容易，而不要求对其底层的硬件和软件的逻辑结构做任何改动
		
	- OSI模型不是一个协议，而是一个模型，利用这一模型可以理解并设计一个灵活、健壮和可互操作的网络体系结构
		
	- OSI模型提供了一个用来进行网络系统设计的层次化框架，由7个相互独立又相互关联的层次组成，每一层都定义了通过网络传递信息的一部分功能


- 层次化体系
	
	- OSI可有序地分层：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层
		
	- 建立模型过程中，设计者将传输数据的过程归结为一些最基本的元素，这些元素确定了具有相关用途的网络功能，按照功能归类的功能组就是各个层次。每一层都定义了一系列与其他层次不同的功能
		
	- 通过这种方式进行功能定义和局部化，使设计者能建立一个全面又灵活的体系结构。由此，OSI模型得以使不兼容系统之间完全透明化
		
	- 单台机器中，每一层调用下一层提供的服务；两台机器之间，一台机器上的第x层与另一台机器的第x层进行通信。这种通信由一些列协议来控制


- 对等过程
	
	- 定义：每台机器上==特定层次的通信过程==。由此，机器间的通信就是使用适用于给定层次的协议的对等过程
		
	- 在发送端，每一层都在从直接上层传来的报文加上自己的信息，并将整个分组传到它的直接下层；在物理层，整个分组被转换成可以传输到接收端设备的形式；在接收端，报文被一层一层打开，每一层接收兵提取对它有意义的数据
		
	- 层间接口：数据和网络信息在层次间的传递，是通过相邻两层的接口来实现的
		
		- 每一层接口都定义了该层必须向上层提供信息和服务
			
		- 良好定义的接口和层功能可使网络模块化
			
		- 只要某一层仍能为上一层提供所期望的功能，该层功能的具体实现就可以在不改变周围层次的基础上进行修改和替换
			
		
	- 层次组织
		
		- 7个层次可以分成3个子功能组
			
			- 网络支持层（物理层、数据链路层、网络层）：处理从一设备到另一个设备数据传输的物理方面问题（如电气特性、物理连接、物理寻址、传输的时序和可靠性）
				
			- 传输层：将两个子功能组连接起来，保证下层是以上层能够使用的形式传输的
				
			- 用户支持层（会话层、表示层和应用层）：允许不相关的软件系统间的互操作
				
			
		- 高层通常通过软件实现，低层则通过硬件软件混合，物理层几乎都是硬件
			
		- 发送过程从第七层（应用层）开始，一层层向下移动，在每一层数据单元可能加入头部或尾部。格式化的数据到达物理层时，转换成电磁信号在物理链路上传输
			
		- 接受过程，信号传入第一层并被重新转换成数字形式，之后从下向上传到OSI各层。当每一数据块到达下一更高层时，在发送端对应层次附加的头部和尾部就被除去，并执行该层相应的动作


- 封装
	
	- 定义：第n-1层的分组中的数据部分是第n层的完整分组（数据+头部或尾部）
		
	- 第 n-1层不知道被封装分组中，哪些部分是数据，哪些部分是头部或尾部。对于第 n-1层，来自第 n 层的分组是作为一个整体单元处理的

### OSI模型各层功能

![[20-网络模型-OSI.png]]

#### 物理层

通过介质传输bit，提供机械及电气规范

- 定义了接口与传输介质的机械和电气特性，也定义了物理设备和接口为了传输而必须执行的过程和功能
	
- 负责位从一个节点到另一个节点的传递
	
- 考虑问题：
	
	- 接口与介质的物理特性：定义了设备与传输介质之间的接口特性，也定义了传输介质的类型
		
	- 位的表示：物理层的数据是没有任何解释的位bit流（由0、1组成的序列），要进行传输必须将之编码成信号（电信号、光信号）。因此，要定义编码encoding的类型（如何将0、1转换成信号）
		
	- 数据速率：传输速率——每秒发送的位数。换言之，定义一个位的持续时间
		
	- 位同步：发送方和接收方要有相同的比特率，也要位同步（发送时钟和接收时钟同步）
		
	- 线路配置：设备与介质的连接（点到点配置、多点配置）
		
	- 物理拓扑结构：定义如何将设备连接成网络（网状、星型、环状、总线）
		
	- 传输方式：两台设备间的传输方向（单工、半双工、全双工）


#### 数据链路层

将 bit 组成帧，提供节点到节点的传递

- 将物理层——对数据不做任何改动的传输通道变成可靠的链路，由此将物理层的数据无差错地传递给上层（网络层）
	
- 负责帧从一跳（节点）到下一跳（节点）的传递
	
- 考虑问题：
	
	- 成帧：将接收到的来自网络层的位流划分成帧（易处理的数据单元）
		
	- 物理寻址：
		
		- 如果帧是发送给网络中的不同系统，则链路层在帧的头部添加发送方的物理地址和接收方的物理地址
			
		- 如果帧发往发送方网络之外的系统，接收方的地址就是连接一个网络到下一个网络的设备地址
			
		
	- 流量控制：防止接收方接收数据过载
		
	- 差错控制：检测与重发损坏帧或丢失帧，防止重复帧（差错控制通常在一个帧地结束处增加一个尾部来处理）
		
	- 访问控制：当两台或多台设备连接到同一条链路上时，数据链路协议必须能决定在任意时刻由哪一台设备来获取对链路的控制权
		
	
- 跳到跳传递hop-to-hop delivery（节点到节点传递node-to-ndoe delivery）

#### 网络层

将分组从源传递到目的地，提供网际互连

- 负责将各个分组从源地址传递到目的地址，可能会通过多个网络（链路）。尽管链路层会监视同一个网络（链路）上两个系统之间分组的传递，但仍需网络层确保每个分组能够从出发点到达目的地
	
- 如果两个系统连接在同一条链路上，通常不需要网络层；如果两个系统在不同的网络（链路）上并通过网络（链路）之间的设备连接，通常需要网络层以完成源端到目的端地传递
	
- 考虑问题：
	
	- 逻辑寻址：给来自上一层的分组增加一个头部，包括发送方和接收方的逻辑地址
		
		- （物理寻址负责处理本地网络寻址问题，由链路层完成，如果一个分组通过网络边界，就需要另一个寻址系统来帮助区分源与目的系统）
			
		
	- 路由选择：提供连接设备（路由器或网关）把分组送到它们的最终目的地的机制。（对于一些独立网络或链路连接在一起构成一个互联网或一个更大网络的情况）

#### 传输层

提供端到端的可靠报文传递和差错纠正

- 负责整个报文的进程到进程传递
	
- 网络层监管各个分组的源端到目的端传递，但并不了解这些分组之间的相互关系。传输层确保整个报文误差挫并按顺序地到达目的地，在源到目的层次进行差错控制和流量控制
	
- 考虑问题：
	
	- 服务点寻址：将信息的头部包含服务点地址（端口地址），以应对从计算机到计算机、特定进程到特定进程的情况。网络层将每个分组传送到指定的计算机上，传输层将整个报文传送给该计算机上的指定进程
		
	- 分段和组装：将报文分解成可传输的片段，并且给这些片段编号（编号可以在接收端正确组装报文，也可以用来标识和替换传输中丢失的分组）
		
	- 连接控制：无连接或面向连接
		
		- 无连接：将每个片段作为一个独立的分组，并将它传递到目的机器的传输层
			
		- 面向连接：在传递分组之前，需要与目的机器的传输层建立一条连接，所有数据被传输后，该连接释放
			
		
	- 流量控制：端到端上控制流量，而不是单条链路上
		
	- 差错控制：进程到进程上控制差错，而不是单条链路上。发送方的传输层确保整个报文无差错（损坏、丢失或重复）地到达接收方的传输层。通过重发来纠正差错


#### 会话层

建立、管理和终止对话

- 网络的对话控制器，建立、维护和同步通信系统间的交互操作
	
- 考虑问题：
	
	- 对话控制：允许两个系统进入会话，允许两个进程之间以半双工、全双工方式进行通信
		
	- 同步：允许一个进程在数据流中增加检查点或同步点(synchronization point)


#### 表示层

翻译、加密和压缩数据

- 两个系统之间交换信息的语义和语法
	
- 负责翻译、加密和压缩数据
	
- 考虑问题：
	
	- 翻译：发送方的表示层将信息从发送方使用的格式转换成一个公共格式，接收方机器的表示层将公共格式转换成接收方使用的格式
		
		- 两个系统中的进程通常以字符串、数字等格式交换信息，传输前信息要转换成位流，不同的计算机采用不同的编码系统，表示层负责不同编码方式之间的互操作
			
		
	- 加密：发送方将原来的信息转换为另一种形式，并在网络上发送转换后的形式。解密反之
		
	- 压缩：减少需要传输数据的位数。对于多媒体（文本、音频、视频）的传输很重要


#### 应用层

允许访问网络资源

- 使得用户（人或软件）可以访问网络，提供了用户接口和访问支持。（如电子邮件、远程文件访问与传输、共享数据库管理以及其它分布式信息服务）
	
- 负责向用户提供服务
	
- 考虑问题：
	
	- 网络虚拟终端：物理终端的软件版本，允许用户登陆到一台远程主机上
		
		- 应用程序在远程主机上创建一个软件模拟终端，用户计算机只与这个软件终端对话，软件终端与主机对话，反之亦然。远程主机认为自己是在与自己的一个终端通信，因而允许用户登录
			
		
	- 文件传输、访问和管理：允许用户访问远程计算机上的文件（进行修改或读取数据），从远程计算机上检索文件，以及管理或控制远程计算机上的文件
		
	- 邮件服务：电子邮件存储转发的基础
		
	- 目录服务：提供分布式数据库资源以及对不同对象和服务的全球信息的访问

### TCP/IP协议族

- 由相互作用的模块组成分层协议，每一层提供一个特定的功能，但不需要相互依赖。各层包含一些相对独立的协议，它们依据系统的需要混合语匹配（分层：意指每个上一层协议是由一个或多个下层协议支持的）
	
- 分层与各层协议
	
	- 实际层次：
		
		- 主机到网络层：相当于OSI的物理层和数据链路层的组合
			
		- 互联网层：网络层
			
		- 传输层：处理会话层的部分功能
			
		- 应用层：相当于会话层、表示层和应用层
			
		
	- 为分析理解假定层次：
		
		- 对应于OSI模型前4层，提供物理标准、网络接口、网际互连和传输功能
			
			- 物理层和数据链路层：TCP/IP不定义任何协议，支持所有标准和专门协议，采用TCP/IP互联的网络可以是LAN和WAN
				
			- 网络层：支持网际协议IP（Internetworking Protocol）
				
				- 网际协议IP：TCP/IP协议使用的传输机制
					
					- 是一个不可靠、无连接数据报协议，称为尽力传递best-effort delivery，尽力意即IP没有差错检测和跟踪。IP假定了底层是不可靠的，只是尽最大努力传输到目的地，但没有保证
						
					- IP传输的数据称为数据报，每一个数据报都独立地传输。数据包可以沿着不同的路由传输，有可能不按顺序到达、重复出现等。IP没有路由跟踪，数据报一旦到达目的地，没有重新排序功能
						
					- 不要将这个局限看作缺点，这样简单的传输使用户自由添加已知应用所必需的功能，效率更高
						
					
				- IP使用四个支持协议：
					
					- 地址解析协议ARP（Address Resolution Protocol）：将逻辑地址与物理地址相联系起来，用于已知节点的因特网地址寻找该节点的物理地址
						
					- 逆地址解析协议RARP（Reverse Address Resolution Protocol）：允许主机在仅知道物理地址的情况下寻找因特网地址。在主机第一次连接到网络上或启动一台无盘计算机时会用到
						
					- 因特网控制报文协议ICMP（Internet Control Message Protocol）：有主机和网关所使用的一种机制，用来向发送方通知数据报所发生的问题
						
					- 因特网组报文协议IGMP（Internet Group Message Protocol）：用于将一个报文同时发送给一组接收者
						
					
				
			- 传输层：用TCP、UDP、SCTP三个协议表示
				
				- IP是主机到主机协议，可以将分组从一个物理设备传递到另一个物理设备；UDP、TCP是负责将报文从一个进程传递到另一个进程的传输层协议
					
				- 用户数据报协议UDP（User DATa gram Protocol）：是一个进程到进程的协议，仅将端口号、校验和差错控制及信息长度添加到来自上一层的数据中
					
				- 传输控制协议TCP（Transmission Control Protocol）：为应用程序提供了完整的传输层服务，是一个可靠的流传输协议（流表示面向连接的：在传输的两端可以传送数据以前必须先建立连接）
					
				- 流控制传输协议SCTP（Stream Control Transmission Protocol）：用于对较新应用提供支持，如音频传输
					
				
			
		- 对应OSI模型最上面3层（会话层、表示层、应用层）的单一层
			
			- 应用层

### 寻址

采用TCP/IP协议的互联网使用四层地址：

- 物理（链路）地址physical（link） address：
	
	- 对应数据链路层和物理层
		
	- 是局域网或广域网定义的节点地址，包含在数据链路层所用的帧中，是最低级的地址
		
	- 长度和格式可变，与网络有关。大多局域网用48位（6个字节）的物理地址，被写作12个十六进制的数字，每个字节用冒号分割开
		
	- 帧的头部含有物理地址，目的地址在前，源地址在后


- 逻辑地址logical address：
	
	- 对应网络层
		
	- 唯一定义了连接到因特网的一台主机，与下面的物理网络无关，适应全世界互联的网络环境
		
	- 发送方在网络层封装分组并添加源地址和目的地址，源地址在前，目的地址在后
		
	- 帧的物理地址会改变，但源和目的逻辑地址必须保持相同，否则该分组将会被丢失


- 端口地址port address：
	
	- 对应传输层
		
	- 因特网通信的最终目的是进程到进程的通信。为了使不同的进程同时接收数据，用16位端口地址赋予进程标识符，以此标记不同的进程
		
	- 即使两台计算机运行同一个应用程序，但一个是客户进程，另一个是服务进程，其端口地址不同
		
	- 在因特网范围内，从跳到跳物理地址会改变，但从源到目的逻辑地址和端口地址保持不变

- 专用地址：
	
	- 对应应用层
		
	- 面向用户的应用设计为专用地址。如电子邮件的地址 `1821552335@qq.com`，统一资源定位符 URL `www.google.com`，
	- 前者定义邮件的接发者，后者在万维网中寻找一个文档。这些地址由发送计算机转换成对应的端口地址和逻辑地址


## 数据和信号

### 模拟与数字

数据以及表示数据的信号可以使用模拟analog或者数字digital的形式

- 模拟数据与数字数据
	
	- 模拟数据指连续状态的信息，例如人说话时形成模拟形式的声波，通过麦克风采集并转换成模拟信号，或者采样转换成数字信号
		
	- 数字数据指离散状态的信息，例如0/1形式的数据可以转换成数字信号，或调制成模拟信号通过介质进行传输

- 模拟信号与数字信号
	
	信号signal可以是数字信号或模拟信号
	
	- 模拟信号在一段时间内有无穷多个强度等级。当波形振幅由A变为B时，沿着它变化的过程有无穷多个值
		
	- 数字信号只能有有限个已定义的数值，通常是0或1
		
	- 以信号的值或强度为纵轴，时间为横轴建立直角坐标系
		
		- 表示模拟信号的曲线经过了无限多个数值点
			
		- 表示数字信号的竖直线表示了信号值到值的突变

- 周期信号与非周期信号
	
	- 周期信号periodic signal在一个可测量的时间范围内（一个周期period）完成一种模式，并且在后续的相同时间范围内重复这一模式。一个完整模式的实现称为一个循环
		
	- 非周期信号nonperiodic signal的变换则不会随时间的变化出现重复的模式或循环
		
	- 周期模拟信号需要更少的带宽，非周期数字信号可以表示数据的变化

### 周期模拟信号

- 正弦波
	
	​正弦波是不能再被分解的简单模拟信号，由峰值振幅、频率和相位三个参数完全确定；复合型模拟信号是由多个正弦波信号组成的
	
	- 峰值振幅：最高强度的绝对值，与所携带的能量成比例（对电信号，常以伏特为单位计量）
		
	- 周期与频率：周期Period是信号完成一个循环所用时间，单位秒；频率Frequency是1s内完成的周期数，单位赫兹
		
		- 频率既可以看做一秒钟完成的周期数，也可以看作变化速率的计量单位（变化占用的时间短意味着频率高，变化占用的时间长意味着频率低）
			
		- 信号持续不变化，则频率值为0；由一个电平立即跳变到另一电平，频率值为无穷大

- 相位phase
	
	相位指波形相对于时间零的位置

- 波长wavelength
	
	波长是信号通过传输介质传播的另一个特性，将简单正弦波的周期或频率与介质的传播速度propagation speed结合在一起
	
	- 信号的频率与介质无关，但波长取决于频率和介质，波长是任何信号的一个属性
		
	- 在数据通信中，一般用波长来描述光纤中的光传输。波长是简单信号在一个周期能传播的距离
		
	- 波长=传播速度×周期。电磁信号的传播速度取决于介质和信号频率


- 时域time-domain和频域frequency-domain
	
	- 时域图time-domain plot显示了信号振幅随时间的变化情况，相位在其中没有显式的表现出来
		
	- 频域图frequency-domain plot只和峰值、频率相关，不显示一个周期中的振幅变化。通过一个尖峰表示完整的正弦波，其位置表示频率，其高度表示峰值振幅
		
	- 处理多个正弦波时，频域图更简洁有用


- 复合信号composite signal
	
	单一正弦波将电子能量从一个位置传送到另一个位置，但不会携带任何信息；复合信号才能用来通信
	
	- 傅里叶分析指出，任何复合信号都是由具有不同频率、相位和振幅的正弦波信号组合成的
		
	- 复合信号可以是周期性的或非周期的。周期复合信号可以分解成一系列具有离散频率的简单正弦波；非周期复合信号可以分解成具有连续频率的无穷简单正弦波的组合
		
	- 与周期性复合信号频率相同的分解正弦波频率为f，称为基础频率（fundanmental）、第一谐波（harmonic）；其他频率为kf的，称为第k谐波。分解后的信号频率是离散的，k为整数。周期复合信号的频率总是由离散尖峰组成
		
	- 对于非周期复合信号，时域表示有无数个简单正弦频率，但频率的范围是有限的，频域表示是一条连续的曲线


- 带宽bandwidth
	
	- 复合信号包含的频率范围叫带宽，通常是最大频率与最小频率之差


- 非周期复合信号的例子：
	
	- 有调幅AM无线电站传播的信号（美国分配给每个AM无线电站10kHz带宽，总带宽从530kHz到1700kHz）
		
	- 调频FM无线电站传播的信号（美国分配给每个FM无线电站200kHz带宽，总带宽从88MHz到108MHz）
		
	- 黑白电视接收信号，屏幕扫描次数×像素总值即使每秒变化的像素，以最低振幅、最高振幅各表示一种颜色则每周期可发送2像素，故二者之商是每秒所需要周期，由此可以得出需要带宽。大约每个黑白电视频道有4MHz带宽


### 数字信号

如果信号有 L 个电平，则每个电平需要 $\log_{2}L$ 个位。由此，多个电平可以发送多个位。每个电平发送的位数必须是整数且是2的幂，故电平取值为向上取整

- 比特率bit rate：1s中发送的位数，单位是bps（bits per second每秒位）

- 位长bit length：一个位在传输介质上的距离。位长=传播速度×位持续时间

- 数字信号是一种复合模拟信号
	
	基于傅里叶分析，数字信号是复合模拟信号
	
	- 带宽是无穷大的。因为在时域中，数字信号由连接的垂直和水平线段组成，垂直线表示无穷大的频率，水平线表示0频率
		
	- 运用傅里叶分析分解数字信号：
		
		- 如果数字信号是周期性的，分解后的信号可以表示为无穷大带宽和离散频率的频域
			
		- 非周期性的，则是无穷大带宽和连续的频率

#### 数字信号的传输

数字信号是无穷大带宽的复合模拟信号

- 基带传输
	
	- 通过通道发送数字信号，该信号不转换成模拟信号
		
	- 基带baseband传输需要一个带宽下限频率为0的低通通道（low-pass channel），此时带宽只组成一条通道的专用介质。无穷大带宽的低通通道仅是理想情况，现实中不可能存在
		
	- 两种低通通道：
		
		- 宽带宽：只有在无穷大或非常大带宽的低通通道，保持数字信号形状的数字信号基带传输才是可能的
			
			注意例3.21，LAN使用专用通道（介质的整个带宽用于一条单通道）用于两个站之间互相通信。多点连接的总线拓扑结构LAN中，每个时刻只有两个站可以互相通信，其他站限制发送数据；星型拓扑结构中，每个站和集线器之间的整个通道用于这两个实体间通信
			
		- 窄带宽：此中，将数字信号近似成模拟信号，近似程度取决于可用的带宽
			
			- 大致近似：对于比特率为N的数字信号，用频率为f=N/2的模拟信号（每个周期发送两位，以1为正尖峰值，0为负尖峰值）作为最大频率，其他如N/4频率及不同相位可以大致近似表示不同的数字信号。大致近似称为第一谐波N/2频率
				
			- 更好近似：增加频率更多的谐波来使得模拟信号的形状更像数字信号，因此要增加带宽，如增加带宽到3N/2、5N/2、7N/2等
				
			
		
	- 在基带运输中，所需的带宽与比特率成正比；如果需要更快地发送位，就需要更大的带宽
		
	- 应用：
		
		- 如果需要使用基带传输发送1Mbps，则低通通道所需带宽是多少？
			
			取决于所需的准确性
			
			- 最小带宽、大致近似，则B=1Mbps÷2=500kHz
				
			- 使用第一和第三谐波结果更好，所需带宽B=3×500kHz=1.5MHz
				
			- 使用第一、第三、第五谐波仍然更好，则B=5×500kHz=2.5MHz
				
			
		- 有一条带宽为100kHz的低通通道，求其最大比特率：使用第一谐波可以得到最大比特率，比特率是2倍有效带宽，即200kbps

- 宽带传输（使用调制）
	
	即把数字信号转换成模拟信号运输
	
	- 调制允许使用带通通道bandpass channel，即带宽不从0开始的通道，其比低通通道更可用。低通通道可以看作是较低频率从0开始的带通通道
		
	- 数字信号的调制过程：发送方，数字信号转换成复合模拟信号，使用单频率模拟信号（载波）已经改变的载波振幅使其看起来像数字信号（结果不是单频率信号，是复合信号）；接收方，接收到的模拟信号转换成数字信号
		
	- 注意例3.24、例3.25，分别是通过电话用户线传输计算机数据和数字蜂窝电话。对于数字蜂窝电话实例，如果有效带宽是W，且允许1000对用户同时交谈，意味着有效带宽是W/1000，只是整个带宽的一部分


### 传输减损

#### 衰减attenuation

- 意味着能量的损失。当某种简单或者复合的信号通过某种介质传输时，它会失去一些能量用于克服介质的阻抗，信号中的一部分电能转换成热能（为了补偿能量损失，可用放大器放大信号）
	
- 分贝decibel：
	
	用于计算两种信号之间或者同一信号在两个不同位置之间的相对强度
	
	- $dB=10\log_{10} \frac{P_{2}}{P_{1}}$，P1 和 P2 分别是信号在位置 1 和位置 2 的功率；
	- 若以电压定义分贝，则公式为 $dB=20\log_{10} \frac{V_2}{V_1}$
		
	- dB为负值，则信号被衰减了；dB为正值，信号被放大了。-3dB或3dB衰减等价于功率损失了一半
		
	- 当涉及计量多处（级联）而不仅仅是两处的信号强度时，分贝数可以相加（相减）
		
	- 以毫瓦计量信号功率：$dB_{m}=10\log_{10} P_{m}$，$P_m$ 是以毫瓦为单位的功率

#### 失真distortion

- 意味着信号改变了形态或形状，产生在由不同频率成分组成的复合信号当中
	
- 每一种信号成分在通过介质时有自己的传播速度，到达最终目的节点时有各自的延迟。如果延迟与周期时间不完全一致，那么延迟的差异就会产生相位的差异，即接收方的信号成分与发送方的信号成分存在相位差异。由此出现复合信号的失真

#### 噪声noise

- 类型：
	
	- 热噪声：电缆中的电子随机移动产生的额外信号
		
	- 感应噪声：发动机和设备工作时相当于发射天线，而传输介质成为接收天线
		
	- 串扰：电缆之间的相互影响，一条电缆作为发射天线而另一条作为接收天线
		
	- 脉冲噪声：一种尖峰信号，非常短时间内有很高能量的一种信号，来自传输电线、闪电等


- 信噪比SNR（signal-to-noise ratio)
	
	- $SNR=\frac{平均信号功率}{平均噪声功率}$，即所需信号和无用信号的比率。较高的SNR意味着信号较少地被噪声破坏，较低地SNR则意味着信号较多的被噪声破坏
		
	- 用分贝单位描述 SNR，即 $SNR_{dB} = 10\log_{10}SNR$。对于无噪声通道的 SNR 为 $+∞$，SNR（dB）也为 $+∞$


### 数据速率限制

数据通信的一个重要问题：在一个通道中能够以多快的速率发送数据，即每秒钟的比特数

- 取决因素
	
	- 有效带宽
		
	- 使用的信号电平数
		
	- 通道的质量（噪声电平）


#### 奈奎斯特公式Nyquist bit rate

- 用于无噪声通道，定义了理论上的最大比特率：
	- $比特率=2×带宽×\log_{2}L$
	
- 虽然在理论上由此公式可认为给定特定的带宽可以通过增加信号电平数获得任何我们想要的比特率，但实际上**电平数的增加增大了接收方的负担，对方很难区分多个电平**。增加信号电平数减弱了系统的可靠性
	
- 奈奎斯特公式可以应用到基带传输和调制，也可以应用到有两个或多个信号电平的情况


#### 香农容量定理Shannon Capacity

- 能够确定噪声通道理论上的最高数据速率：
	- $通道容量=带宽×\log_{2}(1+SNR)$，通道容量是指通道的传输容量，即每秒的比特数

- 公式中没有指出信号电平，意味着无论使用多少个电平，都不能获得比通道容量更高的数据速率。**公式定义了通道的特性，而不是传输方式**

- 对于信噪比 SNR 接近于0的通道，其容量计算也为0，且与带宽无关，通过此通道不能接收到任何数据 

- 要使得数据发送速率更宽，需要更大的线路带宽或更高的信噪比

- SNR 很大时，SNR+1与 SNR 几乎相等，此时可以简化计算：$通道容量 C=\frac{带宽B×SNR_{dB}}{3}$ 

- 二者结合使用，先用香农容量定理确定数据速率的上限，再以确定的数据速率利用奈奎斯特公式计算信号电平的数量（为了获得更好的性能，可选择较低的数据速率）


### 性能

#### - 带宽

- 以赫兹衡量的带宽：复合信号包含的频率范围或通道能通过的频率范围
	
- 以每秒比特数衡量的带宽：指通道、链路或者网络每秒能发送的位数
	
- 两者关系：以赫兹衡量的带宽的增长意味着以每秒位数衡量的带宽的增长。之间的关系取决于是否有基带传输或者调制传输


#### 吞吐量 throughput

用于衡量通过网络发送数据的快慢

- 与以每秒位数衡量的带宽是不同的。带宽是链路的潜在衡量值，而吞吐量是发送速度快慢的实际衡量值，实际永远比潜在小
	
- 吞吐率=位总数÷时间


#### 延迟delay

定义了第一个位从源开始发出到整个报文完全到达目标所经历的时间。延迟=传播时间+传输时间+排队时间+处理延迟

- 传播时间propagation time:衡量一个位从源传输到目标所需的时间。传播时间=距离/传播速度
	
- 传输时间transmission time:传输时间=报文长度/带宽
	
- 排队时间queuing time:每个中间或端设备在处理报文前所需的时间。这个不是固定因素，会随着网络负载而改变。中间设备（如路由器）对到达报文进行排队然后一个个处理，吐过报文过多，每个报文就不得不等待
	
- 处理延迟processing delay

#### 带宽延迟之积

是能充满链路的位的个数。类比于水管的容量，横截面为带宽，长度为延迟

- 为了使用链路的最大容量，需要脉冲长度是宽带和延迟乘积的两倍，需要充满全双工通道
	
- 发送者应该发送一个（2×带宽×延迟）位的数据脉冲，然后发送方在发送下一个脉冲前等待这个脉冲部分的接收方的确认。（2×带宽×延迟）是任何时刻转换的位数


#### 抖动 jitter

如果数据的不同分组碰到不同的延迟并且接收方使用数据的应用是时间敏感的，抖动就可能会产生问题


## 数字传输

### 数字到数字转换

digital- to-digital convertion

数字信号表示数字数据的转换涉及三种技术：线路编码（总是需要的）、块编码（不一定需要）、扰动（不一定需要）

#### 线路编码 line coding

将数字数据转换为数字信号的过程。

线路编码将位序列转换成数字信号，在发送方数字数据被编码成数字信号，接收方则解码数字信号重新生成原数字数据

- 不同线路编码方案的共同特性：
	
	- 信号元素与数据元素：
		
		- 数据元素是表示一块信息的最小实体，即位
			
		- 信号元素是数字信号的最小单元。信号元素承载数据元素
			
		- 比率r（=数据元素数/信号元素数）为每个信号元素承载的数据元素的数量
			
		
	- 数据速率和信号速率：
		
		- **数据速率** data rate 定义1s 发送的数据元素数量，单位是每秒位 bps。有时被称为比特率 bit rate
			
		- **信号速率** signal rate 是1s 发送的信号元素的数量，单位是波特 baud。有时被称为脉冲速率 pulse rate、调制速率 modulation rate、波特率 baud rate
			
		- 数据通信的一个目标是增加数据速率（增加了传输速度）而降低信号速率（降低了带宽需求）
			
		- 数据速率与信号速率关系：
			
			- 取决于 r 值和数据模式
				
			- $S = c×N× \frac{1}{r}$ baud，N 是数据速率 bps，c 是情形因子（有三种情形：最好、最坏、一般，最坏情形是需要最大信号速率，最好情形是需要最小信号速率），S 是每秒信号元素的数量，r 是每个信号元素能够携带的数据元素的数量
			- ![[40-数字传输-r-carried-ratio.png]]
				
			
		
	- 带宽：携带信息的数字信号是非周期性的，其理论（真实）带宽是无限连续的，但实际上有效带宽有限（振幅过小的忽略不计）
		
		- 带宽影响了所需的频率范围。需要带宽的图表等更多信息，而不只是值
			
		- 波特率决定了数字信号的带宽：$B_{min} = c×N× \frac{1}{r}$，带宽（频率范围）与信号速率成正比
			
		- 如果通道带宽给定，则最大数据速率：$N_{max} = \frac{1}{c}×B×r$
			
		
	- 基线偏移baseline wandering：
		
		- 基线baseline：解码数字信号时，接收方计算接收到信号功率的运行平均值
			
		- 输入信号的功率会与基线比较来确定数据元素的值，一个0/1的长字符串会引起基线偏移，使得接收方不能正确地进行解码。一个好的线路编码方案需要防止基线偏移
			
		
	- 直流成分DC component：当数字信号中的电平保持一段时间的恒定时，频谱产生的接近于0的频率
		
		- 直流成分会给不允许通过低频率的系统或者使用电子耦合的系统（变压器）带来问题。此时就需要使用无直流成分的方案
			
		
	- 自同步self-synchronizing：为了正确地解释从发送方接收到的信号，接收方的位间隔必须与发送方的位间隔严格对应。如果不匹配，接收方就可能错误地解码
		
		- 数字信号在传输的数据中包含有定时信息
			
		- 如果信号中包含有提示接收方起始、中间和结束位置的脉冲的跳变就可以完成自同步。如果接收方的时钟不同步，这些提示跳变就会将接收方的时钟复位
			
		
	- 内置差错检测：编码方案产生的代码需要一定程度的内置差错检测能力来检测传输中发生的一些差错
		
	- 抗噪声和抗干扰能力：保证传输过程中受影响较小
		
	- 复杂性：复杂方案需要更高的成本


- 线路编码方案
	
	- 单极编码方案：所有信号电平都在时间轴的一边
		
		- 不归零 NRZ（non-return-to-zero），在位中间信号不会回到零。一般单极编码方案设计成不归零方案。
		- ![[40-数字传输-unipolar-NRZ.png]]
			
		- 特点：成本高，标准功率（每个单元线路阻抗发送1位所需的功率）是极性NRZ方案的两倍
			
		
	- 极性编码方案：电平在时间轴的两边
		
		- 不归零编码NRZ在极性NRZ（polar NRZ）编码中，信号的振幅使用两个电平
			
		- 极性NRZ的两种形式：
			
			- NRZ-L（NRZ电平编码，NRZ-Level）：信号电平决定了位值
				
			- NRZ-I（NRZ 反向编码，NRZ-Invert），信号电平是否反相或跳变决定了位值，如果没有跳变，位值为 0，否则为1
			- ![[40-数字传输-polar-NRZ.png]]
				
			- 二者皆有 r=1，平均信号速率 $S_{avg}=\frac{N}{2}$ baud
				
			- 存在问题：
				
				- 基线偏移问题：NRZ-L比NRZ-I更严重。NRZ-L中有一个全0或全1长序列，则平均信号功率就会变斜，接收方辨别位值较困难；NRZ-I中只有全0长序列会发生，消除全0序列即可避免基线偏移
					
				- 同步问题：NRZ-L比NRZ-I更严重。全0长序列都会引起问题，但全1长序列只在NRZ-L中产生问题
					
				- 系统极性意外改变：NRZ-L会在极性改变时，将所有0解释为1而所有1解释为0，而NRZ-I不会有此问题
					
				- 带宽：频率接近于零时，功率密度值会很高，意味着有携带了高电平能量的DC成分。实际上，大多数能量集中在0~N/2之间的频率，意味着虽然平均信号速率是N/2，但能量被平均在这两个值之间的频率中
					
				
			
		- 归零编码RZ（return-to-zero）：为的是解决发送方和接收方时钟不同步问题，它使用三个值：正值、负值、零。信号在位中间变化而不是两个位之间
			
			- 每个位中间信号变成 0，保持到下一个位开始
			- ![[40-数字传输-polar-RZ.png]]
				
			- 缺点：
				
				- 需要两个信号变化来编码一个位，占用更大的带宽
					
				- 极性意外改变的问题仍然存在，但没有了DC成分的问题
					
				- 复杂，使用了三个电平，生成和识别较困难
					
				- 被性能更好的曼彻斯特编码和差分曼彻斯特编码代替
					
				
			- r=1/2，$S_{avg}=N$
				
			
		- 双相编码：
			
			- 曼彻斯特编码：位的持续时间被二等分，前半部分电平保持一个水平，后半部分变成另一个水平，位中间的跳变提供了同步。组合了RZ和NRZ-L的思想
				
			- 差分曼彻斯特编码：在位中间总有一个跳变，但是位值在位开始时确定，如果下一个位是 0，就有一个跳变，如果是 1，则没有跳变。组合了 RZ 和 NRZ-I 的思想
			- ![[40-数字传输-Polar-biphase.png]]
				
			- 曼彻斯特编码克服了 NRZ-L 的一些问题，差分曼彻斯特编码克服了 NRZ-I 的一些问题。解决了基线偏移问题、DC 成分问题 
				
			- 缺点在于信号速率，曼彻斯特编码和差分曼彻斯特编码的信号速率是NRZ的2倍
				
			- r=1/2，$S_{avg}=N$
				
			
		
	- 双极性方案：双极bipolar编码（又称多电平二进制multilevel binary）中，有三个电平（正值、负值、零），一个数据元素的电平是0，另一个数据元素的电平在正值、负值间交替
		
		- 双极交替传号反转AMI（alternate mark inversion）：传号指1，其表示的含义是交替的1的反换。中值0电平表示二进制的0，交替正负电平表示二进制的1
			
		- 伪三元编码 pseudoternary：AMI 编码的一个变型，位 1 编码成 0 电平，位 0 编码成交替正负电平
		- ![[40-数字传输-Bipolar.png]]
			
		- 双极性方案是NRZ的替代方案，其信号速率与NRZ相同，但没有DC成分，能量集中于频率N/2处（NRZ能量集中于0~N/2区间，如果通道这个频率附近性能较差，这个编码就不适合）
			
		- AMI通常用于长距离通信，但数据中存在0长序列时会有同步问题。可以通过扰动技术解决
			
		- r=1，$S_{avg}=\frac{N}{2}$
			
		
	- 多电平方案：由增加数据速度或者降低所需带宽的需求催生，目标是通过把m个数据元素的模式编码成n个信号元素的模式，增加没波特的位数
		
		- 对于只有两种数据元素0/1，则 m 个数据元素组可以产生 $2^m$ 个数据模式组合；而不同信号元素可用不同的电平表示，如果 L 个不同电平，就会有 $L^n$ 个信号组合 
			
			- 如果$2^m=L^n$，则每个数据模式编码成一个信号模式
				
			- 如果$2^m<L^n$，则数据模式只能占据一个信号模式的子集，多余的部分则可以用来提供同步并检测数据传输中出现的差错、避免基线偏移
				
			- 如果$2^m>L^n$，则无法完成数据编码
				
			
		- mBnL，m是二进制模式的长度，B表示二进制数据，前两个字母定义了数据模式；n是信号模式长度，L是信号中电平数（L=2用B表示，L=3用T表示，L=4用Q表示），后两个字母定义了信号模式
			
			- 2B1Q：两个二元一个四元（two binary, one quaternary），使用长度为2的2位数据模式编码成一个4电平信号元素
				
				- ![[40-数字传输-2b1q.png]]
				- r=1/2，$S_{avg}=\frac{N}{4}$，意味着2B1Q 发送数据比 NRZ-L 快2倍
					
				- 但是用4个不同的信号电平，意味着接收方要辨别4个不同的阈值，降低的带宽需要更高的成本来弥补
					
				- $2^2=4^1$，故此方案没有多余的信号模式
					
				
			- 8B6T：八个二元六个三元（eight binary, six ternary），把8位模式编码成6个信号元素模式，每个信号有3个电平
				
				- ![[40-数字传输-8b6t.png]]
				- 有$2^8=256$个数据模式和$3^6=478$个信号模式，故有222个冗余信号元素用来提供同步和差别检测，还有一部分用于DC平衡
					
				- 每个信号模式有0或+1的DC值得平衡梁，意味着没有平衡量为-1值得模式。为了DC整个流实现DC-平衡，发送方必须关注平衡量，如果两个平衡量为+1的组紧接着，第一个组保持原状发送，第二个组全部取反使得平衡量为-1
					
				- $S_{avg}=\frac{1}{2}×N× \frac{6}{8}$，实际上最小带宽十分接近$\frac{6N}{8}$
					
				
			- 4D-PAM5：4维5级脉冲振幅调制（four-dimensional five-level pulse amplitude modulation）：4D表示数据同时通过4条线路发送，使用5个（-2，-1，0，1，2）电平，其中0只用于发送差错检测
				
				- ![[40-数字传输-4dpam5.png]]
				- 一维版本，4个电平产生类似于8B4Q方案的编码，即一个8位码字转换成一个4电平的信号元素，此时最差信号速率是N/2
					
				- 该技术用来通过4个通道发送数据，意味着数据速率可以降低到N/8，所有8个位同时进入一条线路通过使用1个信号元素发送。关键点在于4个信号元素组成1个信号组，并通过四维环境同时发送
					
				- 这个方案有很大的冗余，额外的信号模式可以用于诸如差错检测等其他目的
					
				
			
		
	- 多线路传输：NRA-I和差分曼彻斯特编码是差分编码，使用两种不同的跳变规则来编码二进制数据（没有反相、有反相）。如果信号电平多于2个，则涉及跳变规则多于2个的差分编码方案出现
		
		- 三电平多线路传输 MLT-3（multiline transmission, three level）方案使用 3 个电平（+V、0、-V）和三个跳变规则在电平间变动
		- ![[40-数字传输-mlt3.png]]
			
		- 三个跳变规则：
			
			- 如果下一个位是0，没有跳变
				
			- 如果下一个位是1，且当前电平不是0，下一个电平是0
				
			- 如果下一个位是1，且当前电平是0，下一个电平是最后一个非零电平的相反值
				
			
		- S(ave)=N/2，该方案中信号形状帮助降低了所需的带宽
			
		- 最坏情形：全1的序列，每4个位就重复信号元素模式+V0-V0，非周期信号变成周期信号，周期等于4倍位持续时间。可以模拟成频率为1/4比特率的模拟信号

![[40-数字传输-line-coding-summary.png]]

#### 块编码 block coding

给出某种冗余来确保同步，并提供一些内在的差错检测，提高线路编码的性能


- 块编码一般涉及三个步骤：分组、置换、组合
	
- mB/nB，把m位的块变成n位的块。块编码称为mB/nB编码技术。n一般大于m，故新形成的流比原始流有更多的位：
	
	- 4B/5B：4个二元/5个二元（four binary/five binary）
		
		- 设计出来于NRZ-I组合使用，在NRZ-I编码前改变位流，解决了NRZ-I连续为0的长序列出现同步问题的缺点。在接收方，NRZ-I编码后的数字信号先解码成位流，再去掉冗余
			
		- 4B/5B编码中，将4位输入置换成5位输出，仅包含不超过一个前导0（左边位）和两个后缀0（右边位），因此最多有三个连续的0。
			
		- 4位组有16个不同的组合，5位组有32个不同的组合。冗余的部分一些用于控制，一些用于差错检测（接收到的5位组属于表中没有使用的成分，则传输中出现了差错）
			
		- 增加了NRZ-I的信号速率，冗余位增加了20%的波特，但仍小于两相方案，其信号速率是NRZ-I的两倍。但是没有解决DC成分的问题，如果DC成分不可接受，须换用两相或双极编码方案
			
		
	- 8B/10B：8个二元/10个二元（eight binary/ten binary）
		
		- 类似于4B/5B方案，有更强的差错检测能力和同步能力（2^10-2^8=768个冗余，可以用于不均等性校验），优于4B/5B。实际上是5B/6B和3B/4B方案的组合
			
		- 高5位送入5B/6B编码器，低3位送入3B/4B编码器。简化映射表，防止连续0或1的长串
			
		- 编码使用不均等性控制器观察0或1的数量。如果当前块中的位产生了不均等性，而该不均等性对上一块的不均等性有影响（任一方向），那么当前块中所有为取反


#### 扰动

Scrambling

不会增长位数并提供同步的技术，以及一种把0电平脉冲置换成其他电平组合来提供同步的解决方法

- 修改了AMI部分规则引入（避免初始流中连续0长序列的方法使得双极AMI可以用于长距离）。相对于块编码，扰动和编码同时完成，系统需要基于定义好的扰动规则插入所需脉冲

- 两种通用扰动技术：
	
	- B8ZS：8零置换的双极编码方案（bipolar with 8-zero substitution），通常用于北美地区，八个连续0电平被替换成000VB0VB
		
		- V表示违反，这个非零电平违反了AMI编码规则（前一极的相反极）；B表示双极，表示与AMI规则相一致的非零电平
			
		- V和B是相对的，V表示与前一个非零脉冲极性相同的极性；B表示与前一个非零脉冲极性相反的极性
			
		- 这里的扰动不会改变比特率，且该技术平衡了正电平和负电平，意味着维持了DC平衡。此处置换可能会改变1的极性，因为置换后AMI需要遵守它的规则
			
		
	- HDB3：高密度双极3零方案（high-density bipolar 3-zero），通常用于北美地区以外，比B8ZS技术更保守。四个连续零电平被置换成000V或B00V
		
		- 不同置换的原因是为维持每次置换后非零脉冲为偶数：
			
			- 如果最后一次置换后的非零脉冲数为奇数，置换模式是000V，使得非零脉冲数为偶数
				
			- 如果最后一次置换后的非零脉冲数为偶数，置换模式是B00V，使得非零脉冲数为偶数
				
			
		- 第一次置换前，非零脉冲数是偶数，所以第一次置换是B00V


### 模拟到数字转换

analog-digital conversion

数字信号优于模拟信号，需要将模拟信号转换成数字信号进行传输

#### 脉冲码调制 PCM

pulse code modulation 三个过程

- 采样：对模拟信号进行采样
	
	- 采样率 sampling rate 或采样频率 sampling frequency：$f_{s}=\frac{1}{T_{s}}$，$T_{s}$ 为对模拟信号进行采样的样本间隔或周期
		
	- 三种采样方法：
		
		- 理想采样：对来自模拟信号的脉冲进行采样
			
		- 自然采样：当采样发生时高速开关开启很短的时间，其样本序列保持了模拟信号的形状
			
		- 方顶采样：通过采样和保持技术sample and hold，在适用电路中产生
			
		
	- 采样过程有时称为脉冲振幅调制PAM（pulse amplitude modulation），其结果仍是非完整的模拟信号
		
	- 采样速率sampling rate：根据奈奎斯特定理Nyquist theorem，为了再生原始模拟信号，一个必要条件是采样速率至少是原始信号中最高频率的两倍
		
		- 约束：
			
			- 只有信号带宽是有限时，才能对它进行采样
				
			- 采样率必须至少是最高频率而不是带宽的两倍
				
			
		- 奈奎斯特定理运用例子：
			
			- 时钟例子：时钟的秒针周期为60s，以奈奎斯特率进行采样无法判断时钟的行进方向，过采样（高于奈奎斯特率）才能显示正确的方向，欠采样（低于奈奎斯特率）则会得到相反的方向。
				
			- 电影车轮转向例子：电影以每秒24帧的速度拍摄，如果车轮以高于每秒12次的速度旋转，欠采样就会产生车轮向后旋转的假象
				
			- 低通信号带宽在0~f之间，其最大频率为f；带通信号带宽确定，但最小频率最大频率不能确定，无法求出最小采样率
				
			
		
	- 采样后的结果：一系列振幅值介于信号最大振幅和最小振幅间的脉冲。振幅集可能是无限个介于两个限制间的非整数值，这些值无法用于编码，需要进行量化


- 量化：对采样后信号进行量化
	
	- 步骤：
		
		- 得到原始模拟信号的振幅 $V_{min}$ 和 $V_{max}$ 区间
			
		- 将范围分成 L 个区间，每个区间高度为Δ，则 $\Delta= \frac{V_{max}-V_{min}}{L}$
			
		- 分配0到L-1的量化值给每个区间的中点
			
		- 样本振幅值近似为量化值
			
		
	- 例子：
		- ![[40-数字传输-quantization.png]]
		- 使用理想采样得到9个样本，样本顶端的值为实际振幅
		
		- 标准化PAM值：实际振幅/Δ
			
		- 标准化量化值：选自每个区间的中点
			
		- 标准化误差：标准化量化值-标准化PAM值
			
		- 量化码：每个划分区间的中点，从0~L-1
			
		- 编码码字：根据量化码转换的最后数字信号结果
			
		
	- 量化等级：L（等级数）的选择取决于模拟信号振幅范围以及需要准确恢复信号的程度。更高的量化等级恢复程度更高，如果信号的幅度变化很大，较低的L值就会增加量化误差
		
	- 量化误差：量化是一个近似过程，量化器的输入值是实际值，输出值是近似值。输出值为区间的中间值，如果输入值也在区间中间，就没有量化误差，否则就会有误差。误差在-Δ/2与Δ/2之间
		
		- 量化误差对信号 SNR（dB）的影响取决于量化级别 L 或每个样本位数 $n_{b}$：$SNR_{dB} = (6.02n_{b}+1.76)dB$
			
		
	- 均匀量化与非均匀量化：
		
		- 上例就是均匀量化
			
		- 而对于其他很多应用，模拟信号中瞬时振幅的贡献不均匀的，振幅的变化一般在低频率中比高频率中发生的更频繁，此时采用非均匀量化更好：Δ的高度不固定，接近低振幅时较大而接近高振幅时较小
			
		- 非均匀量化使用压缩companding和扩展expanding的过程实现。在发送方，信号在转换前先压缩，在接受方，转换前先扩展。压缩表示减小较大瞬时电平振幅值，扩展相反。压缩使得强信号的电平衡量更大，而弱信号的电平衡量更小
			
		- 非均匀量化有效地减小了量化 $SNR_{dB}$


- 编码：量化后的值编码成位流
	
	- 在每个样本量化并且每个样本的位数确定后，每个样本可以转换成 $n_{b}$ 个位的码字，每个样本的位数取决于量化等级数，$n_{b}=\log_{2}L$
		
	- $比特率=采样速率×每个样本位数=f_{s}\times n_{b}$ 
		
	- 原来信号恢复：需要PCM解码器。
		
		- 解码器先使用电路把码字转换成保持下一个脉冲前振幅的脉冲
			
		- 阶梯信号完成后，经过一个低通过滤器把阶梯信号平滑成模拟信号。过滤器有同发送方原来信号一样的阶段频率
			
		- 如果信号是以奈奎斯特采样速率采样的，并且有足够的量化等级，就可以重新生成原来信号
			
		
	- PCM 带宽：给定低通模拟信号的带宽，要数字化这个信号，则通过这个数字化信号的通道的最小带宽 $B_{min} = c×N× \frac{1}{r} = c×n_{b}×f_{s}× \frac{1}{r} = c×n_{b}×2×B_{analog})× \frac{1}{r}$。
		
		- 当 $\frac{1}{r} = 1$（对于 NRZ 或双极信号）和 $c=\frac{1}{2}$（平均情况）时，最小带宽 $B_{min} = n_{b}×B_{ana log}$。这意味着数字信号的最小带宽是模拟信号的 $n_b$ 倍
			
		
	- 通道的最大数据率：$N_{max} = 2×B×\log_{2}L$ bps
		
		- 如何从奈奎斯特采样定理推导出？
			
			- 假定可用通道是带宽为B的低通通道
				
			- 假定要发送的数字信号有 L 个电平，每个电平是一个信号元素，即 $r = 1/\log_{2}L$
				
			- 先把数字信号通过低通过滤器阶段 *B* Hz 以上的频率
				
			- 把结果信号看作模拟信号，并且以每秒 2×B 个样本对它进行采样，使用 L 个电平进行量化。因为信号初始有 L 个电平，所以额外的量化电平是无用的
				
			- 结果比特率是 $N = f_{s}×n_{b} = 2×B×\log_{2}L$，这是最大带宽。如果情形因子 c 变大，数据速率就减小
				
			
		
	- 最小所需带宽：如果数据速率和信号电平数都是固定的，则 $B_{min} = N/(2×\log_{2}L)$ Hz


#### Delta 调制 DM

PCM得到每个样本的信号振幅值，DM从前一个样本中得到变化

- 调制器:用在发送方站点，用来从模拟信号中产生位流
	
	- delta δ记录了处理的正/负改变。delta是正的，就记录1，是负的，记录0。需要一个基准提供模拟信号比较
		
	- 调制器生成一个像梯形的第二个信号，发现变化后变为输入信号与逐步生成的梯形信号进行比较
		
	- 在每个采样区间，调制器将模拟信号的值与梯形信号的最后一个值相比较，如果模拟信号的振幅大，数字数据的下一个位就是1，否则为0
		
	- 比较器（调制器的组成部分：比较器、延迟单元、梯形生成器）的输出能自己生成梯形信号，如果下一个位是1，梯形信号生成器就会把梯形信号的最后一个点向上移动δ，是0就下移δ
		
	- 需要额外的一个延迟单元，在两次比较间保持梯形函数
		
	
- 解调器：得到数字数据，用梯形生成器和延迟单元产生模拟信号，再通过一个低通过滤器来平滑模拟信号
	
- 适配DM：通过适配delta调制（adaptive delta modulation），δ根据模拟信号的振幅而改变，可以获得更好的性能
	
- 量化误差：DM的量化误差远小于PCM的，尽管仍不完美

### 传输模式

通过链路传输二进制数据可采用的传输模式

#### 并行模式

parallel transmission

- 定义：计算机使用和生成以位组（每组由n位的二进制数据组成）为单位的数据。通过位组，一次可以发送n位数据而不是1位
	
- 机制原理：每次使用n条线路传送n位。每位有自己的线路，一个位组中的所有n位能够在一个时钟脉冲从一个设备传输到另一个设备
	
- 优缺点：
	
	- 缺点：高成本。需要n条通信线路，因此通常只用于短距离通信
		
	- 优点：高速度。当其他因素相同时，并行传输比串行传输提高了n倍传输速度


#### 串行模式

serial transmission

位依次传输，只需要一条传输通道，因此成本低，约是并行传输的1/n；又因为设备内部数据是并行的，所以在发送方和线路之间、线路和接收方之间，都需要**串行/并行转换设备**

- 异步传输asynchronous transmission：
	
	- 异步传输特点：信息的接收和转换通过约定的模式进行，传输中信号的时序并不重要。只要遵循约定模式，接收设备就可以不管信息发送的节奏而正确地获取信息
		
		- 约定模式基于将位流组成字节的方式建立的。每一个组作为一个单位沿着链路传送
			
		- 发送系统独立处理每个分组，每处理完一个组就将它转发到链路上而不理会时钟信号
			
		
	- 处理同步机制：
		
		没有同步时钟，接收方就不能通过计时方式预测下一个新组何时到达，所以需要别的方式处理同步
		
		- 在每一个字节的开始处增加一个起始位start bit（通常是0）用于通知接收方有一个新组到达；在字节的结束位置增加一个或多个位作为停止位stop bit（通常是1）用于通知接收方字节已经结束
			
		- 这样，字节长度会增加，并且每发送完一个字节，要跟上一段可变长的时间间隔，这段间隔通过空闲状态或者附加的停止位流表表示
			
		
	- 异步中的同步：
		
		- 起始位、停止位以及时间间隔用于提示接收方每一个字节的开始和结束，使得接收方可以根据数据流进行同步
			
		- 异步机制：在字节这一级，发送方和接收方不需要进行同步，但在每一个字节内部，接收方仍要与输入的位流进行同步
			
		- 异步在这里指的是字节级上的异步，但是每位仍要同步，局限在单个字节内，它们的持续时间相同。每个新字节开始时，接收设备会重新进行同步
			
		- 具体细节：当接收方检测到起始位后，它会启动计时器，随着位的到来开始计数，在接收完n个位后，接收方就等待停止位的到达。一旦检测到停止位，接收方在下一个起始位到达前忽视接收到的所有信号
			
		
	- 异步传输附加了停止位、起始位以及在位流中插入间隙，使得其比没有附加控制信息的传输方式运行较慢，但是优点在于便宜而有效，对于低速通信很有吸引力（如键盘到计算机）


- 同步传输synchronous transmission：
	
	- 特点：同步传输中，位流被组合成更长的“帧”，一帧包含了许多字节，帧内各字节之间没有间隙。数据以一种不间断的1/0位串进行传输，接收方将位流分割成重构信息所需的一个个字节。（即此传输模式中，依次发送位流而不含起始位、停止位和间隙，接收方负责将位进行分组
		
	- 细节：
		
		- 发送方将数据作为一个长的串发送到线路上（如果发送方希望再单独地一段一段地发送数据，则每段数据之间的间隙必须由意味着空闲状态的0/1序列填充
			
		- 接收方将在位到达时计数，并将它们重组为字节形式
			
		- 由于没有时隙和起始位、停止位这样的位流内部的同步机制来帮助接收设备在处理位流时调整位同步，因此接收到的信息的准确性完全取决于接收设备根据接收到的位的准确计数能力，所以计时变得非常重要
			
		
	- 优点：高速。发送方没有引入额外的位或者间隙并且接收方也不需要将它们去掉，通过链路传送的位更少，比异步传输更快。不过要注意，虽然在以同步串行传输的字符间没有间隔，但是帧间可能有不等的间隔
		
	- 例子：计算机之间的数据传输。字节同步在数据链路层完成


- 等时传输isochronous transmission：
	
	- 如果一个图象是用一个或多个帧发送，帧间应该没有延迟，此时字符间的同步是不够的，整个流必须同步。等时传输保证了数据以固定速率到达
